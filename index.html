<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¸ë„ë°•í•´ìš”ğŸ’¸</title>
    <style>
        :root {
            --primary: #4f46e5; --primary-hover: #4338ca; --success: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --info: #3b82f6; --dark: #1f2937; --light: #f3f4f6; --white: #ffffff;
            --purple: #8b5cf6; --gold: #d97706;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: #e5e7eb; color: var(--dark); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; user-select: none; }
        .container { background: var(--white); width: 100%; max-width: 400px; padding: 25px; border-radius: 24px; box-shadow: var(--shadow); position: relative; overflow: hidden; min-height: 300px; display:flex; flex-direction:column; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .screen { display: none; flex-grow: 1; flex-direction: column; } .active { display: flex; }
        h2 { margin: 0 0 5px 0; color: var(--dark); font-weight: 800; }
        h3 { margin: 0; color: var(--primary); font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        p { color: #6b7280; margin: 0; line-height: 1.4; font-size: 0.9rem; }

        /* UI Components */
        .input-group { display: flex; gap: 8px; width: 100%; align-items: center; }
        .input-group input { margin-bottom: 0; flex: 2; }
        .input-group button { flex: 1; margin-bottom: 0; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem; box-sizing: border-box; transition: 0.2s; font-family: inherit; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        button { width: 100%; padding: 12px; border: none; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: 0.2s; background-color: var(--primary); color: white; box-shadow: 0 3px 5px -1px rgba(79, 70, 229, 0.2); }
        button:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button:disabled { background-color: #d1d5db; cursor: not-allowed; transform: none; box-shadow: none; color: #9ca3af; }
        
        .btn-danger { background-color: var(--danger); box-shadow: 0 3px 5px -1px rgba(239, 68, 68, 0.2); } .btn-danger:hover { background-color: #dc2626; }
        .btn-success { background-color: var(--success); box-shadow: 0 3px 5px -1px rgba(16, 185, 129, 0.2); } .btn-success:hover { background-color: #059669; }
        .btn-outline { background-color: white; color: var(--dark); border: 2px solid #e5e7eb; box-shadow: none; } .btn-outline:hover { background-color: #f9fafb; border-color: #d1d5db; }
        .btn-warning { background-color: var(--warning); box-shadow: 0 3px 5px -1px rgba(245, 158, 11, 0.2); color: white; } .btn-warning:hover { background-color: #d97706; }
        .btn-purple { background-color: var(--purple); box-shadow: 0 3px 5px -1px rgba(139, 92, 246, 0.2); color: white; } .btn-purple:hover { background-color: #7c3aed; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; width: auto; }

        /* Floating Buttons */
        .gear-btn, .inv-btn { position: absolute; right: 20px; width: 40px; height: 40px; background: white; color: #4b5563; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; font-size: 1.2rem; z-index: 10; padding: 0; cursor: pointer; border: 1px solid #e5e7eb; }
        .gear-btn { top: 20px; } .gear-btn:hover { color: var(--primary); }
        .inv-btn { top: 70px; } .inv-btn:hover { color: var(--primary); transform: scale(1.1); }

        /* Item Toggle Switch */
        .item-toggle { display: inline-flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #555; background: #fff; padding: 4px 10px; border-radius: 15px; border: 1px solid #e5e7eb; cursor: pointer; white-space: nowrap; transition: 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .item-toggle:hover { background: #f9fafb; border-color: #d1d5db; }
        .item-toggle input { display: none; }
        .item-toggle-indicator { width: 14px; height: 14px; border-radius: 4px; border: 2px solid #d1d5db; display: inline-block; position: relative; transition: 0.2s; background: white; }
        .item-toggle input:checked + .item-toggle-indicator { background: var(--primary); border-color: var(--primary); }
        .item-toggle input:disabled + .item-toggle-indicator { background: #e5e7eb; border-color: #d1d5db; opacity: 0.5; }
        .item-toggle.disabled { opacity: 0.6; cursor: not-allowed; background: #f3f4f6; }

        /* Stats Box */
        .stat-box { background: linear-gradient(135deg, var(--dark), #374151); color: white; padding: 15px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 8px 12px -3px rgba(0,0,0,0.1); margin-top: 10px; position: relative; overflow: hidden; flex-shrink: 0; }
        .vip-badge { position: absolute; top: 10px; right: 10px; font-size: 0.7rem; font-weight: bold; padding: 2px 8px; border-radius: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); }
        .vip-gold { background: linear-gradient(45deg, #f59e0b, #fbbf24); color: #78350f; border:none; }
        .vip-plat { background: linear-gradient(45deg, #a855f7, #ec4899); color: white; border:none; }
        
        .user-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; opacity: 0.9; }
        .money-row { font-size: 1.5rem; font-weight: 800; margin-top: 3px; color: var(--success); text-shadow: 0 2px 4px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: flex-end; }
        .debt-text { font-size: 0.9rem; color: #fca5a5; font-weight: bold; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        .xp-container { margin-top: 10px; }
        .xp-info { display: flex; justify-content: space-between; font-size: 0.7rem; color: #d1d5db; margin-bottom: 3px; }
        .xp-bar-bg { background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden; }
        .xp-bar-fill { background: var(--info); height: 100%; width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--info); }
        .status-msg { font-size: 0.8rem; color: var(--warning); margin-top: 5px; font-weight: bold; min-height: 16px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Menu */
        .grid-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; flex-shrink: 0; position: relative; z-index: 50; }
        .menu-btn { background: white; color: var(--dark); border: 1px solid #e5e7eb; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px 4px; font-size: 0.8rem; gap: 4px; box-shadow: none; height: 60px; font-weight: bold; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active-tab { background: #f9fafb; border-color: var(--primary); color: var(--primary); }
        .menu-btn span { font-size: 1.4rem; }
        .popover-menu { position: absolute; top: 75px; left: 0; width: 100%; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15); padding: 10px; display: none; grid-template-columns: repeat(3, 1fr); gap: 10px; z-index: 100; animation: popDown 0.2s; box-sizing: border-box; }
        @keyframes popDown { from { opacity: 0; transform: translateY(-10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .submenu-btn { background: white; border: 1px solid #d1d5db; border-radius: 8px; padding: 12px 5px; font-size: 0.8rem; color: #374151; font-weight: 600; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.1s; }
        .submenu-btn:hover { background: #eff6ff; border-color: var(--primary); color: var(--primary); transform: translateY(-1px); }

        /* Game Area */
        .game-area { background: #f9fafb; border-radius: 16px; padding: 15px; border: 1px solid #f3f4f6; flex-grow: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; height: 320px; }
        .full-height-layout { display: flex; flex-direction: column; height: 100%; justify-content: space-between; flex-grow: 1; overflow: hidden; }
        .scroll-view { flex-grow: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 5px; }
        .scroll-view::-webkit-scrollbar { width: 4px; }
        .scroll-view::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 4px; }
        
        .start-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .start-icon { font-size: 4rem; margin-bottom: 10px; animation: popUp 0.5s ease; }

        /* Game Elements */
        .game-board { flex-grow: 1; background: white; border: 1px solid #e5e7eb; border-radius: 12px; margin: 10px 0; padding: 10px; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
        .stock-item { background: white; padding: 10px; border-radius: 8px; margin-bottom: 6px; border: 1px solid #e5e7eb; display: grid; grid-template-columns: 1.5fr 1fr 1.5fr; align-items: center; gap: 8px; }
        .stock-info b { display: block; font-size: 0.85rem; } .stock-info span { font-size: 0.75rem; color: #6b7280; }
        .stock-cnt { text-align: center; font-size: 0.8rem; font-weight: bold; color: var(--primary); }
        .stock-actions { display: flex; gap: 4px; justify-content: flex-end; } .stock-actions button { width: auto; padding: 5px 8px; font-size: 0.7rem; margin: 0; box-shadow:none; }
        
        .bank-info { text-align: center; margin-bottom: 20px; padding: 15px; background: white; border-radius: 12px; border: 1px solid #e5e7eb; }
        .bank-debt { color: var(--danger); font-size: 1.5rem; font-weight: 800; margin: 10px 0; }
        
        .compact-board { display: flex; height: 100%; align-items: center; }
        .compact-col { flex: 1; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .compact-vs { width: 1px; height: 80%; background: #e5e7eb; margin: 0 5px; }
        .compact-label { font-size: 0.8rem; color: #6b7280; margin-bottom: 8px; font-weight: bold; }

        .dice-num { width: 32px; height: 32px; line-height: 32px; background: var(--dark); color: white; border-radius: 6px; font-weight: bold; display:inline-block; margin:2px; font-size: 0.9rem; }
        .dice-hidden { background: #d1d5db; color: #9ca3af; }
        .card { display: inline-flex; width: 36px; height: 50px; background: white; color: var(--dark); border-radius: 4px; justify-content: center; align-items: center; font-weight: bold; margin: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-size: 0.9rem; }
        .card.red { color: #dc2626; } .card-hidden { background: #374151; color: transparent; background-image: repeating-linear-gradient(45deg, #4b5563 0, #4b5563 5px, #374151 5px, #374151 10px); }

        .xp-gain { animation: popUp 0.3s ease; color: var(--info); font-weight: bold; }
        @keyframes popUp { 0%{transform:scale(1);} 50%{transform:scale(1.2);} 100%{transform:scale(1);} }

        /* ROULETTE STYLES */
        .rt-choice-box { display: flex; gap: 10px; justify-content: center; margin-top: 5px; width: 100%; }
        .rt-radio-label { flex: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: 0.2s; font-weight: bold; background: white; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .rt-radio-label input { display: none; }
        .rt-radio-label:hover { border-color: var(--primary); background: #f9fafb; }
        .rt-radio-label.selected { border-color: var(--primary); background: #eff6ff; color: var(--primary); }
        .rt-radio-label.red-opt.selected { border-color: #ef4444; background: #fef2f2; color: #ef4444; }
        .rt-radio-label.black-opt.selected { border-color: #374151; background: #f3f4f6; color: #374151; }
        .roulette-wrapper { width: 120px; height: 120px; background: white; border-radius: 50%; border: 8px solid var(--dark); display: flex; justify-content: center; align-items: center; margin: 10px auto; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; }
        .roulette-wrapper::before { content:'â–¼'; position:absolute; top:-22px; color:var(--danger); font-size:1.5rem; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3)); }
        .roulette-wheel { font-size: 2.5rem; font-weight: 800; color: var(--dark); }

        /* Shop, Skills, Achievements */
        .shop-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .shop-info h4 { margin: 0; font-size: 0.95rem; color: var(--dark); }
        .shop-info p { margin: 2px 0 0 0; font-size: 0.8rem; color: #6b7280; }
        .shop-btn { width: auto; padding: 8px 12px; font-size: 0.8rem; }

        .skill-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; }
        .skill-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .skill-lv { background: var(--dark); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .skill-desc { font-size: 0.8rem; color: #6b7280; margin-bottom: 8px; }
        .skill-bar-bg { height: 6px; background: #f3f4f6; border-radius: 3px; overflow: hidden; margin-bottom: 8px; }
        .skill-bar-fill { height: 100%; background: var(--primary); width: 0%; }
        
        .ach-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; opacity: 0.6; filter: grayscale(1); transition: 0.3s; }
        .ach-item.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ach-item.claimed { opacity: 1; filter: grayscale(0); border-color: var(--success); background: #ecfdf5; }
        .ach-info h4 { margin: 0; font-size: 0.9rem; } .ach-info p { margin: 0; font-size: 0.75rem; color: #6b7280; }

        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid var(--primary); animation: slideIn 0.3s ease; display: flex; align-items: center; gap: 10px; max-width: 300px; pointer-events: auto; }
        .toast-icon { font-size: 1.5rem; }
        .toast-content b { display: block; font-size: 0.9rem; color: var(--dark); }
        .toast-content span { font-size: 0.8rem; color: #6b7280; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); cursor: pointer; }
        .modal-box { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: modalUp 0.3s; position: relative; cursor: default; }
        @keyframes modalUp { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .modal-text { margin-bottom: 20px; font-size: 1rem; color: #333; line-height: 1.5; font-weight: 500; }
        .modal-btns { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .modal-btns button { padding: 12px 16px; width: 100%; margin: 0; }

        /* Inventory Pop */
        .inv-item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f9fafb; border-radius: 8px; margin-bottom: 6px; border: 1px solid #e5e7eb; font-size: 0.9rem; }
        .inv-item-name { display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .inv-item-cnt { background: var(--dark); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; }
        
        /* Lucky Box Animation */
        .gacha-box { font-size: 6rem; display: inline-block; margin: 20px 0; }
        .shake-box { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) infinite both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-2deg); } 20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); } 40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); } }
        .pop-result { animation: popResult 0.5s ease forwards; }
        @keyframes popResult { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

        .settings-area textarea { font-size: 0.8rem; height: 80px; margin-bottom: 10px; color: #555; word-break: break-all; }
		
		/* ì•Œë°” í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼ */
		.alba-container { display: flex; flex-direction: column; height: 100%; justify-content: space-between; }
		.alba-dashboard { background: #fff; border-radius: 12px; padding: 12px; border: 1px solid #e9ecef; box-shadow: 0 2px 8px rgba(0,0,0,0.03); display: flex; flex-direction: column; gap: 10px; }
		.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 10px; border-bottom: 1px dashed #e9ecef; }
		.stat-item { text-align: center; }
		.stat-label { font-size: 0.75rem; color: #868e96; margin-bottom: 2px; }
		.stat-value { font-size: 1rem; font-weight: 800; color: #343a40; }
		.stat-value.highlight { color: var(--primary); font-size: 1.2rem; }
		.bonus-badge { font-size: 0.65rem; color: var(--success); background: #e6fcf5; padding: 1px 5px; border-radius: 4px; vertical-align: middle; }
		.slider-wrapper { padding: 5px 0; }
		.compact-slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 3px; background: #e9ecef; outline: none; margin: 10px 0; }
		.compact-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; border: 2px solid #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.3); }
		.time-display { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: bold; color: var(--primary); background: #f8f9fa; padding: 6px 10px; border-radius: 8px; }
		.btn-work { width: 100%; padding: 12px; font-size: 1rem; border-radius: 12px; font-weight: bold; margin-top: 5px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Stock History Table */
        .history-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .history-table th { text-align: left; padding: 8px; border-bottom: 2px solid #e5e7eb; color: #6b7280; }
        .history-table td { padding: 8px; border-bottom: 1px solid #f3f4f6; color: var(--dark); }
        .history-table .buy { color: var(--danger); font-weight: bold; }
        .history-table .sell { color: var(--primary); font-weight: bold; }
        .history-container { max-height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid #e5e7eb; border-radius: 8px; }
		
		/* ìŠ¬ë¡¯ë¨¸ì‹  */
		.slot-reel { 
			background: white; 
			padding: 10px 20px; 
			border-radius: 12px; 
			box-shadow: 0 4px 6px rgba(0,0,0,0.1);
			min-width: 70px;
			text-align: center;
		}

		/* ì•¼ë°”ìœ„ */
		.shell-cup { 
			cursor: pointer; 
			text-align: center; 
			padding: 10px;
			border-radius: 12px;
			transition: transform 0.2s;
		}
		.shell-cup:hover { 
			transform: scale(1.1); 
			background: rgba(79, 70, 229, 0.1);
		}
    </style>
</head>
<body>
<audio id="alarm-sound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGB1O7Ujj0KE2Wx6t6oVRQLRp/g8r5sIQUxgdTu1I49ChNlsereo1UUC0af4PK/bCEFMYHU7tSNPQoTZbHq36hVFAtGn+DyvmwhBTGB1O7Ujj0KE2Wx6t+oVRQLRp/g8r5sIQUxgdTu1I49ChNlserfo1UUC0af4PK+bCEFMYHU7tSPPQoTZbHq3qNVFAtGn+DyvmwhBTGB1O7Ujj0KE2Wx6t6jVRQLRp/g8r5sIQUxgdTu1I89ChNlserfqFUUC0af4PK+bCEFMYHU7tSPPQoTZbHq3qNVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx6t+jVRQLRp/g8r5sIQUxgdTu1I89ChNlsereolUUC0af4PK+bCEFMYHU7tSPPQoTZbHq36NVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx6t+jVRQLRp/g8r5sIQUxgdTu1I89ChNlsereolUUC0af4PK+bCEFMYHU7tSPPQoTZbHq36NVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx" type="audio/wav">
</audio>

<div id="toast-container" class="toast-container"></div>
<button class="gear-btn" onclick="openSettings()">âš™ï¸</button>
<button class="inv-btn" onclick="openInventory()">ğŸ’</button>

<div class="container">
    <div id="modal-overlay" class="modal-overlay" onclick="if(event.target === this) handleOverlayClick()">
        <div class="modal-box">
            <div id="modal-content">
                <div id="modal-text" class="modal-text"></div>
                <div id="modal-btns" class="modal-btns"></div>
            </div>
            <div id="gacha-ui" style="display:none;">
                <h3 style="justify-content:center; margin-bottom:10px;">ğŸ ëŸ­í‚¤ë°•ìŠ¤ ê°œë´‰</h3>
                <div id="gacha-icon" class="gacha-box">ğŸ“¦</div>
                <p id="gacha-msg" style="font-weight:bold; color:var(--primary);">ë‘ê·¼ë‘ê·¼...</p>
                <button id="gacha-confirm" onclick="closeModal()" style="display:none; width:100%; margin-top:15px;">í™•ì¸</button>
            </div>
        </div>
    </div>
    
    <div id="login-screen" class="screen active fade-in" style="justify-content:center; align-items:center; text-align: center;">
        <h1 style="font-size: 3rem; margin-bottom: 10px;">ğŸ®</h1><h2>ë¯¸ë‹ˆê²Œì„ ë¼ìš´ì§€</h2><p>RPG Edition</p>
        <div style="margin-top: 30px; width:80%;"><input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥"><button onclick="startGame()" style="margin-top: 10px;">ì…ì¥í•˜ê¸°</button></div>
    </div>
    
    <div id="game-screen" class="screen fade-in">
        <div class="stat-box">
            <div id="vip-badge" class="vip-badge" style="display:none;">VIP</div>
            <div class="user-row"><span>ğŸ‘¤ <span id="user-info">Guest</span></span><span id="user-title" style="font-size:0.85em; font-weight:bold; color:#fbbf24;">Lv.1</span></div>
            <div class="money-row">
                <div><span style="font-size:0.6em; font-weight:normal;">â‚©</span> <span id="current-money">0</span></div>
                <div id="debt-display" class="debt-text" style="display:none;">(ë¹š: <span id="current-debt">0</span>)</div>
            </div>
            <div class="xp-container"><div class="xp-info"><span>EXP</span><span><span id="cur-xp">0</span> / <span id="max-xp">100</span></span></div><div class="xp-bar-bg"><div id="xp-bar" class="xp-bar-fill"></div></div></div>
            <div id="status-msg" class="status-msg"></div>
        </div>
        
        <div style="position:relative; width:100%;">
            <div id="menu-area" class="grid-menu">
                <button class="menu-btn" id="btn-money" onclick="togglePopMenu('money')"><span>ğŸ’°</span>ê²½ì œí™œë™</button>
                <button class="menu-btn" id="btn-game" onclick="togglePopMenu('game')"><span>ğŸ²</span>ë¯¸ë‹ˆê²Œì„</button>
                <button class="menu-btn" id="btn-growth" onclick="togglePopMenu('growth')"><span>âœ¨</span>ì„±ì¥/ìƒì </button>
            </div>
            <div id="pop-menu" class="popover-menu"></div>
        </div>
        
        <div id="content-area" class="game-area" onclick="closePopMenu()">
            <div class="start-screen"><div class="start-icon">ğŸ‘†</div><p>ë©”ë‰´ë¥¼ ì„ íƒí•´ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</p></div>
        </div>
    </div>
</div>

<script>
    // --- ìœ í‹¸ë¦¬í‹° ---
    function showMsg(m){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML=m; b.innerHTML=`<button onclick="closeModal()">í™•ì¸</button>`;
        o.style.display='flex';
    }
    function showConfirm(m,y){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML=m; b.innerHTML=`<button onclick="closeModal()" class="btn-outline" style="background:#f3f4f6;">ì·¨ì†Œ</button><button id="modal-yes-btn">í™•ì¸</button>`;
        document.getElementById('modal-yes-btn').onclick=function(){closeModal();y();};
        o.style.display='flex';
    }
    function closeModal(){document.getElementById('modal-overlay').style.display='none';}
    function showToast(title, msg, icon="ğŸ””"){
        const c = document.getElementById('toast-container');
        const d = document.createElement('div');
        d.className = 'toast';
        d.innerHTML = `<div class="toast-icon">${icon}</div><div class="toast-content"><b>${title}</b><span>${msg}</span></div>`;
        c.appendChild(d);
        setTimeout(()=>d.remove(), 3000);
    }
	
	function handleOverlayClick(){
		const gachaUI = document.getElementById('gacha-ui');
		const gachaConfirm = document.getElementById('gacha-confirm');
		
		// ëŸ­í‚¤ë°•ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì´ë©´ (gacha-uiê°€ ë³´ì´ê³ , í™•ì¸ ë²„íŠ¼ì´ ì•„ì§ ì•ˆ ë³´ì¼ ë•Œ)
		if(gachaUI.style.display === 'block' && gachaConfirm.style.display === 'none'){
			// ë°”ë¡œ ê²°ê³¼ í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜ ìŠ¤í‚µ)
			skipLuckyBoxAnimation();
		} else {
			closeModal();
		}
	}

	let luckyBoxTimeout = null;

	function skipLuckyBoxAnimation(){
		if(luckyBoxTimeout) {
			clearTimeout(luckyBoxTimeout);
			luckyBoxTimeout = null;
		}
		executeLuckyBoxResult();
	}

	function executeLuckyBoxResult(){
		const icon = document.getElementById('gacha-icon');
		const msg = document.getElementById('gacha-msg');
		const btn = document.getElementById('gacha-confirm');
		
		gameData.inventory.luckyBox--; 
		gameData.stats.luckyBoxOpens++; 
		const r = Math.random() * 100;
		let res = "", log = "", resIcon = ""; 
		icon.className = "gacha-box pop-result"; 
		
		if(r < 50) { resIcon = "ğŸ’¨"; res = "ê½!"; log="ì•„ë¬´ê²ƒë„ ì—†ì—ˆë‹¤..."; msg.style.color="#9ca3af"; gameData.stats.luckyBoxFail++; }
		else if(r < 75) { let m = 5000 + Math.floor(Math.random()*5001); gameData.money+=m; resIcon = "ğŸ—‘ï¸"; res = "ì¡ë™ì‚¬ë‹ˆ ë°œê²¬"; log=`+${m}ì›`; msg.style.color="#6b7280"; }
		else if(r < 90) { let m = 20000 + Math.floor(Math.random()*30001); gameData.money+=m; resIcon = "ğŸ’µ"; res = "ë¹„ìƒê¸ˆ ë°œê²¬!"; log=`+${m.toLocaleString()}ì›`; msg.style.color="var(--success)"; }
		else if(r < 95) { gameData.inventory.diceWin++; resIcon="ğŸ²"; res="ìŠ¹ë¦¬ì˜ ì£¼ì‚¬ìœ„!"; log="íšë“!"; msg.style.color="var(--purple)"; }
		else if(r < 98) { gameData.inventory.bjCard++; resIcon="ğŸƒ"; res="ë”œëŸ¬ ì œì•½ ì¹´ë“œ!"; log="íšë“!"; msg.style.color="var(--purple)"; }
		else if(r < 99.5) { gameData.inventory.magnet++; resIcon="ğŸ§²"; res="ë£°ë › ìì„!"; log="íšë“!"; msg.style.color="var(--gold)"; }
		else { gameData.money+=500000; resIcon="ğŸ’"; res="ëŒ€ë°•!"; log="í˜„ê¸ˆ 50ë§Œì›!"; msg.style.color="#ec4899"; icon.style.textShadow="0 0 20px rgba(236, 72, 153, 0.5)"; gameData.stats.luckyBoxJackpot++; }
		
		icon.innerText = resIcon; 
		
		// ë‚¨ì€ ëŸ­í‚¤ë°•ìŠ¤ê°€ ìˆìœ¼ë©´ ì¶”ê°€ ì‚¬ìš© ì•ˆë‚´
		if(gameData.inventory.luckyBox > 0){
			msg.innerHTML = `<span style="font-size:1.2rem">${res}</span><br><span style="font-size:0.9rem; color:#555; font-weight:normal;">${log}</span><br><span style="font-size:0.8rem; color:var(--primary); margin-top:5px;">ğŸ“¦ ë‚¨ì€ ëŸ­í‚¤ë°•ìŠ¤: ${gameData.inventory.luckyBox}ê°œ</span>`;
			btn.innerText = "í•œ ê°œ ë” ì—´ê¸°";
			btn.onclick = function(){ openLuckyBoxUI(); };
		} else {
			msg.innerHTML = `<span style="font-size:1.2rem">${res}</span><br><span style="font-size:0.9rem; color:#555; font-weight:normal;">${log}</span>`;
			btn.innerText = "í™•ì¸";
			btn.onclick = function(){ closeModal(); };
		}
		
		btn.style.display = 'block'; 
		gameData.stats.itemsUsed++; 
		saveData(); 
		checkAchievements();
	}
	
	// --- ëŸ­í‚¤ë°•ìŠ¤ í•œë²ˆì— ê¹Œê¸° ---
	function openBulkLuckyBoxUI(){
		if(gameData.inventory.luckyBox <= 1) return showMsg("ìƒìê°€ 2ê°œ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.");
		
		const totalBoxes = gameData.inventory.luckyBox;
		const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
		c.style.display='block'; g.style.display='none';
		
		const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
		t.innerHTML = `<h3>ğŸ ëŸ­í‚¤ë°•ìŠ¤ ì¼ê´„ ê°œë´‰</h3>
			<p style="margin:15px 0;">
				<span style="font-size:2.5rem;">ğŸ“¦</span><br>
				<b style="font-size:1.2rem;">${totalBoxes}ê°œ</b>ì˜ ëŸ­í‚¤ë°•ìŠ¤ë¥¼<br>ëª¨ë‘ ì—´ê¹Œìš”?
			</p>
			<p style="font-size:0.8rem; color:#6b7280;">ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ì¦‰ì‹œ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>`;
		b.innerHTML = `<button onclick="closeModal()" class="btn-outline">ì·¨ì†Œ</button><button onclick="executeBulkLuckyBox(${totalBoxes})" class="btn-purple">ğŸ ëª¨ë‘ ì—´ê¸°!</button>`;
		o.style.display='flex';
	}

	function executeBulkLuckyBox(count){
		// ê²°ê³¼ ì§‘ê³„ìš©
		const results = {
			money: 0,
			diceWin: 0,
			bjCard: 0,
			magnet: 0,
			fail: 0,
			jackpot: 0
		};
		
		// ëª¨ë“  ë°•ìŠ¤ ê°œë´‰
		for(let i = 0; i < count; i++){
			gameData.inventory.luckyBox--;
			gameData.stats.luckyBoxOpens++;
			gameData.stats.itemsUsed++;
			
			const r = Math.random() * 100;
			
			if(r < 50) { 
				results.fail++; 
				gameData.stats.luckyBoxFail++; 
			}
			else if(r < 75) { 
				let m = 5000 + Math.floor(Math.random()*5001); 
				results.money += m; 
				gameData.money += m; 
			}
			else if(r < 90) { 
				let m = 20000 + Math.floor(Math.random()*30001); 
				results.money += m; 
				gameData.money += m; 
			}
			else if(r < 95) { 
				results.diceWin++; 
				gameData.inventory.diceWin++; 
			}
			else if(r < 98) { 
				results.bjCard++; 
				gameData.inventory.bjCard++; 
			}
			else if(r < 99.5) { 
				results.magnet++; 
				gameData.inventory.magnet++; 
			}
			else { 
				results.jackpot++; 
				results.money += 500000; 
				gameData.money += 500000; 
				gameData.stats.luckyBoxJackpot++; 
			}
		}
		
		// ê²°ê³¼ í‘œì‹œ
		const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
		c.style.display='block'; g.style.display='none';
		const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
		
		let resultHtml = `<h3>ğŸ ê°œë´‰ ê²°ê³¼ (${count}ê°œ)</h3><div style="text-align:left; margin:15px 0; font-size:0.9rem;">`;
		
		if(results.money > 0) resultHtml += `<div style="padding:5px 0; border-bottom:1px solid #eee;">ğŸ’° íšë“ ê¸ˆì•¡: <b style="color:var(--success)">+${results.money.toLocaleString()}ì›</b></div>`;
		if(results.jackpot > 0) resultHtml += `<div style="padding:5px 0; border-bottom:1px solid #eee;">ğŸ’ ëŒ€ë°•: <b style="color:#ec4899">${results.jackpot}íšŒ!</b></div>`;
		if(results.diceWin > 0) resultHtml += `<div style="padding:5px 0; border-bottom:1px solid #eee;">ğŸ² ìŠ¹ë¦¬ì˜ ì£¼ì‚¬ìœ„: <b style="color:var(--purple)">+${results.diceWin}ê°œ</b></div>`;
		if(results.bjCard > 0) resultHtml += `<div style="padding:5px 0; border-bottom:1px solid #eee;">ğŸƒ ë”œëŸ¬ ì œì•½ ì¹´ë“œ: <b style="color:var(--purple)">+${results.bjCard}ê°œ</b></div>`;
		if(results.magnet > 0) resultHtml += `<div style="padding:5px 0; border-bottom:1px solid #eee;">ğŸ§² ë£°ë › ìì„: <b style="color:var(--gold)">+${results.magnet}ê°œ</b></div>`;
		if(results.fail > 0) resultHtml += `<div style="padding:5px 0; color:#9ca3af;">ğŸ’¨ ê½: ${results.fail}íšŒ</div>`;
		
		resultHtml += `</div>`;
		
		t.innerHTML = resultHtml;
		b.innerHTML = `<button onclick="closeModal()" style="width:100%;">í™•ì¸</button>`;
		o.style.display='flex';
		
		saveData();
		checkAchievements();
	}

    // --- íŒì—… ë©”ë‰´ ë¡œì§ ---
    const MENUS = {
        'money': [
            { id: 'alba', name: 'ì•Œë°”', icon: 'ğŸ§¹' },
            { id: 'stock', name: 'ì£¼ì‹', icon: 'ğŸ“ˆ' },
            { id: 'bank', name: 'ì‚¬ì±„', icon: 'ğŸ’¸' }
        ],
        'game': [
			{ id: 'dice', name: 'ì£¼ì‚¬ìœ„', icon: 'ğŸ²' },
			{ id: 'blackjack', name: 'ë¸”ë™ì­', icon: 'ğŸƒ' },
			{ id: 'roulette', name: 'ë£°ë ›', icon: 'ğŸ¡' },
			{ id: 'slots', name: 'ìŠ¬ë¡¯ë¨¸ì‹ ', icon: 'ğŸ°' },
			{ id: 'shell', name: 'ì•¼ë°”ìœ„', icon: 'ğŸ¥œ' },
			{ id: 'rps', name: 'ê°€ìœ„ë°”ìœ„ë³´', icon: 'âœŠ' }
		],
        'growth': [
            { id: 'skills', name: 'ìŠ¤í‚¬', icon: 'ğŸ“' },
            { id: 'shop', name: 'ìƒì ', icon: 'ğŸ›’' },
            { id: 'achievements', name: 'ì—…ì ', icon: 'ğŸ†' }
        ]
    };

    let activePop = null;
    function togglePopMenu(category){
        const pop = document.getElementById('pop-menu');
        const btns = document.querySelectorAll('.menu-btn');
        if(activePop === category){ closePopMenu(); return; }
        btns.forEach(b => b.classList.remove('active-tab'));
        document.getElementById('btn-' + category).classList.add('active-tab');
        pop.innerHTML = '';
        MENUS[category].forEach(item => {
            const btn = document.createElement('div'); btn.className = 'submenu-btn';
            btn.innerHTML = `<span>${item.icon}</span>${item.name}`;
            btn.onclick = () => { openTab(item.id); closePopMenu(); };
            pop.appendChild(btn);
        });
        pop.style.display = 'grid'; activePop = category;
    }
    function closePopMenu(){
        document.getElementById('pop-menu').style.display = 'none'; activePop = null;
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active-tab'));
    }

    // --- ë°ì´í„° ê´€ë¦¬ ---
    let gameData = { 
		nickname: "", money: 10000, debt: 0, lastInterest: 0, jobEndTime: 0, jobHours: 0, level: 1, xp: 0, maxXp: 100, 
		rpsStreak: 0,
        stocks: { "ë„¥ì„œìŠ¤ì½”ì–´": { p: 5500, n: 0 }, "í”„ë¼ì„ë…¸ë“œ": { p: 42000, n: 0 }, "ë„¤ì˜¤ì‹œê·¸ë§ˆ": { p: 150000, n: 0 }, "ì œë¡œì„¹í„°": { p: 1250000, n: 0 } }, 
        stockHistory: [], 
        lastStockUpdate: 0,
        vip: { level: 0, endTime: 0 }, 
        skills: {
            card: 0, dice: 0, roulette: 0, alba: 0, xp: 0,
            diceProb: 0, bjStand: 0, rtProb: 0,
            dicePay: 0, bjPay: 0, rtPay: 0,
            slots: 0, slotProb: 0, slotPay: 0, shell: 0, shellPay: 0, rps: 0, rpsPay: 0
        },
        inventory: { luckyBox: 0, diceWin: 0, bjCard: 0, magnet: 0 },
        stats: { 
            totalWins: 0, totalMoney: 0, itemsUsed: 0, 
            albaCount: 0, stockTrades: 0, loanCount: 0, 
            diceWins: 0, bjWins: 0, rouletteWins: 0,
            luckyBoxOpens: 0, luckyBoxFail: 0, luckyBoxJackpot: 0,
            maxMoney: 10000,
            diceItemUsed: 0, bjItemUsed: 0,
            snakeEyesCount: 0, perfectSixCount: 0, rouletteZeroWins: 0,
            consecutiveLoss: 0, maxConsecutiveLoss: 0,
            // [ì¶”ê°€ëœ í†µê³„ ë³€ìˆ˜ë“¤]
            vipSpent: 0, skillSpent: 0, maxDebt: 0,
            stockBuyCount: 0, stockSellCount: 0,
            rouletteRedWins: 0, totalClicks: 0
        },
        achievements: [], claimedAchievements: [] 
    };
    
    const TITLES = [ "ì´ˆì‹¬ì", "ì•„ë§ˆì¶”ì–´", "ë™ë„¤ íƒ€ì§œ", "í”„ë¡œ ê²œë¸”ëŸ¬", "ì¹´ì§€ë…¸ VIP", "ë„ë°•ì™•", "ì „ì„¤ì˜ ìŠ¹ë¶€ì‚¬", "ìš´ëª…ì˜ ì§€ë°°ì", "ë¯¸ë‹ˆê²Œì„ ì‹ ", "GM" ];
    const VIP_DATA = {
        1: { name: "ë¸Œë¡ ì¦ˆ", cost: 100000, xp: 0.1, rebate: 0, stockMin: 25 },
        2: { name: "ì‹¤ë²„", cost: 500000, xp: 0.15, rebate: 0.05, stockMin: 20 },
        3: { name: "ê³¨ë“œ", cost: 3000000, xp: 0.20, rebate: 0.10, stockMin: 15 },
        4: { name: "í”Œë˜í‹°ë„˜", cost: 10000000, xp: 0.30, rebate: 0.20, stockMin: 10 }
    };
    
    const SKILL_DATA = {
        alba: { name: "ì¬í…Œí¬ ì „ë¬¸ê°€", desc: "ì•Œë°” ê¸‰ì—¬ +5%" },
        xp: { name: "XP ë¶€ìŠ¤í„°", desc: "ëª¨ë“  ê²½í—˜ì¹˜ íšë“ +5%" },
        dice: { name: "ì£¼ì‚¬ìœ„ ë‹¬ì¸", desc: "ì£¼ì‚¬ìœ„ íŒ¨ë°° ì‹œ í™˜ê¸‰ +1%" },
        diceProb: { name: "ì‹ ì˜ ì£¼ì‚¬ìœ„", desc: "ì£¼ì‚¬ìœ„ ìŠ¹ë¥  +1%" },
        dicePay: { name: "ì£¼ì‚¬ìœ„ ì­íŒŸ", desc: "ì£¼ì‚¬ìœ„ ìŠ¹ë¦¬ ìƒê¸ˆ +3%" },
        card: { name: "ì¹´ë“œ ë§ˆìŠ¤í„°", desc: "ë¸”ë™ì­ íŒ¨ë°° ì‹œ í™˜ê¸‰ +1%" },
        bjStand: { name: "ë”œëŸ¬ì˜ ì‹¤ìˆ˜", desc: "ë”œëŸ¬ 15 ìŠ¤íƒ ë“œ í™•ë¥  +2%" },
        bjPay: { name: "ë¸”ë™ì­ ì­íŒŸ", desc: "ë¸”ë™ì­ ìŠ¹ë¦¬ ìƒê¸ˆ +3%" },
        roulette: { name: "ëŸ­í‚¤ ìŠ¤íƒ€", desc: "ë£°ë › íŒ¨ë°° ì‹œ í™˜ê¸‰ +1%" },
        rtProb: { name: "ì˜ˆì§€ë ¥", desc: "ë£°ë › ë‹¹ì²¨ í™•ë¥  +1%" },
        rtPay: { name: "ë£°ë › ì­íŒŸ", desc: "ë£°ë › ìŠ¹ë¦¬ ìƒê¸ˆ +3%" },
        slots: { name: "ìŠ¬ë¡¯ ë§¤ë‹ˆì•„", desc: "ìŠ¬ë¡¯ë¨¸ì‹  íŒ¨ë°° ì‹œ í™˜ê¸‰ +1%" },
        slotProb: { name: "í–‰ìš´ì˜ ë¦´", desc: "ìŠ¬ë¡¯ ìŠ¹ë¥  +1%" },
        slotPay: { name: "ìŠ¬ë¡¯ ì­íŒŸ", desc: "ìŠ¬ë¡¯ ìŠ¹ë¦¬ ìƒê¸ˆ +3%" },
        shell: { name: "ì•¼ë°”ìœ„ ê³ ìˆ˜", desc: "ì•¼ë°”ìœ„ íŒ¨ë°° ì‹œ í™˜ê¸‰ +1%" },
        shellPay: { name: "ì•¼ë°”ìœ„ ì­íŒŸ", desc: "ì•¼ë°”ìœ„ ìŠ¹ë¦¬ ìƒê¸ˆ +3%" },
        rps: { name: "ê°€ìœ„ë°”ìœ„ë³´ ì „ë¬¸", desc: "ê°€ìœ„ë°”ìœ„ë³´ ìŠ¹ë¥  +1%" },
        rpsPay: { name: "ì—°ìŠ¹ ë³´ë„ˆìŠ¤", desc: "ê°€ìœ„ë°”ìœ„ë³´ ìƒê¸ˆ +5%" }
    };

    // --- ëŒ€ê·œëª¨ ì—…ì  ë¦¬ìŠ¤íŠ¸ (í™•ì¥ë¨) ---
    const ACHIEVEMENTS = [
        // [ë ˆë²¨]
        { id: "lv5", name: "ê±¸ìŒë§ˆ", desc: "ë ˆë²¨ 5 ë‹¬ì„±", check: (d)=>d.level>=5 },
        { id: "lv10", name: "ì´ˆë³´ íƒˆì¶œ", desc: "ë ˆë²¨ 10 ë‹¬ì„±", check: (d)=>d.level>=10 },
        { id: "lv20", name: "ì¤‘ìˆ˜", desc: "ë ˆë²¨ 20 ë‹¬ì„±", check: (d)=>d.level>=20 },
        { id: "lv30", name: "ê³ ìˆ˜", desc: "ë ˆë²¨ 30 ë‹¬ì„±", check: (d)=>d.level>=30 },
        { id: "lv40", name: "ì˜ì›…", desc: "ë ˆë²¨ 40 ë‹¬ì„±", check: (d)=>d.level>=40 },
        { id: "lv50", name: "ì§€ë°°ì", desc: "ë ˆë²¨ 50 ë‹¬ì„±", check: (d)=>d.level>=50 },
        { id: "lv60", name: "ì´ˆì›”ì", desc: "ë ˆë²¨ 60 ë‹¬ì„±", check: (d)=>d.level>=60 },
        { id: "lv70", name: "ì‹ í™”", desc: "ë ˆë²¨ 70 ë‹¬ì„±", check: (d)=>d.level>=70 },
        { id: "lv80", name: "ë¶ˆë©¸", desc: "ë ˆë²¨ 80 ë‹¬ì„±", check: (d)=>d.level>=80 },
        { id: "lv90", name: "ì ˆëŒ€ì", desc: "ë ˆë²¨ 90 ë‹¬ì„±", check: (d)=>d.level>=90 },
        { id: "lv100", name: "ë§Œë ™", desc: "ë ˆë²¨ 100 ë‹¬ì„±", check: (d)=>d.level>=100 },

        // [ìì‚°]
        { id: "rich_500k", name: "í‹°ëŒ", desc: "50ë§Œì› ë³´ìœ ", check: (d)=>d.money>=500000 },
        { id: "rich_1m", name: "ë°±ë§Œì¥ì", desc: "100ë§Œì› ë³´ìœ ", check: (d)=>d.money>=1000000 },
        { id: "rich_5m", name: "ì˜¤ë°±ë§Œì¥ì", desc: "500ë§Œì› ë³´ìœ ", check: (d)=>d.money>=5000000 },
        { id: "rich_10m", name: "ì²œë§Œì¥ì", desc: "1,000ë§Œì› ë³´ìœ ", check: (d)=>d.money>=10000000 },
        { id: "rich_50m", name: "ì˜¤ì²œë§Œì¥ì", desc: "5,000ë§Œì› ë³´ìœ ", check: (d)=>d.money>=50000000 },
        { id: "rich_100m", name: "ì–µ ì†Œë¦¬", desc: "1ì–µ ë³´ìœ ", check: (d)=>d.money>=100000000 },
        { id: "rich_500m", name: "ì¤‘ê²¬ê¸°ì—…", desc: "5ì–µ ë³´ìœ ", check: (d)=>d.money>=500000000 },
        { id: "rich_1b", name: "ë¹Œë¦¬ì–´ë„¤ì–´", desc: "10ì–µ ë³´ìœ ", check: (d)=>d.money>=1000000000 },
        { id: "rich_10b", name: "ì¬ë²Œ", desc: "100ì–µ ë³´ìœ ", check: (d)=>d.money>=10000000000 },
        { id: "rich_1t", name: "ì›”ë“œí´ë˜ìŠ¤", desc: "1ì¡° ë³´ìœ ", check: (d)=>d.money>=1000000000000 },
        { id: "money_pi", name: "ìˆ˜í•™ì", desc: "ì†Œì§€ê¸ˆì´ 31415... ì‹œì‘", check: (d)=>String(Math.floor(d.money)).startsWith("31415") },
        { id: "money_lucky", name: "ëŸ­í‚¤ê°€ì´", desc: "ì†Œì§€ê¸ˆ 77777... ì‹œì‘", check: (d)=>String(Math.floor(d.money)).startsWith("77777") },

        // [ë¹š]
        { id: "debt_start", name: "ì‹ ìš© ì‚¬íšŒ", desc: "ì²« ëŒ€ì¶œ ì‹¤í–‰", check: (d)=>d.stats.loanCount>=1 },
        { id: "debt_10m", name: "ë¹šìŸì´", desc: "ë¹š 1,000ë§Œì› ëŒíŒŒ", check: (d)=>d.debt>=10000000 },
        { id: "debt_100m", name: "íŒŒì‚° ì§ì „", desc: "ë¹š 1ì–µ ëŒíŒŒ", check: (d)=>d.debt>=100000000 },
        { id: "debt_1b", name: "ì–´ê¹¨ê°€ ë¬´ê²ë‹¤", desc: "ë¹š 10ì–µ ëŒíŒŒ", check: (d)=>d.debt>=1000000000 },
        { id: "debt_pro", name: "ëŒë ¤ë§‰ê¸°", desc: "ëˆ„ì  ëŒ€ì¶œ 50íšŒ", check: (d)=>d.stats.loanCount>=50 },
        { id: "debt_master", name: "ì‹ ìš© ë¶ˆëŸ‰", desc: "ëˆ„ì  ëŒ€ì¶œ 100íšŒ", check: (d)=>d.stats.loanCount>=100 },
        { id: "phoenix", name: "ë¶ˆì‚¬ì¡°", desc: "ìµœëŒ€ ë¹š 1ì–µ ê¸°ë¡ í›„ ë¹š ì²­ì‚°", check: (d)=>d.debt===0 && d.stats.maxDebt>=100000000 },
        
        // [ì•Œë°”]
        { id: "alba_10", name: "ì•Œë°”ìƒ", desc: "ì•Œë°” 10íšŒ", check: (d)=>d.stats.albaCount>=10 },
        { id: "alba_50", name: "í”„ë¡œ ì•Œë°”ëŸ¬", desc: "ì•Œë°” 50íšŒ", check: (d)=>d.stats.albaCount>=50 },
        { id: "alba_100", name: "ì§ì› ê¸‰", desc: "ì•Œë°” 100íšŒ", check: (d)=>d.stats.albaCount>=100 },
        { id: "alba_500", name: "ì ì¥ë‹˜", desc: "ì•Œë°” 500íšŒ", check: (d)=>d.stats.albaCount>=500 },
        { id: "alba_1000", name: "ë…¸ë™ì˜ ìš”ì •", desc: "ì•Œë°” 1000íšŒ", check: (d)=>d.stats.albaCount>=1000 },
        { id: "night_shift", name: "ì•¼ê°„ ê·¼ë¬´", desc: "ìƒˆë²½ 2~4ì‹œì— ì•Œë°” ì™„ë£Œ", check: (d)=>{ const h=new Date().getHours(); return (h>=2 && h<4) && d.stats.albaCount>0 && d.jobEndTime===0; }},
        { id: "rich_worker", name: "ì·¨ë¯¸ë¡œ ì¼í•¨", desc: "10ì–µ ì´ìƒ ë³´ìœ  ì¤‘ ì•Œë°”", check: (d)=>d.money>=1000000000 && d.stats.albaCount>0 && d.jobEndTime===0 },

        // [ì£¼ì‹]
        { id: "stock_beginner", name: "ì£¼ë¦°ì´", desc: "ì£¼ì‹ ê±°ë˜ 50íšŒ", check: (d)=>d.stats.stockTrades>=50 },
        { id: "stock_trader", name: "íŠ¸ë ˆì´ë”", desc: "ì£¼ì‹ ê±°ë˜ 500íšŒ", check: (d)=>d.stats.stockTrades>=500 },
        { id: "stock_master", name: "ì—¬ì˜ë„ í°ì†", desc: "ì£¼ì‹ ê±°ë˜ 1,000íšŒ", check: (d)=>d.stats.stockTrades>=1000 },
        { id: "stock_sell_king", name: "ì†ì ˆì˜ ë‹¬ì¸", desc: "ë§¤ë„ íšŸìˆ˜ 100íšŒ", check: (d)=>d.stats.stockSellCount>=100 },
        { id: "owner_nexus", name: "ë„¥ì„œìŠ¤ ëŒ€ì£¼ì£¼", desc: "ë„¥ì„œìŠ¤ 1,000ì£¼ ë³´ìœ ", check: (d)=>d.stocks["ë„¥ì„œìŠ¤ì½”ì–´"].n>=1000 },
        { id: "owner_prime", name: "í”„ë¼ì„ ëŒ€ì£¼ì£¼", desc: "í”„ë¼ì„ 500ì£¼ ë³´ìœ ", check: (d)=>d.stocks["í”„ë¼ì„ë…¸ë“œ"].n>=500 },
        { id: "owner_neo", name: "ë„¤ì˜¤ ëŒ€ì£¼ì£¼", desc: "ë„¤ì˜¤ 100ì£¼ ë³´ìœ ", check: (d)=>d.stocks["ë„¤ì˜¤ì‹œê·¸ë§ˆ"].n>=100 },
        { id: "owner_zero", name: "ì œë¡œ ì •ë³µ", desc: "ì œë¡œì„¹í„° 10ì£¼ ë³´ìœ ", check: (d)=>d.stocks["ì œë¡œì„¹í„°"].n>=10 },
        { id: "portfolio", name: "ë¶„ì‚° íˆ¬ì", desc: "ëª¨ë“  ì¢…ëª© 1ì£¼ ì´ìƒ ë³´ìœ ", check: (d)=>Object.values(d.stocks).every(s=>s.n>=1) },

        // [ë„ë°• - ì¢…í•©]
        { id: "win_10", name: "ìš´ìˆ˜ ì¢‹ì€ ë‚ ", desc: "ì´ ìŠ¹ë¦¬ 10íšŒ", check: (d)=>d.stats.totalWins>=10 },
        { id: "win_100", name: "íƒ€ì§œ ì…ë¬¸", desc: "ì´ ìŠ¹ë¦¬ 100íšŒ", check: (d)=>d.stats.totalWins>=100 },
        { id: "win_500", name: "ë² ê°€ìŠ¤ ì „ì„¤", desc: "ì´ ìŠ¹ë¦¬ 500íšŒ", check: (d)=>d.stats.totalWins>=500 },
        { id: "win_1000", name: "ë„ë°•ì˜ ì‹ ", desc: "ì´ ìŠ¹ë¦¬ 1,000íšŒ", check: (d)=>d.stats.totalWins>=1000 },
        { id: "lose_streak_5", name: "ì–µê¹Œ", desc: "5ì—°íŒ¨ ë‹¬ì„±", check: (d)=>d.stats.maxConsecutiveLoss>=5 },
        { id: "lose_streak_10", name: "ë§ˆì´ë„ˆìŠ¤ì˜ ì†", desc: "10ì—°íŒ¨ ë‹¬ì„±", check: (d)=>d.stats.maxConsecutiveLoss>=10 },
        { id: "lose_streak_20", name: "ìì„  ì‚¬ì—…ê°€", desc: "20ì—°íŒ¨ ë‹¬ì„±", check: (d)=>d.stats.maxConsecutiveLoss>=20 },

        // [ì£¼ì‚¬ìœ„]
        { id: "dice_win_50", name: "ì£¼ì‚¬ìœ„ ê³ ìˆ˜", desc: "ì£¼ì‚¬ìœ„ 50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.diceWins>=50 },
        { id: "dice_win_200", name: "ì£¼ì‚¬ìœ„ ì¥ì¸", desc: "ì£¼ì‚¬ìœ„ 200íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.diceWins>=200 },
        { id: "snake_eyes", name: "ìŠ¤ë„¤ì´í¬ ì•„ì´", desc: "1, 1, 1 íŒ¨ë°°", check: (d)=>d.stats.snakeEyesCount>=1 },
        { id: "dice_666", name: "ì•…ë§ˆì˜ ìˆ«ì", desc: "ë…¸í…œ 6, 6, 6 ìŠ¹ë¦¬", check: (d)=>d.stats.perfectSixCount>=1 },
        { id: "dice_item", name: "ì‚¬ê¸° ì£¼ì‚¬ìœ„", desc: "ì•„ì´í…œ 10íšŒ ì‚¬ìš©", check: (d)=>d.stats.diceItemUsed>=10 },

        // [ë¸”ë™ì­]
        { id: "bj_win_50", name: "ì¹´ë“œ ì¹´ìš´íŒ…", desc: "ë¸”ë™ì­ 50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.bjWins>=50 },
        { id: "bj_win_200", name: "í…Œì´ë¸” ì§€ë°°", desc: "ë¸”ë™ì­ 200íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.bjWins>=200 },
        { id: "bj_item", name: "ë°‘ì¥ ë¹¼ê¸°", desc: "ì¹´ë“œ ì•„ì´í…œ 10íšŒ ì‚¬ìš©", check: (d)=>d.stats.bjItemUsed>=10 },
        
        // [ë£°ë ›]
        { id: "rou_win_50", name: "í–‰ìš´ì˜ ë°”í€´", desc: "ë£°ë › 50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.rouletteWins>=50 },
        { id: "rou_win_200", name: "ìš´ëª…ì˜ ì£¼ì¸", desc: "ë£°ë › 200íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.rouletteWins>=200 },
        { id: "rou_zero", name: "0ì˜ ê¸°ì ", desc: "ìˆ«ì 0 ë‹¹ì²¨", check: (d)=>d.stats.rouletteZeroWins>=1 },
        { id: "rou_red_10", name: "ë¹¨ê°„ë§›", desc: "Red ë°°íŒ… ìŠ¹ë¦¬ 10íšŒ", check: (d)=>d.stats.rouletteRedWins>=10 },
        
        // [ìŠ¬ë¡¯ë¨¸ì‹ ]
        { id: "slot_win_10", name: "ìŠ¬ë¡¯ ì…ë¬¸", desc: "ìŠ¬ë¡¯ë¨¸ì‹  10íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.slotsWins>=10 },
        { id: "slot_win_50", name: "ìŠ¬ë¡¯ ë§ˆìŠ¤í„°", desc: "ìŠ¬ë¡¯ë¨¸ì‹  50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.slotsWins>=50 },
        { id: "slot_win_200", name: "ì­íŒŸ í—Œí„°", desc: "ìŠ¬ë¡¯ë¨¸ì‹  200íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.slotsWins>=200 },
        { id: "slot_jackpot", name: "7ï¸âƒ£7ï¸âƒ£7ï¸âƒ£", desc: "ìŠ¬ë¡¯ ì­íŒŸ ë‹¹ì²¨", check: (d)=>d.stats.slotJackpots>=1 },
        
        // [ì•¼ë°”ìœ„]
        { id: "shell_win_10", name: "ê´€ì°°ë ¥", desc: "ì•¼ë°”ìœ„ 10íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.shellWins>=10 },
        { id: "shell_win_50", name: "ì˜ˆë¦¬í•œ ëˆˆ", desc: "ì•¼ë°”ìœ„ 50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.shellWins>=50 },
        { id: "shell_win_100", name: "ì•¼ë°”ìœ„ ê³ ìˆ˜", desc: "ì•¼ë°”ìœ„ 100íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.shellWins>=100 },
        { id: "shell_streak_5", name: "ì—°ì† ì •ë‹µ", desc: "ì•¼ë°”ìœ„ 5ì—°ìŠ¹", check: (d)=>d.stats.shellMaxStreak>=5 },
        
        // [ê°€ìœ„ë°”ìœ„ë³´]
        { id: "rps_win_10", name: "ë¬µì°Œë¹ ", desc: "ê°€ìœ„ë°”ìœ„ë³´ 10íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.rpsWins>=10 },
        { id: "rps_win_50", name: "ê°€ìœ„ë°”ìœ„ë³´ ë‹¬ì¸", desc: "ê°€ìœ„ë°”ìœ„ë³´ 50íšŒ ìŠ¹ë¦¬", check: (d)=>d.stats.rpsWins>=50 },
        { id: "rps_streak_5", name: "5ì—°ìŠ¹", desc: "ê°€ìœ„ë°”ìœ„ë³´ 5ì—°ìŠ¹ ë‹¬ì„±", check: (d)=>d.stats.rpsMaxStreak>=5 },
        { id: "rps_streak_10", name: "10ì—°ìŠ¹", desc: "ê°€ìœ„ë°”ìœ„ë³´ 10ì—°ìŠ¹ ë‹¬ì„±", check: (d)=>d.stats.rpsMaxStreak>=10 },
        { id: "rps_claim_3", name: "ì•ˆì „íŒŒ", desc: "3ì—°ìŠ¹ ìƒê¸ˆ 3íšŒ ìˆ˜ë ¹", check: (d)=>d.stats.rpsClaimed>=3 },
        { id: "rps_big_win", name: "íƒìš•ì˜ ë", desc: "7ì—°ìŠ¹ ì´ìƒ ìƒê¸ˆ ìˆ˜ë ¹", check: (d)=>d.stats.rpsBigWin>=1 },
        
        // [ìƒì  & ì•„ì´í…œ]
        { id: "box_10", name: "ì†Œí™•í–‰", desc: "ëŸ­í‚¤ë°•ìŠ¤ 10íšŒ ì˜¤í”ˆ", check: (d)=>d.stats.luckyBoxOpens>=10 },
        { id: "box_100", name: "ê°€ì±  ì¤‘ë…", desc: "ëŸ­í‚¤ë°•ìŠ¤ 100íšŒ ì˜¤í”ˆ", check: (d)=>d.stats.luckyBoxOpens>=100 },
        { id: "box_500", name: "í°ì†", desc: "ëŸ­í‚¤ë°•ìŠ¤ 500íšŒ ì˜¤í”ˆ", check: (d)=>d.stats.luckyBoxOpens>=500 },
        { id: "box_jackpot", name: "ëŒ€ë°•!", desc: "ëŸ­í‚¤ë°•ìŠ¤ 50ë§Œ ë‹¹ì²¨", check: (d)=>d.stats.luckyBoxJackpot>=1 },
        { id: "vip_user", name: "í‘ìš°", desc: "VIP ëˆ„ì  1ì–µ ì‚¬ìš©", check: (d)=>d.stats.vipSpent>=100000000 },
        { id: "full_inven", name: "í’€ íŒŒë°", desc: "ëª¨ë“  ì•„ì´í…œ 10ê°œì”© ë³´ìœ ", check: (d)=>d.inventory.diceWin>=10 && d.inventory.bjCard>=10 && d.inventory.magnet>=10 },
        
        // [ìŠ¤í‚¬]
        { id: "skill_one_max", name: "ì¥ì¸ ì •ì‹ ", desc: "í•œ ìŠ¤í‚¬ ë§ˆìŠ¤í„°(Lv.10)", check: (d)=>Object.values(d.skills).some(v=>v>=10) },
        { id: "skill_all_5", name: "ë‹¤ì¬ë‹¤ëŠ¥", desc: "ëª¨ë“  ìŠ¤í‚¬ Lv.5 ë‹¬ì„±", check: (d)=>Object.values(d.skills).every(v=>v>=5) },
        { id: "skill_all_max", name: "ê·¸ëœë“œë§ˆìŠ¤í„°", desc: "ëª¨ë“  ìŠ¤í‚¬ ë§ˆìŠ¤í„°", check: (d)=>Object.values(d.skills).every(v=>v>=10) },
        { id: "skill_rich", name: "í•™êµ¬ì—´", desc: "ìŠ¤í‚¬ì— 1ì–µ ì´ìƒ íˆ¬ì", check: (d)=>d.stats.skillSpent>=100000000 },

        // [íˆë“  & ê¸°íƒ€]
        { id: "click_100", name: "ì†ê°€ë½ ìš´ë™", desc: "í™”ë©´ 100ë²ˆ í´ë¦­", check: (d)=>d.stats.totalClicks>=100 },
        { id: "click_1000", name: "ë§ˆìš°ìŠ¤ ë¸Œë ˆì´ì»¤", desc: "í™”ë©´ 1,000ë²ˆ í´ë¦­", check: (d)=>d.stats.totalClicks>=1000 },
        { id: "beggar", name: "ë¬´ì†Œìœ ", desc: "ëˆ 0ì›, ì£¼ì‹ 0ê°œ", check: (d)=>d.money===0 && Object.values(d.stocks).every(s=>s.n===0) },
        { id: "hidden_owl", name: "ì˜¬ë¹¼ë¯¸", desc: "ìƒˆë²½ 3ì‹œì— ì ‘ì†", check: (d)=>new Date().getHours() === 3 },
    ];

    let diceState={step:0,myDice:[],dealerDice:[],bet:0}, bjState={deck:[],playerHand:[],dealerHand:[],bet:0,playing:false,itemUsed:false};
    const HOURLY_WAGE = 10320, JOB_DURATION = 60*60*1000;
    const INTEREST_RATE = 0.05, INTEREST_INTERVAL = 60*1000;

    window.onload=function(){
        // ì „ì—­ í´ë¦­ ì¹´ìš´íŠ¸
        document.addEventListener('click', () => {
            gameData.stats.totalClicks = (gameData.stats.totalClicks || 0) + 1;
        });

        if(localStorage.getItem('rpgGameData')){
            try {
                let l=JSON.parse(localStorage.getItem('rpgGameData'));
                if(!l.inventory) l.inventory = { luckyBox:0, diceWin:0, bjCard:0, magnet:0 }; 
                if(!l.stockHistory) l.stockHistory = []; 

                for(let k in SKILL_DATA){
                    if(l.skills[k] === undefined) l.skills[k] = 0;
                }

                if(l.inventory.xRay !== undefined) { l.inventory.bjCard = (l.inventory.bjCard||0) + l.inventory.xRay; delete l.inventory.xRay; }
                if(l.inventory.goldCharm !== undefined) { l.inventory.magnet = (l.inventory.magnet||0) + l.inventory.goldCharm; delete l.inventory.goldCharm; }
                
                if(!l.stats) l.stats = { totalWins:0, totalMoney:0, itemsUsed:0 };
                
                // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (ìƒˆ ë³€ìˆ˜ ì´ˆê¸°í™”)
                const newStats = ['snakeEyesCount','perfectSixCount','rouletteZeroWins','consecutiveLoss','maxConsecutiveLoss',
                                  'vipSpent','skillSpent','maxDebt','stockBuyCount','stockSellCount','rouletteRedWins','totalClicks'];
                newStats.forEach(k => { if(l.stats[k] === undefined) l.stats[k] = 0; });

                if(!l.claimedAchievements) l.claimedAchievements = [];
                if(l.stats.diceItemUsed === undefined) l.stats.diceItemUsed = 0;
                if(l.stats.bjItemUsed === undefined) l.stats.bjItemUsed = 0;
				if(l.jobHours === undefined) l.jobHours = 1;

                gameData={...gameData, ...l};
                if(gameData.nickname) showGameScreen();
            } catch(e) { console.error(e); localStorage.removeItem('rpgGameData'); }
        }
        setInterval(gameLoop,1000);
        checkAchievements();
    };

    function saveData(){ 
        gameData.money = Math.floor(gameData.money);
        if(gameData.money > gameData.stats.maxMoney) gameData.stats.maxMoney = gameData.money; 
        localStorage.setItem('rpgGameData',JSON.stringify(gameData)); 
        updateUI(); 
    }
    
    function startGame(){
        const n=document.getElementById('nicknameInput').value;
        if(!n)return showMsg("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        gameData.nickname=n; gameData.money=10000;
        saveData(); checkAchievements(); showGameScreen();
    }
    function showGameScreen(){
        document.getElementById('login-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');
        updateUI();
    }
    function gainXP(baseXP){
        if(baseXP<=0) return;
        let multi = 1;
        if(isVipActive()) multi += VIP_DATA[gameData.vip.level].xp;
        if(gameData.skills.xp > 0) multi += (gameData.skills.xp * 0.05);
        if(gameData.vip.level === 4) multi += 0.03;
        gameData.xp += Math.floor(baseXP * multi);
        if(gameData.xp >= gameData.maxXp){
            gameData.xp -= gameData.maxXp; gameData.level++; gameData.maxXp = Math.floor(gameData.maxXp * 1.5);
            showMsg(`ğŸ‰ <b>ë ˆë²¨ ì—…!</b><br>Lv.${gameData.level} ë‹¬ì„±!`);
            checkAchievements();
        }
        saveData();
    }
    function isVipActive(){ return gameData.vip.level > 0 && Date.now() < gameData.vip.endTime; }
    
    function checkAchievements(){
        let changed = false;
        ACHIEVEMENTS.forEach(ac => {
            if(!gameData.achievements.includes(ac.id) && ac.check(gameData)){
                gameData.achievements.push(ac.id);
                showToast("ğŸ† ì—…ì  ë‹¬ì„±!", ac.name);
                changed = true;
                if(document.getElementById('content-area').innerHTML.includes('ì—…ì  í˜„í™©')) openTab('achievements');
            }
        });
        if(changed) saveData();
    }

    // --- [ì¶”ê°€] ì•¼ê°„ ì‹œê°„ íŒë³„ í•¨ìˆ˜ (ì˜¤í›„ 10ì‹œ ~ ì˜¤ì „ 6ì‹œ) ---
    function isNightTime(timestamp) {
        const h = new Date(timestamp).getHours();
        return h >= 22 || h < 6;
    }
	
	// [ìˆ˜ì •] ì•¼ê°„ ì‹œê°„(22ì‹œ~06ì‹œ)ì´ ëª‡ ì‹œê°„ í¬í•¨ë˜ì—ˆëŠ”ì§€ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜
	function getNightHourCount(endTime, totalHours) {
		let nightCount = 0;
		const oneHourMs = 60 * 60 * 1000;
		// ì‹œì‘ ì‹œê°„ ì—­ì‚°
		const startTime = endTime - (totalHours * oneHourMs);

		for (let i = 0; i < totalHours; i++) {
			// ê° ê·¼ë¬´ ì‹œê°„ì˜ ì‹œì‘ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹œê°„ í™•ì¸
			// (ì˜ˆ: 21:00~22:00 ê·¼ë¬´ë¼ë©´ 21ì‹œë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨)
			let checkTime = new Date(startTime + (i * oneHourMs));
			let h = checkTime.getHours();
			
			// 22ì‹œ ì´ìƒì´ê±°ë‚˜ 6ì‹œ ë¯¸ë§Œì´ë©´ ì•¼ê°„ ì‹œê°„ìœ¼ë¡œ ì¸ì •
			if (h >= 22 || h < 6) {
				nightCount++;
			}
		}
		return nightCount;
	}

    function gameLoop(){
        const now = Date.now();
        
        // gameLoop ë‚´ë¶€ì˜ ì•Œë°” ì™„ë£Œ ë¡œì§ ìˆ˜ì • ë¶€ë¶„
		if(gameData.jobEndTime > 0 && now >= gameData.jobEndTime){
		let hours = gameData.jobHours || 1;
		let baseWage = HOURLY_WAGE; // ê¸°ë³¸ ì‹œê¸‰
		
		// ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ
		const alarmSound = document.getElementById('alarm-sound');
		if(alarmSound) {
			alarmSound.volume = 0.5;
			alarmSound.play().catch(e => console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
		}
		
		// 1. ìŠ¤í‚¬ ë³´ë„ˆìŠ¤ ì ìš© (ê¸°ë³¸ ì‹œê¸‰ ìƒìŠ¹)
		if(gameData.skills.alba > 0) baseWage += Math.floor(baseWage * (gameData.skills.alba * 0.05));
		
		// 2. [ìˆ˜ì •] ì•¼ê°„/ì£¼ê°„ ì‹œê°„ ë¶„ë¦¬ ê³„ì‚°
		let nightHours = getNightHourCount(gameData.jobEndTime, hours);
		let dayHours = hours - nightHours;

		// ì£¼ê°„ ê¸‰ì—¬ + ì•¼ê°„ ê¸‰ì—¬(1.5ë°°)
		let totalWage = (dayHours * baseWage) + (nightHours * Math.floor(baseWage * 1.5));

		gameData.money += totalWage; 
		gameData.jobEndTime = 0; 
		gameData.jobHours = 0; 
		gameData.stats.albaCount++; 
		
		gainXP(10 * hours); 
		
		// ë©”ì‹œì§€ ìƒì„±
		let nightMsg = nightHours > 0 ? ` <span style="color:#a855f7; font-weight:bold;">(ğŸŒ™ì•¼ê°„ ${nightHours}ì‹œê°„)</span>` : "";
		
		showMsg(`ğŸ’° <b>ì•„ë¥´ë°”ì´íŠ¸ ì™„ë£Œ!</b>${nightMsg}<br>${hours}ì‹œê°„ ê·¼ë¬´ ìˆ˜ë‹¹<br><span style="color:var(--success); font-size:1.2rem;">+${totalWage.toLocaleString()}ì›</span> ì…ê¸ˆ`);
		checkAchievements();
		saveData(); 
		if(document.getElementById('content-area').innerHTML.includes('ì•Œë°”ì²œêµ­')) openTab('alba');
	}
        
        let intervalMin = isVipActive() ? VIP_DATA[gameData.vip.level].stockMin : 30;
        let intervalMs = intervalMin * 60 * 1000;
        let lastBlock = Math.floor(gameData.lastStockUpdate / intervalMs);
        let currentBlock = Math.floor(now / intervalMs);
        if(currentBlock > lastBlock){
            for(let k in gameData.stocks){
                let c = (Math.random() * 0.2) - 0.1;
                gameData.stocks[k].p = Math.max(100, Math.floor(gameData.stocks[k].p * (1 + c)));
            }
            gameData.lastStockUpdate = now; 
            checkAchievements();
            saveData();
            if(document.getElementById('content-area').innerHTML.includes('ì£¼ì‹ ì‹œì¥')) openTab('stock');
        }
        const timerEl = document.getElementById('stock-timer');
        if(timerEl) {
            const nextTime = (currentBlock + 1) * intervalMs; const diff = nextTime - now;
            if(diff > 0){ const min = Math.floor(diff / 60000); const sec = Math.floor((diff % 60000) / 1000); timerEl.innerText = `(ê°±ì‹ : ${min}:${sec < 10 ? '0'+sec : sec})`; } else { timerEl.innerText = "(ê°±ì‹  ì¤‘...)"; }
        }
        if(gameData.debt > 0) {
            const passedTime = now - gameData.lastInterest;
            if(passedTime >= INTEREST_INTERVAL){
                const intervals = Math.floor(passedTime / INTEREST_INTERVAL); const oldDebt = gameData.debt;
                gameData.debt = Math.floor(gameData.debt * Math.pow(1 + INTEREST_RATE, intervals));
                gameData.lastInterest += intervals * INTEREST_INTERVAL;
                showMsg(`ğŸ“‰ <b>ì´ì í­íƒ„!</b><br>${intervals}ë¶„ì¹˜ ì´ì (+${(gameData.debt - oldDebt).toLocaleString()}ì›)`);
                saveData(); if(document.getElementById('content-area').innerHTML.includes('ëŒ€ì¶œê¸ˆ')) openTab('bank');
                checkAchievements();
            }
        }
        if(gameData.vip.level > 0 && now > gameData.vip.endTime){ showMsg(`ğŸ“¢ <b>VIP ë©¤ë²„ì‹­ ë§Œë£Œ</b><br>í˜œíƒì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`); gameData.vip.level = 0; saveData(); }
        updateUI();
    }

    function updateUI(){
        document.getElementById('user-info').innerText = gameData.nickname;
        document.getElementById('current-money').innerText = Math.floor(gameData.money).toLocaleString();
        const vipBadge = document.getElementById('vip-badge');
        if(isVipActive()){
            vipBadge.style.display = 'block'; vipBadge.className = 'vip-badge ' + (gameData.vip.level >= 3 ? 'vip-gold' : '');
            if(gameData.vip.level === 4) vipBadge.classList.add('vip-plat'); vipBadge.innerText = `VIP ${VIP_DATA[gameData.vip.level].name}`;
        } else vipBadge.style.display = 'none';
        const debtDiv = document.getElementById('debt-display');
        if(gameData.debt > 0){ debtDiv.style.display = 'block'; document.getElementById('current-debt').innerText = gameData.debt.toLocaleString(); } else debtDiv.style.display = 'none';
        let t = Math.floor(gameData.level / 10); if(t >= TITLES.length) t = TITLES.length - 1;
        document.getElementById('user-title').innerText = `Lv.${gameData.level} ${TITLES[t]}`;
        document.getElementById('cur-xp').innerText = Math.floor(gameData.xp);
        document.getElementById('max-xp').innerText = Math.floor(gameData.maxXp);
        document.getElementById('xp-bar').style.width = `${Math.min(100, (gameData.xp / gameData.maxXp) * 100)}%`;
        const m = document.getElementById('status-msg');
        let statusText = "";
        if(Date.now() < gameData.jobEndTime) statusText = `â³ ì•Œë°” ì¤‘... ${Math.ceil((gameData.jobEndTime - Date.now()) / 1000)}ì´ˆ`;
        m.innerText = statusText;
        updateItemToggles();
    }
    
    // --- ì¸ë²¤í† ë¦¬ & ì•„ì´í…œ í† ê¸€ ---
    function openInventory(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        
        const lbCount = gameData.inventory.luckyBox;
		const lbBtn = lbCount > 0 ? `<button onclick="openLuckyBoxUI()" style="width:auto; padding:4px 10px; font-size:0.75rem;">1ê°œ</button>` : '';
		const lbBulkBtn = lbCount > 1 ? `<button onclick="openBulkLuckyBoxUI()" style="width:auto; padding:4px 10px; font-size:0.75rem; background:var(--purple);">ëª¨ë‘(${lbCount})</button>` : '';

		t.innerHTML = `<h3>ğŸ’ ë‚´ ê°€ë°©</h3>
		<div style="text-align:left; margin-top:10px;">
			<div class="inv-item-row">
				<span class="inv-item-name">ğŸ“¦ ëŸ­í‚¤ë°•ìŠ¤</span>
				<div style="display:flex; align-items:center; gap:5px;">
					<span class="inv-item-cnt">${lbCount}ê°œ</span>
					${lbBtn}${lbBulkBtn}
				</div>
			</div>
            <div class="inv-item-row"><span class="inv-item-name">ğŸ² ìŠ¹ë¦¬ì˜ ì£¼ì‚¬ìœ„</span><span class="inv-item-cnt">${gameData.inventory.diceWin}ê°œ</span></div>
            <div class="inv-item-row"><span class="inv-item-name">ğŸƒ ë”œëŸ¬ ì œì•½ ì¹´ë“œ</span><span class="inv-item-cnt">${gameData.inventory.bjCard}ê°œ</span></div>
            <div class="inv-item-row"><span class="inv-item-name">ğŸ§² ë£°ë › ìì„</span><span class="inv-item-cnt">${gameData.inventory.magnet}ê°œ</span></div>
        </div>`;
        b.innerHTML = `<button onclick="closeModal()" style="width:100%;">ë‹«ê¸°</button>`;
        o.style.display='flex';
    }

    function updateItemToggles(){
        const diceToggle = document.getElementById('use-dice-item-check');
        const diceLabel = document.getElementById('use-dice-item-label');
        if(diceToggle && diceLabel){
            const cnt = gameData.inventory.diceWin;
            diceLabel.innerText = `ğŸ² ìŠ¹ë¦¬ ì£¼ì‚¬ìœ„ (${cnt})`;
            if(cnt <= 0) { diceToggle.checked = false; diceToggle.disabled = true; diceLabel.parentElement.classList.add('disabled'); }
            else { diceToggle.disabled = false; diceLabel.parentElement.classList.remove('disabled'); }
        }
        const bjToggle = document.getElementById('use-bj-item-check');
        const bjLabel = document.getElementById('use-bj-item-label');
        if(bjToggle && bjLabel){
            const cnt = gameData.inventory.bjCard;
            bjLabel.innerText = `ğŸƒ ë”œëŸ¬ ì œì•½ (${cnt})`;
            if(cnt <= 0) { bjToggle.checked = false; bjToggle.disabled = true; bjLabel.parentElement.classList.add('disabled'); }
            else { bjToggle.disabled = false; bjLabel.parentElement.classList.remove('disabled'); }
        }
        const rtToggle = document.getElementById('use-rt-item-check');
        const rtLabel = document.getElementById('use-rt-item-label');
        if(rtToggle && rtLabel){
            const cnt = gameData.inventory.magnet;
            rtLabel.innerText = `ğŸ§² ìì„ (${cnt})`;
            if(cnt <= 0) { rtToggle.checked = false; rtToggle.disabled = true; rtLabel.parentElement.classList.add('disabled'); }
            else { rtToggle.disabled = false; rtLabel.parentElement.classList.remove('disabled'); }
        }
    }

    function openTab(t){
		const c = document.getElementById('content-area'); c.innerHTML = ""; c.className = "game-area fade-in";
		switch(t){
			case 'alba': renderAlba(c); break;
			case 'stock': renderStock(c); break;
			case 'dice': renderDice(c); break;
			case 'blackjack': renderBlackjack(c); break;
			case 'roulette': renderRoulette(c); break;
			case 'slots': slotsTab(); break;
			case 'shell': shellTab(); break;
			case 'rps': rpsTab(); break;
			case 'bank': renderBank(c); break;
			case 'skills': renderSkills(c, true); break;
			case 'shop': renderShop(c); break;
			case 'achievements': renderAchievements(c); break;
		}
		updateItemToggles();
	}

    function processResult(win, bet, payoutMult, gameType){
        let resultValue = 0;

        if(win){
            let bonusMult = 0;
            if(gameType === 'dice' && gameData.skills.dicePay > 0) bonusMult = gameData.skills.dicePay * 0.03;
            if(gameType === 'blackjack' && gameData.skills.bjPay > 0) bonusMult = gameData.skills.bjPay * 0.03;
            if(gameType === 'roulette' && gameData.skills.rtPay > 0) bonusMult = gameData.skills.rtPay * 0.03;
            
            let totalMult = payoutMult * (1 + bonusMult);
            let profit = Math.floor(bet * totalMult);
            
            gameData.money += profit; 
            gameData.stats.totalWins++; 
            gameData.stats.consecutiveLoss = 0;
            resultValue = profit;
        } else {
            let rebateRate = 0;
            if(isVipActive()) rebateRate += VIP_DATA[gameData.vip.level].rebate;
            if(gameType === 'blackjack' && gameData.skills.card > 0) rebateRate += (gameData.skills.card * 0.01);
            if(gameType === 'dice' && gameData.skills.dice > 0) rebateRate += (gameData.skills.dice * 0.01);
            if(gameType === 'roulette' && gameData.skills.roulette > 0) rebateRate += (gameData.skills.roulette * 0.01);
            
            if(rebateRate > 0){ 
                const rebate = Math.floor(bet * rebateRate); 
                gameData.money += rebate; 
                resultValue = -1 * rebate; 
            }
            
            gameData.stats.consecutiveLoss = (gameData.stats.consecutiveLoss || 0) + 1;
            if(gameData.stats.consecutiveLoss > gameData.stats.maxConsecutiveLoss) {
                gameData.stats.maxConsecutiveLoss = gameData.stats.consecutiveLoss;
            }
        }
        checkAchievements(); 
        return resultValue;
    }

    // --- ë Œë”ë§ í•¨ìˆ˜ë“¤ ---
    function renderShop(c, keepScroll = false){
        let oldScroll = 0; if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        let itemsHtml = `<div class="shop-item" style="border-color:var(--primary); background:#fdfeff;"><div class="shop-info"><h4>ğŸ ëŸ­í‚¤ë°•ìŠ¤</h4><p>50% ê½, ëŒ€ë°•ì˜ ê¸°íšŒ!</p></div><button class="btn-success shop-btn" onclick="buyBox()">â‚©50,000</button></div>`;
        for(let lv=1; lv<=4; lv++){ let v = VIP_DATA[lv]; itemsHtml += `<div class="shop-item"><div class="shop-info"><h4>${v.name} ë©¤ë²„ì‹­ (30ë¶„)</h4><p>XP+${v.xp*100}%, í™˜ê¸‰ ${v.rebate*100}%, ì£¼ì‹ ${v.stockMin}ë¶„</p></div><button class="shop-btn" onclick="buyVip(${lv})">â‚©${(v.cost/10000).toLocaleString()}ë§Œ</button></div>`; }
        c.innerHTML = `<div class="full-height-layout"><h3>ğŸ›’ ì•„ì´í…œ ìƒì </h3><div class="scroll-view">${itemsHtml}</div></div>`;
        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    function buyBox(){
        if(gameData.money < 50000) return showMsg("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        gameData.money -= 50000; gameData.inventory.luckyBox++; saveData(); showToast("êµ¬ë§¤ ì™„ë£Œ", "ëŸ­í‚¤ë°•ìŠ¤ +1"); renderShop(document.getElementById('content-area'), true);
        checkAchievements();
    }
    function openLuckyBoxUI(){
		if(gameData.inventory.luckyBox <= 0) return showMsg("ìƒìê°€ ì—†ìŠµë‹ˆë‹¤.");
		const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
		const icon=document.getElementById('gacha-icon'), msg=document.getElementById('gacha-msg'), btn=document.getElementById('gacha-confirm');
		c.style.display='none'; g.style.display='block'; o.style.display='flex';
		icon.innerText = "ğŸ"; icon.className = "gacha-box shake-box"; icon.style.textShadow = "none"; msg.innerText = "ë‘ê·¼ë‘ê·¼..."; msg.style.color = "var(--primary)"; btn.style.display = 'none';
		
		luckyBoxTimeout = setTimeout(()=>{
			luckyBoxTimeout = null;
			executeLuckyBoxResult();
		}, 2000);
	}
    function buyVip(lv){
        if(gameData.money < VIP_DATA[lv].cost) return showMsg("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        showConfirm(`${VIP_DATA[lv].name} ë©¤ë²„ì‹­ì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, ()=>{
            gameData.money -= VIP_DATA[lv].cost; 
            gameData.stats.vipSpent = (gameData.stats.vipSpent || 0) + VIP_DATA[lv].cost;
            gameData.vip.level = lv; gameData.vip.endTime = Date.now() + (30 * 60 * 1000);
            saveData(); showMsg(`${VIP_DATA[lv].name} í˜œíƒì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!`); renderShop(document.getElementById('content-area'), true);
            checkAchievements();
        });
    }

    function renderSkills(c, keepScroll = false){
        let oldScroll = 0; 
        if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        
        let h = `<div class="full-height-layout"><h3>ğŸ“ ìŠ¤í‚¬ íŠ¸ë¦¬</h3><div class="scroll-view">`;
        for(let key in SKILL_DATA){
            let lv = gameData.skills[key] || 0; let nextCost = 50000 * Math.pow(2, lv); let max = lv >= 10;
            h += `<div class="skill-item"><div class="skill-header"><b>${SKILL_DATA[key].name}</b><span class="skill-lv">Lv.${lv}/10</span></div><div class="skill-desc">${SKILL_DATA[key].desc}</div><div class="skill-bar-bg"><div class="skill-bar-fill" style="width:${lv*10}%"></div></div><button class="${max?'btn-outline':'btn-primary'} btn-sm" ${max?'disabled':''} onclick="upgradeSkill('${key}', ${nextCost})" style="width:100%;">${max ? 'Mastered' : 'ì—…ê·¸ë ˆì´ë“œ (â‚©'+nextCost.toLocaleString()+')'}</button></div>`;
        }
        c.innerHTML = h + `</div></div>`;

        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    
    function upgradeSkill(key, cost){
        if(gameData.money < cost) return showMsg("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        showConfirm(`'${SKILL_DATA[key].name}' ë ˆë²¨ì—… í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, () => {
            gameData.money -= cost; 
            gameData.stats.skillSpent = (gameData.stats.skillSpent || 0) + cost;
            gameData.skills[key]++; saveData(); 
            showToast("ìŠ¤í‚¬ ì—…ê·¸ë ˆì´ë“œ", `Lv.${gameData.skills[key]} ë‹¬ì„±!`); 
            renderSkills(document.getElementById('content-area'), true);
            checkAchievements();
        });
    }

    function renderAchievements(c, keepScroll = false){
        let oldScroll = 0; if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        let list = "";
        ACHIEVEMENTS.forEach(ac => {
            const isUnlocked = gameData.achievements.includes(ac.id); const isClaimed = gameData.claimedAchievements.includes(ac.id);
            let btn = isClaimed ? `<span style="font-size:0.75rem; font-weight:bold; color:#10b981;">ì™„ë£Œë¨</span>` : isUnlocked ? `<button class="btn-success btn-sm" onclick="claimReward('${ac.id}')">ë³´ìƒ ë°›ê¸°</button>` : `<span style="font-size:0.75rem; color:#9ca3af;">ì§„í–‰ ì¤‘</span>`;
            list += `<div class="ach-item ${isClaimed?'claimed':isUnlocked?'unlocked':''}"><div class="ach-info"><h4>${ac.name}</h4><p>${ac.desc}</p></div><div style="text-align:right;"><div style="font-size:0.7rem; margin-bottom:2px; color:#555;">ë³´ìƒ: ëŸ­í‚¤ë°•ìŠ¤</div>${btn}</div></div>`;
        });
        c.innerHTML = `<div class="full-height-layout"><h3>ğŸ† ì—…ì  í˜„í™© (${gameData.claimedAchievements.length}/${ACHIEVEMENTS.length})</h3><div class="scroll-view">${list}</div></div>`;
        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    function claimReward(id){
        if(gameData.claimedAchievements.includes(id)) return;
        gameData.claimedAchievements.push(id); gameData.inventory.luckyBox++; saveData(); showToast("ë³´ìƒ ìˆ˜ë ¹", "ëŸ­í‚¤ë°•ìŠ¤ 1ê°œê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤."); renderAchievements(document.getElementById('content-area'), true);
    }

	function renderAlba(c){
        const now = Date.now(); 
        const isWorking = gameData.jobEndTime > now;

        if(isWorking) {
            // ... (ê·¼ë¬´ ì¤‘ í™”ë©´ì€ ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼) ...
            const leftMin = Math.ceil((gameData.jobEndTime - now) / 60000);
            c.innerHTML=`<div class="full-height-layout">
                <h3>â³ ê·¼ë¬´ ì¤‘...</h3>
                <div class="start-screen">
                    <div style="font-size:3.5rem; margin-bottom:15px; animation: pulse 2s infinite;">ğŸ§¹</div>
                    <p style="font-size:1rem; font-weight:bold;">ì—´ì‹¬íˆ ì¼í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤!</p>
                    <p style="color:var(--primary); margin-top:5px; font-size:0.9rem;">ë‚¨ì€ ì‹œê°„: ì•½ ${leftMin}ë¶„</p>
                </div>
                <button class="btn-danger" onclick="cancelJob()" style="width:100%; margin-top:auto;">ì¼ ê·¸ë§Œë‘ê¸° (ì¤‘ë„ ì •ì‚°)</button>
            </div>`;
        } else {
            // ê¸°ë³¸ ì‹œê¸‰ ê³„ì‚° (ìŠ¤í‚¬ í¬í•¨)
            let baseWage = HOURLY_WAGE;
            let bonusTag = '';
            if(gameData.skills.alba > 0) {
                baseWage += Math.floor(baseWage * (gameData.skills.alba * 0.05));
                bonusTag = `<span class="bonus-badge">+${gameData.skills.alba*5}%</span>`;
            }
            
            c.innerHTML=`
            <div class="alba-container">
                <h3 style="margin:0 0 10px 0; font-size:1.1rem;">ğŸª ì•Œë°”ì²œêµ­</h3>
                
                <div class="alba-dashboard">
                    <div class="stats-grid">
                        <div class="stat-item" style="border-right:1px solid #f1f3f5;">
                            <div class="stat-label">ê¸°ë³¸ ì‹œê¸‰</div>
                            <div class="stat-value">${baseWage.toLocaleString()} ${bonusTag}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ì˜ˆìƒ ìˆ˜ë ¹ì•¡</div>
                            <div class="stat-value highlight" id="alba-total-txt">${baseWage.toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="slider-wrapper">
                        <div class="time-display">
                            <span style="color:#868e96; font-weight:normal;">ê·¼ë¬´ ì‹œê°„</span>
                            <span id="alba-time-badge">1ì‹œê°„</span>
                        </div>
                        <input type="range" id="alba-slider" min="1" max="12" value="1" step="1" class="compact-slider" oninput="updateAlbaPreview(this.value, ${baseWage})">
                        <div style="font-size:0.75rem; text-align:right; color:#adb5bd;">
                            + <span id="alba-xp-txt">10</span> XP íšë“ ì˜ˆì •
                        </div>
                        <div id="night-info" style="font-size:0.75rem; color:#a855f7; text-align:center; margin-top:5px; display:none;">
                            ğŸŒ™ ì•¼ê°„ ìˆ˜ë‹¹ ì ìš© ì˜ˆì • (1.5ë°°)
                        </div>
                    </div>
                </div>

                <div>
                    <button class="btn-primary btn-work" onclick="startJob()">ì¶œê·¼ ë„ì¥ ì°ê¸°! ğŸ”¨</button>
                    <p style="font-size:0.7rem; color:#999; text-align:center; margin-top:5px;">22:00 ~ 06:00 ì¢…ë£Œ ì‹œ ì•¼ê°„ìˆ˜ë‹¹ 1.5ë°°</p>
                </div>
            </div>`;
            // ì´ˆê¸°í™” ì‹œ 1ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì‹¤í–‰
            setTimeout(() => window.updateAlbaPreview(1, baseWage), 0);
        }
    }

    // [ìˆ˜ì •] ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜: ì•¼ê°„/ì£¼ê°„ ì‹œê°„ì„ ë¶„ë¦¬í•˜ì—¬ ì •í™•í•œ ì˜ˆìƒ ê¸ˆì•¡ í‘œì‹œ
	window.updateAlbaPreview = function(val, baseWage) {
		// ì˜ˆìƒ ì¢…ë£Œ ì‹œê°„
		const expectedEndTime = Date.now() + (val * 60 * 60 * 1000);
		
		// ì•¼ê°„ ì‹œê°„ ê³„ì‚°
		const nightHours = getNightHourCount(expectedEndTime, val);
		const dayHours = val - nightHours;

		// ìµœì¢… ê¸ˆì•¡ ê³„ì‚°
		const finalWage = (dayHours * baseWage) + (nightHours * Math.floor(baseWage * 1.5));
		
		let timeLabel = val + "ì‹œê°„";
		const nightInfo = document.getElementById('night-info');

		if(nightHours > 0) {
			timeLabel += " <span style='font-size:0.8rem;'>ğŸŒ™</span>";
			if(nightInfo) {
				nightInfo.style.display = 'block';
				nightInfo.innerHTML = `ğŸŒ™ ì•¼ê°„ ${nightHours}ì‹œê°„ í¬í•¨ (1.5ë°°)`;
			}
		} else {
			if(nightInfo) nightInfo.style.display = 'none';
		}

		document.getElementById('alba-time-badge').innerHTML = timeLabel;
		document.getElementById('alba-total-txt').innerText = finalWage.toLocaleString() + "ì›";
		document.getElementById('alba-xp-txt').innerText = (val * 10);
		
		const slider = document.getElementById('alba-slider');
		if(slider) {
			// ì•¼ê°„ì´ í¬í•¨ë˜ë©´ ë³´ë¼ìƒ‰ ê·¸ë¼ë°ì´ì…˜
			const color = nightHours > 0 ? '#a855f7' : 'var(--primary)';
			const percent = ((val - 1) / (12 - 1)) * 100;
			slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${percent}%, #e9ecef ${percent}%, #e9ecef 100%)`;
		}
	};

	window.updateAlbaPreview = function(val, wage) {
		document.getElementById('alba-time-badge').innerText = val + "ì‹œê°„";
		document.getElementById('alba-total-txt').innerText = (wage * val).toLocaleString() + "ì›";
		document.getElementById('alba-xp-txt').innerText = (val * 10);
		const slider = document.getElementById('alba-slider');
		if(slider) {
			const percent = ((val - 1) / (12 - 1)) * 100;
			slider.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percent}%, #e9ecef ${percent}%, #e9ecef 100%)`;
		}
	};

	function startJob(){
		if(gameData.jobEndTime > Date.now()) return showMsg("ì´ë¯¸ ì•Œë°”ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤!");
		const slider = document.getElementById('alba-slider');
		const hours = slider ? parseInt(slider.value) : 1;
		
		showConfirm(`${hours}ì‹œê°„ ë™ì•ˆ ì•Œë°”ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`, ()=>{ 
			gameData.jobEndTime = Date.now() + (hours * 60 * 60 * 1000);
			gameData.jobHours = hours;
			saveData(); 
			updateUI(); 
			openTab('alba'); 
		});
	}

    function cancelJob(){
        let durationMs = gameData.jobHours * 60 * 60 * 1000;
        let startTime = gameData.jobEndTime - durationMs;
        let elapsed = Date.now() - startTime;
        let hoursDone = Math.floor(elapsed / (60 * 60 * 1000));
        
        let wage = HOURLY_WAGE;
        if(gameData.skills.alba > 0) wage += Math.floor(wage * (gameData.skills.alba * 0.05));
        let payout = wage * hoursDone;

        let msg = hoursDone > 0 
            ? `í˜„ì¬ <b>${hoursDone}ì‹œê°„</b> ê·¼ë¬´í–ˆìŠµë‹ˆë‹¤.<br>ì¤‘ë‹¨ ì‹œ <b>${payout.toLocaleString()}ì›</b>ë§Œ ë°›ê²Œ ë©ë‹ˆë‹¤.` 
            : `ì•„ì§ 1ì‹œê°„ë„ ê·¼ë¬´í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì§€ê¸ˆ ê·¸ë§Œë‘ë©´ <b>ìˆ˜ì…ì´ ì—†ìŠµë‹ˆë‹¤.</b>`;

        showConfirm(msg + "<br><br>ì •ë§ ê·¸ë§Œë‘ì‹œê² ìŠµë‹ˆê¹Œ?", () => {
            gameData.money += payout;
            gameData.jobEndTime = 0;
            gameData.jobHours = 0;
            if(hoursDone > 0) {
                 gameData.stats.albaCount++;
                 gainXP(hoursDone * 5); 
            }
            saveData();
            showMsg("ì•Œë°”ë¥¼ ì¤‘ë‹¨í•˜ê³  ì •ì‚°ë°›ì•˜ìŠµë‹ˆë‹¤.");
            openTab('alba');
            checkAchievements();
        });
    }

    function renderStock(c){
        let interval = isVipActive() ? VIP_DATA[gameData.vip.level].stockMin : 30;
        let h = `<div class="full-height-layout">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>ğŸ“ˆ ì£¼ì‹ ì‹œì¥ <span style="font-size:0.7rem; font-weight:normal;">ê°±ì‹ : ${interval}ë¶„</span></h3>
            <button class="btn-sm btn-outline" onclick="showStockHistory()">ğŸ“œ ê¸°ë¡</button>
        </div>
        <div class="scroll-view">`;
        for(let n in gameData.stocks){let s=gameData.stocks[n];h+=`<div class="stock-item"><div class="stock-info"><b>${n}</b><span>${s.p.toLocaleString()}ì›</span></div><div class="stock-cnt">${s.n}ì£¼</div><div class="stock-actions"><button class="btn-outline" onclick="tradeStock('${n}',1)">ë§¤ìˆ˜</button><button class="btn-danger" onclick="tradeStock('${n}',-1)">ë§¤ë„</button></div></div>`;}
        c.innerHTML = h + `</div><p style='text-align:center;font-size:0.75rem;color:#6b7280;background:#f3f4f6;padding:8px;border-radius:10px;'><span id="stock-timer" style="color:var(--primary);font-weight:bold;">(ê³„ì‚° ì¤‘...)</span></p></div>`;
    }
    
    function showStockHistory(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        
        let html = `<h3>ğŸ“œ ê±°ë˜ ë‚´ì—­</h3>`;
        if(!gameData.stockHistory || gameData.stockHistory.length === 0){
            html += `<p style="padding:20px; color:#999;">ê±°ë˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
        } else {
            html += `<div class="history-container"><table class="history-table">
                <thead><tr><th>ì¢…ëª©</th><th>êµ¬ë¶„</th><th>ë‹¨ê°€(ìˆ˜ëŸ‰)</th></tr></thead><tbody>`;
            [...gameData.stockHistory].reverse().forEach(h => {
                html += `<tr>
                    <td>${h.name}</td>
                    <td class="${h.type==='ë§¤ìˆ˜'?'buy':'sell'}">${h.type}</td>
                    <td>${h.price.toLocaleString()}ì› (${h.count}ì£¼)</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        }
        
        t.innerHTML = html;
        b.innerHTML = `<button onclick="closeModal()">ë‹«ê¸°</button>`;
        o.style.display='flex';
    }

    function tradeStock(n,d){
        const p=gameData.stocks[n].p;
        if(d===1&&gameData.money>=p){
            gameData.money-=p; gameData.stocks[n].n++;
            gameData.stats.stockBuyCount = (gameData.stats.stockBuyCount||0) + 1;
            recordStockTrade(n, 'ë§¤ìˆ˜', p);
        }
        else if(d===-1&&gameData.stocks[n].n>0){
            gameData.money+=p; gameData.stocks[n].n--;
            gameData.stats.stockSellCount = (gameData.stats.stockSellCount||0) + 1;
            recordStockTrade(n, 'ë§¤ë„', p);
        }
        else return showMsg("ì”ì•¡/ì£¼ì‹ ë¶€ì¡±");
        gameData.stats.stockTrades++; saveData(); checkAchievements(); openTab('stock');
    }

    function recordStockTrade(name, type, price){
        if(!gameData.stockHistory) gameData.stockHistory = [];
        const last = gameData.stockHistory[gameData.stockHistory.length - 1];
        
        if(last && last.name === name && last.type === type && last.price === price){
            last.count++;
        } else {
            gameData.stockHistory.push({ name: name, type: type, price: price, count: 1, time: Date.now() });
        }
    }

    function renderBank(c){
        const limit = gameData.level * 100000;
        c.innerHTML = `<div class="full-height-layout"><div><h3>ğŸ’¸ ì‚¬ì±„ ì‚¬ë¬´ì†Œ</h3><p style="color:#ef4444; font-weight:bold; font-size:0.85rem;">"ê¸‰ì „ í•„ìš”í•´? ë¶„ë‹¹ 5%ì•¼. ëª» ê°šìœ¼ë©´ ì•Œì§€?"</p></div><div style="flex-grow:1;display:flex;flex-direction:column;justify-content:center;"><div class="bank-info"><span class="compact-label">í˜„ì¬ ëŒ€ì¶œê¸ˆ</span><div class="bank-debt">${gameData.debt.toLocaleString()}ì›</div><span class="bank-limit">ì‹ ìš© í•œë„: ${limit.toLocaleString()}ì› (Lv.${gameData.level})</span></div><div class="input-group"><input type="number" id="loanAmt" placeholder="ê¸ˆì•¡ ì…ë ¥"></div><div style="display:flex;gap:10px;margin-top:10px;"><button class="btn-success" onclick="borrowMoney(${limit})" style="flex:1;">ëŒ€ì¶œí•˜ê¸°</button><button class="btn-danger" onclick="repayMoney()" style="flex:1;">ìƒí™˜í•˜ê¸°</button></div></div></div>`;
    }
    function borrowMoney(limit){
        const amt = Number(document.getElementById('loanAmt').value);
        if(amt <= 0) return showMsg("ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”."); if(gameData.debt + amt > limit) return showMsg("ì‹ ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.");
        if(gameData.debt === 0) gameData.lastInterest = Date.now();
        gameData.money += amt; gameData.debt += amt; 
        
        gameData.stats.maxDebt = Math.max(gameData.stats.maxDebt || 0, gameData.debt);
        gameData.stats.loanCount++; saveData(); checkAchievements();
        showMsg(`${amt.toLocaleString()}ì›ì„ ë¹Œë ¸ìŠµë‹ˆë‹¤.<br><span style='color:red;font-size:0.8rem;'>ì´ì œë¶€í„° 1ë¶„ë§ˆë‹¤ ì´ìê°€ ë¶™ìŠµë‹ˆë‹¤.</span>`); openTab('bank');
    }
    function repayMoney(){
        const amt = Number(document.getElementById('loanAmt').value);
        if(amt <= 0) return showMsg("ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”."); if(amt > gameData.money) return showMsg("ê°€ì§„ ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤."); if(gameData.debt === 0) return showMsg("ê°šì„ ë¹šì´ ì—†ìŠµë‹ˆë‹¤.");
        const pay = Math.min(amt, gameData.debt); gameData.money -= pay; gameData.debt -= pay; saveData(); checkAchievements();
        showMsg(`${pay.toLocaleString()}ì›ì„ ìƒí™˜í–ˆìŠµë‹ˆë‹¤.`); openTab('bank');
    }
    function calcXP(b){return Math.max(1,Math.floor(b/100));} function r(m){return Math.floor(Math.random()*m)+1;}

    // --- ê²Œì„ ë¡œì§ ---
    function renderDice(c){
        c.innerHTML=`<div class="full-height-layout"><div><h3>ğŸ² ì£¼ì‚¬ìœ„</h3><p>ë”œëŸ¬ë³´ë‹¤ ë†’ì€ ìˆ«ìê°€ ë‚˜ì˜¤ë©´ ìŠ¹ë¦¬!</p></div>
        <div id="dice-start" class="start-screen"><div class="start-icon">ğŸ²</div></div>
        <div id="dice-game" style="display:none;flex-grow:1;flex-direction:column;"><div class="game-board"><div class="compact-board"><div class="compact-col"><span class="compact-label">ë”œëŸ¬</span><div id="dd"></div></div><div class="compact-vs"></div><div class="compact-col"><span class="compact-label" style="color:var(--primary)">ë‚˜</span><div id="md"></div></div></div><div id="dm" style="text-align:center;font-weight:bold;height:20px;"></div></div><button id="dn" onclick="diceN()">êµ´ë¦¬ê¸°</button></div>
        
        <div id="dice-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-dice-item"><span class="item-toggle-indicator"></span> <span id="use-dice-item-label">ğŸ² ìŠ¹ë¦¬ ì£¼ì‚¬ìœ„</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="dB" placeholder="ë°°íŒ…ê¸ˆ"><button onclick="diceGo()">ì‹œì‘</button>
            </div>
        </div>
        </div>`; 
    }
    function diceGo(){
        const b=Number(document.getElementById('dB').value); if(b<=0||b>gameData.money)return showMsg('ë°°íŒ…ê¸ˆ í™•ì¸');
        const useItem = document.getElementById('use-dice-item').checked;
        if(useItem && gameData.inventory.diceWin <= 0) return showMsg("ì•„ì´í…œ ë¶€ì¡±");
        gameData.money-=b; 
        if(useItem){ gameData.inventory.diceWin--; gameData.stats.itemsUsed++; gameData.stats.diceItemUsed++; diceState.usedItem = true; } 
        else { diceState.usedItem = false; }
        saveData();
        diceState.step=0; diceState.bet=b; 
        if(diceState.usedItem) { diceState.myDice=[6,6,6]; diceState.dealerDice=[1,1,1]; }
        else { diceState.myDice=[r(6),r(6),r(6)]; diceState.dealerDice=[r(6),r(6),r(6)]; }
        
        document.getElementById('dice-start').style.display='none'; document.getElementById('dice-ctrl').style.display='none'; document.getElementById('dice-game').style.display='flex'; diceN();
    }
    function diceN(){
        diceState.step++;
        
        if(diceState.step === 3 && !diceState.usedItem && gameData.skills.diceProb > 0){
            let mySum = diceState.myDice.reduce((a,b)=>a+b,0);
            let dealerSum = diceState.dealerDice.reduce((a,b)=>a+b,0);
            if(mySum <= dealerSum){
                if(Math.random() < (gameData.skills.diceProb * 0.01)){
                    diceState.dealerDice = [1, 1, 1];
                }
            }
        }

        const dr=(a,s)=>a.map((v,i)=>`<div class="dice-num ${i<s?'':'dice-hidden'}">${i<s?v:'?'}</div>`).join('');
        document.getElementById('dd').innerHTML=dr(diceState.dealerDice,diceState.step); document.getElementById('md').innerHTML=dr(diceState.myDice,diceState.step);
        let b=document.getElementById('dn'),m=document.getElementById('dm');
        if(diceState.step===1){m.innerText="ì²« ë²ˆì§¸ ê³µê°œ";b.innerText="ë‘ ë²ˆì§¸";}
        else if(diceState.step===2){m.innerText="ìŠ¹ë¶€ì˜ ìˆœê°„!";b.innerText="ê²°ê³¼ í™•ì¸";b.className="btn-danger";}
        else{
            let x=diceState.myDice.reduce((a,b)=>a+b,0),y=diceState.dealerDice.reduce((a,b)=>a+b,0);
            
            if(diceState.myDice.every(v=>v===1)) { gameData.stats.snakeEyesCount = (gameData.stats.snakeEyesCount||0) + 1; }
            if(!diceState.usedItem && x===18) { gameData.stats.perfectSixCount = (gameData.stats.perfectSixCount||0) + 1; }

            if(x>y){ 
                let profit=processResult(true,diceState.bet,2,'dice'); gameData.stats.diceWins++; 
                let xp=calcXP(diceState.bet); gainXP(xp); m.innerHTML=`<span style="color:var(--success)">ìŠ¹ë¦¬! +${profit.toLocaleString()}</span> <span class="xp-gain">(+${xp} XP)</span>`; 
            }
            else if(x<y){ let rb=processResult(false,diceState.bet,0,'dice'); m.innerHTML=`<span style="color:var(--danger)">íŒ¨ë°°...</span>${rb<0?` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} í™˜ê¸‰)</span>`:''}`; }
            else{ gameData.money+=diceState.bet; m.innerText="ë¬´ìŠ¹ë¶€ (ë°°íŒ…ê¸ˆ ë°˜í™˜)"; saveData(); }
            b.innerText="ë‹¤ì‹œ í•˜ê¸°"; b.className=""; b.onclick=()=>openTab('dice');
        }
    }
    
    function renderBlackjack(c){ 
        c.innerHTML=`<div class="full-height-layout"><div><h3>ğŸƒ ë¸”ë™ì­</h3><p>21ì„ ë„˜ì§€ ì•Šê³  ë”œëŸ¬ë¥¼ ì´ê¸°ì„¸ìš”.</p></div>
        <div id="bj-start" class="start-screen"><div class="start-icon">ğŸƒ</div></div>
        <div id="bj-game" style="display:none;flex-grow:1;flex-direction:column;"><div class="game-board"><div class="compact-board"><div class="compact-col"><span class="compact-label">ë”œëŸ¬ <span id="bds"></span></span><div id="bdh"></div></div><div class="compact-vs"></div><div class="compact-col"><span class="compact-label" style="color:var(--primary)">ë‚˜ <span id="bms"></span></span><div id="bmh"></div></div></div><div id="br" style="text-align:center;font-weight:bold;height:20px;"></div></div><div id="ba" style="display:flex;gap:8px;flex-wrap:wrap;"><button onclick="hit()" class="btn-success">íˆíŠ¸</button><button onclick="stand()" class="btn-danger">ìŠ¤íƒ ë“œ</button></div></div>
        
        <div id="bj-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-bj-item"><span class="item-toggle-indicator"></span> <span id="use-bj-item-label">ğŸƒ ë”œëŸ¬ ì œì•½</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="bB" placeholder="ë°°íŒ…ê¸ˆ"><button onclick="bjGo()">ì‹œì‘</button>
            </div>
        </div>
        </div>`; 
    }
    function bjGo(){
        const b=Number(document.getElementById('bB').value); if(b<=0||b>gameData.money)return showMsg('ë°°íŒ…ê¸ˆ í™•ì¸');
        const useItem = document.getElementById('use-bj-item').checked;
        if(useItem && gameData.inventory.bjCard <= 0) return showMsg("ì•„ì´í…œ ë¶€ì¡±");
        gameData.money-=b;
        if(useItem){ gameData.inventory.bjCard--; gameData.stats.itemsUsed++; gameData.stats.bjItemUsed++; }
        saveData();
        const s=['â™ ','â™£','â™¥','â™¦'],v=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; let d=[]; for(let i of s)for(let j of v)d.push({s:i,v:j}); d.sort(()=>Math.random()-0.5);
        bjState={deck:d,playerHand:[d.pop(),d.pop()],dealerHand:[d.pop(),d.pop()],bet:b,playing:true, itemUsed: useItem};
        document.getElementById('bj-start').style.display='none'; document.getElementById('bj-ctrl').style.display='none'; document.getElementById('bj-game').style.display='flex';
        upBJ(); if(getBJS(bjState.playerHand)===21){bjState.playing=false;upBJ(true);if(getBJS(bjState.dealerHand)===21)endBJ("í‘¸ì‹œ (ë‘˜ ë‹¤ ë¸”ë™ì­)",1);else endBJ("ğŸ‰ ë¸”ë™ì­!",2.5);}
    }
    function getBJS(h){let s=0,a=0;for(let c of h){if(['J','Q','K'].includes(c.v))s+=10;else if(c.v==='A'){s+=11;a++}else s+=Number(c.v)}while(s>21&&a>0){s-=10;a--}return s;}
    function upBJ(rev=false){
        const dc=(c)=>`<div class="card ${['â™¥','â™¦'].includes(c.s)?'red':''}">${c.s}<br>${c.v}</div>`;
        document.getElementById('bdh').innerHTML = rev ? bjState.dealerHand.map(dc).join('') : dc(bjState.dealerHand[0]) + `<div class="card card-hidden">?</div>`;
        document.getElementById('bds').innerText=rev?getBJS(bjState.dealerHand):"?";
        document.getElementById('bmh').innerHTML=bjState.playerHand.map(dc).join(''); document.getElementById('bms').innerText=getBJS(bjState.playerHand);
    }
    function hit(){if(!bjState.playing)return;bjState.playerHand.push(bjState.deck.pop());upBJ();if(getBJS(bjState.playerHand)>21)endBJ("ë²„ìŠ¤íŠ¸! íŒ¨ë°°");}
    function stand(){
        if(!bjState.playing)return; bjState.playing=false;
        
        let limit = 17;
        if(bjState.itemUsed) limit = 15;
        else if(gameData.skills.bjStand > 0) {
            if(Math.random() < (gameData.skills.bjStand * 0.02)) limit = 15;
        }

        while(getBJS(bjState.dealerHand)<limit)bjState.dealerHand.push(bjState.deck.pop());
        upBJ(true); let p=getBJS(bjState.playerHand),d=getBJS(bjState.dealerHand);
        if(d>21)endBJ("ë”œëŸ¬ ë²„ìŠ¤íŠ¸! ìŠ¹ë¦¬",2);else if(p>d)endBJ("ìŠ¹ë¦¬!",2);else if(p<d)endBJ("íŒ¨ë°°",0);else endBJ("ë¬´ìŠ¹ë¶€",1);
    }
    function endBJ(m,mul=0){
        bjState.playing=false; let profit=0, xp=0;
        if(mul > 1) { profit=processResult(true, bjState.bet, mul, 'blackjack'); gameData.stats.bjWins++; xp=calcXP(bjState.bet); gainXP(xp); }
        else if(mul === 1) { gameData.money += bjState.bet; saveData(); }
        else { let rb = processResult(false, bjState.bet, 0, 'blackjack'); if(rb < 0) m += ` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} í™˜ê¸‰)</span>`; }
        let r=document.getElementById('br'); r.innerHTML=m+(xp>0?` <span class="xp-gain">(+${xp} XP)</span>`:""); r.style.color=mul>1?'var(--success)':mul==0?'var(--danger)':'var(--dark)';
        document.getElementById('ba').innerHTML=`<button onclick="openTab('blackjack')">ë‹¤ì‹œ í•˜ê¸°</button>`; updateUI();
    }
    
    function renderRoulette(c){
        c.innerHTML=`<div class="full-height-layout"><div><h3>ğŸ¡ ë£°ë ›</h3><p>í–‰ìš´ì˜ ìƒ‰ìƒì´ë‚˜ ìˆ«ìë¥¼ ì˜ˆì¸¡í•´ë³´ì„¸ìš”.</p></div>
        <div id="rt-area" style="flex-grow:1;display:flex;flex-direction:column;justify-content:center;"><div style="text-align:center;"><select id="rt" style="margin-bottom:10px;width:100%;"><option value="c">ìƒ‰ìƒ(2ë°°)</option><option value="n">ìˆ«ì(36ë°°)</option></select><div id="ro"></div></div></div>
        <div id="rt-wheel-area" style="display:none;flex-grow:1;justify-content:center;align-items:center;flex-direction:column;"><div class="roulette-wrapper"><div id="rv" class="roulette-wheel">GO</div></div><div id="rr" style="text-align:center;font-weight:bold;height:20px;"></div></div>
        
        <div id="rt-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-rt-item"><span class="item-toggle-indicator"></span> <span id="use-rt-item-label">ğŸ§² ìì„</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="rb" placeholder="ë°°íŒ…ê¸ˆ"><button onclick="rSpin()" class="btn-warning">ëŒë¦¬ê¸°</button>
            </div>
        </div>
        <button id="rt-reset" onclick="openTab('roulette')" style="display:none;width:100%;">ë‹¤ì‹œ í•˜ê¸°</button></div>`;
        window.rtUIChange=function(){const v=document.getElementById('rt').value,a=document.getElementById('ro');if(v==='c'){a.innerHTML=`<div class="rt-choice-box"><label class="rt-radio-label red-opt" onclick="selectRtColor(this)">ğŸŸ¥ Red<input type="radio" name="rk" value="red"></label><label class="rt-radio-label black-opt" onclick="selectRtColor(this)">â¬› Black<input type="radio" name="rk" value="black"></label></div>`;selectRtColor(a.querySelector('.red-opt'));}else{a.innerHTML=`<input type="number" id="rn" min="0" max="36" placeholder="0~36 ìˆ«ì">`;}};document.getElementById('rt').onchange=window.rtUIChange;window.rtUIChange();
    }
    window.selectRtColor=function(e){document.querySelectorAll('.rt-radio-label').forEach(l=>l.classList.remove('selected'));e.classList.add('selected');e.querySelector('input').checked=true;}
    function rSpin(){
        const b=Number(document.getElementById('rb').value),t=document.getElementById('rt').value; if(b<=0||b>gameData.money)return showMsg('ë°°íŒ…ê¸ˆ í™•ì¸');
        const useItem = document.getElementById('use-rt-item').checked;
        if(useItem && gameData.inventory.magnet <= 0) return showMsg("ì•„ì´í…œ ë¶€ì¡±");
        
        let ch; if(t==='c'){const k=document.querySelector('input[name="rk"]:checked');if(!k)return showMsg("ìƒ‰ìƒ ì„ íƒ í•„ìš”");ch=k.value;}else{ch=Number(document.getElementById('rn').value);if(ch<0||ch>36||isNaN(ch))return showMsg('0~36 ìˆ«ì ì…ë ¥');}
        
        gameData.money-=b; 
        if(useItem){ gameData.inventory.magnet--; gameData.stats.itemsUsed++; }
        saveData(); updateUI();
        
        document.getElementById('rt-area').style.display='none';document.getElementById('rt-ctrl').style.display='none';document.getElementById('rt-wheel-area').style.display='flex';
        let cnt=0,el=document.getElementById('rv'),iv=setInterval(()=>{
            let n=r(37)-1,c=n===0?'green':n%2===0?'black':'red';el.innerText=n;el.style.color=c;
            if(++cnt>20){clearInterval(iv);rEnd(n,t,ch,b,useItem);} 
        },80);
    }
    function rEnd(n,t,c,b,useItem){
        if(useItem){
            if(t === 'c'){
                if(Math.random() < 0.9) {
                    if(c === 'red') n = (Math.floor(Math.random() * 18) * 2) + 1; 
                    else n = (Math.floor(Math.random() * 18) * 2) + 2; 
                    if(n>36) n=36;
                }
            } else {
                if(Math.random() < 0.3) n = c;
            }
        } 
        else if(gameData.skills.rtProb > 0){
             let prob = gameData.skills.rtProb * 0.01;
             if(Math.random() < prob){
                 if(t === 'c'){
                    if(c === 'red') n = (Math.floor(Math.random() * 18) * 2) + 1; 
                    else n = (Math.floor(Math.random() * 18) * 2) + 2;
                 } else {
                    n = c;
                 }
             }
        }

        let el=document.getElementById('rv'); el.innerText=n; el.style.color=n===0?'green':n%2!==0?'red':'black';
        let rc=n===0?'green':n%2!==0?'red':'black',w=false,m=0;
        if(t==='c'){if(c===rc){w=true;m=2;}} else{if(c===n){w=true;m=36;}}
        
        if(w && n===0) { gameData.stats.rouletteZeroWins = (gameData.stats.rouletteZeroWins||0) + 1; }
        if(w && t==='c' && c==='red') { gameData.stats.rouletteRedWins = (gameData.stats.rouletteRedWins||0) + 1; }

        if(w){ 
            processResult(true, b, m, 'roulette'); gameData.stats.rouletteWins++; 
            let xp=calcXP(b); gainXP(xp); document.getElementById('rr').innerHTML=`<span style="color:var(--success)">ì¶•í•˜í•©ë‹ˆë‹¤! +${b*m}</span>`; 
        } 
        else { let rb = processResult(false, b, 0, 'roulette'); document.getElementById('rr').innerHTML=`<span style="color:var(--danger)">ê½!</span>${rb<0 ? ` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} í™˜ê¸‰)</span>` : ''}`; }
        document.getElementById('rt-reset').style.display='block';
    }
    
	// --- ìŠ¬ë¡¯ë¨¸ì‹  ---
	
	let slotsSpinning = false;  // ìŠ¬ë¡¯ íšŒì „ ì¤‘ í”Œë˜ê·¸
	
	function slotsTab(){
		const g = document.getElementById('content-area');
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:8px;">
					<h3 style="margin:0 0 3px 0; font-size:1rem;">ğŸ° ìŠ¬ë¡¯ë¨¸ì‹ </h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">3ê°œ ì¼ì¹˜ë¡œ ëŒ€ë°•! 2ê°œ ì¼ì¹˜ëŠ” ë³¸ì „!</p>
				</div>
				<div style="background:linear-gradient(135deg, #1f2937, #374151); padding:12px; border-radius:12px; margin-bottom:8px; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
					<div id="slot-display" style="display:flex; justify-content:center; gap:6px; margin:8px 0;">
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">ğŸ’</div>
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">ğŸ’</div>
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">ğŸ’</div>
					</div>
					<div style="background:rgba(0,0,0,0.3); padding:6px; border-radius:6px; margin-top:8px;">
						<div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; font-size:0.65rem; color:#d1d5db;">
							<div>ğŸ’x3: 1.5ë°°</div>
							<div>ğŸ‹ğŸŠx3: 2ë°°</div>
							<div>ğŸ‡ğŸ’x3: 5ë°°</div>
							<div>7ï¸âƒ£x3: ì­íŒŸ!</div>
						</div>
					</div>
				</div>
				<div id="slot-result" style="text-align:center; min-height:30px; font-weight:bold; margin-bottom:8px; font-size:0.85rem;"></div>
				<div class="input-group" style="margin-top:auto;">
					<input type="number" id="slot-bet" placeholder="ë°°íŒ…ê¸ˆ">
					<button onclick="spinSlots()" class="btn-warning">ğŸ° ëŒë¦¬ê¸°</button>
				</div>
			</div>
		`;
	}

	function spinSlots(){
		if(slotsSpinning) return;  // ì´ë¯¸ íšŒì „ ì¤‘ì´ë©´ ë¬´ì‹œ
		
		const bet = Number(document.getElementById('slot-bet').value);
		if(bet <= 0 || bet > gameData.money) return showMsg('ë°°íŒ…ê¸ˆ í™•ì¸');
		
		slotsSpinning = true;  // íšŒì „ ì‹œì‘
		document.querySelector('.btn-warning').disabled = true;  // ë²„íŠ¼ ë¹„í™œì„±í™”
		
		gameData.money -= bet;
		saveData();
		updateUI();
		
		const symbols = ['ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡', 'ğŸ’', '7ï¸âƒ£'];
		const reels = document.querySelectorAll('.slot-reel');
		const resultDiv = document.getElementById('slot-result');
		resultDiv.innerHTML = '<span style="color:#fbbf24;">ë¦´ì´ ëŒì•„ê°€ëŠ” ì¤‘...</span>';
		
		// ê° ë¦´ì„ ìˆœì°¨ì ìœ¼ë¡œ ë©ˆì¶”ê¸°
		const finalResults = [];
		// ê¸°ë³¸ í™•ë¥ 
				let weights = [0.3, 0.3, 0.2, 0.15, 0.04, 0.01];
				
				// ìŠ¹ë¥  ìŠ¤í‚¬ ì ìš© (ê½ í™•ë¥  ê°ì†Œ, ë‹¹ì²¨ í™•ë¥  ì¦ê°€)
				if(gameData.skills.slotProb > 0) {
					const probBonus = gameData.skills.slotProb * 0.01;
					weights[0] -= probBonus; // ê½ í™•ë¥  ê°ì†Œ
					weights[2] += probBonus * 0.4; // ì²´ë¦¬ í™•ë¥  ì¦ê°€
					weights[3] += probBonus * 0.4; // 2ë°° í™•ë¥  ì¦ê°€
					weights[4] += probBonus * 0.15; // 5ë°° í™•ë¥  ì¦ê°€
					weights[5] += probBonus * 0.05; // ì­íŒŸ í™•ë¥  ì¦ê°€
				}
		const rand = Math.random();
		let cumulative = 0;
		let outcomeType = 0;
		
		for(let i = 0; i < weights.length; i++){
			cumulative += weights[i];
			if(rand < cumulative){
				outcomeType = i;
				break;
			}
		}
		
		if(outcomeType === 0){
			finalResults[0] = symbols[0];
			finalResults[1] = symbols[1];
			finalResults[2] = symbols[2];
		} else if(outcomeType === 1){
			const sym = symbols[Math.floor(Math.random() * 4)];
			finalResults[0] = sym;
			finalResults[1] = sym;
			finalResults[2] = symbols[Math.floor(Math.random() * symbols.length)];
			while(finalResults[2] === sym) finalResults[2] = symbols[Math.floor(Math.random() * symbols.length)];
		} else if(outcomeType === 2){
			finalResults[0] = finalResults[1] = finalResults[2] = 'ğŸ’';
		} else if(outcomeType === 3){
			const sym = Math.random() < 0.5 ? 'ğŸ‹' : 'ğŸŠ';
			finalResults[0] = finalResults[1] = finalResults[2] = sym;
		} else if(outcomeType === 4){
			const sym = Math.random() < 0.5 ? 'ğŸ‡' : 'ğŸ’';
			finalResults[0] = finalResults[1] = finalResults[2] = sym;
		} else {
			finalResults[0] = finalResults[1] = finalResults[2] = '7ï¸âƒ£';
		}
		
		// ê° ë¦´ ì• ë‹ˆë©”ì´ì…˜
		reels.forEach((reel, index) => {
			let count = 0;
			const duration = 15 + (index * 10); // ê° ë¦´ë§ˆë‹¤ ìˆœì°¨ì ìœ¼ë¡œ ë©ˆì¶¤
			const interval = setInterval(() => {
				reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
				reel.style.transform = 'translateY(-10px)';
				setTimeout(() => {
					reel.style.transform = 'translateY(0)';
				}, 50);
				
				if(++count > duration) {
					clearInterval(interval);
					reel.textContent = finalResults[index];
					reel.style.transform = 'scale(1.1)';
					setTimeout(() => {
						reel.style.transform = 'scale(1)';
					}, 200);
					
					// ë§ˆì§€ë§‰ ë¦´ì´ ë©ˆì¶”ë©´ ê²°ê³¼ í‘œì‹œ
					if(index === 2) {
						setTimeout(() => {
							showSlotResult(finalResults, bet, resultDiv);
							slotsSpinning = false;  // íšŒì „ ì¢…ë£Œ
							const btn = document.querySelector('.btn-warning');
							if(btn) btn.disabled = false;  // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
						}, 300);
					}
				}
			}, 80);
		});
	}
	
	function showSlotResult(results, bet, resultDiv){
		let multiplier = 0;
		let message = '';
		let isJackpot = false;  // â† ì´ ì¤„ ì¶”ê°€!
		
		if(results[0] === results[1] && results[1] === results[2]){
			if(results[0] === 'ğŸ’'){
				multiplier = 1.5;
				message = 'ğŸ’ ì²´ë¦¬ 3ê°œ! 1.5ë°°!';
			} else if(results[0] === 'ğŸ‹' || results[0] === 'ğŸŠ'){
				multiplier = 2;
				message = `${results[0]} 3ê°œ! 2ë°° ë‹¹ì²¨!`;
			} else if(results[0] === 'ğŸ‡' || results[0] === 'ğŸ’'){
				multiplier = 5;
				message = `${results[0]} 3ê°œ! 5ë°° ëŒ€ë°•!`;
			} else if(results[0] === '7ï¸âƒ£'){
				multiplier = 10;
				message = 'ğŸ‰ ì­íŒŸ! 7ï¸âƒ£ 10ë°°!!!';
				isJackpot = true;  // â† ì´ ì¤„ ì¶”ê°€!
			}
		}
		
		if(multiplier > 0){
			// ìŠ¤í‚¬ ë³´ë„ˆìŠ¤ ì ìš©
			let bonusMult = 0;
			if(gameData.skills.slotPay > 0) bonusMult = gameData.skills.slotPay * 0.03;
			let totalMult = multiplier * (1 + bonusMult);
			
			const winAmount = Math.floor(bet * totalMult);
			gameData.money += winAmount;
			gameData.stats.slotsWins = (gameData.stats.slotsWins || 0) + 1;
			if(isJackpot) gameData.stats.slotJackpots = (gameData.stats.slotJackpots || 0) + 1;
			resultDiv.innerHTML = `<span style="color:var(--success)">${message}<br>+${winAmount.toLocaleString()}ì›</span>`;
			gainXP(calcXP(bet));
		} else {
			// íŒ¨ë°° ì‹œ í™˜ê¸‰
			let rebateRate = 0;
			if(gameData.skills.slots > 0) rebateRate += (gameData.skills.slots * 0.01);
			
			if(rebateRate > 0){
				const rebate = Math.floor(bet * rebateRate);
				gameData.money += rebate;
				resultDiv.innerHTML = `<span style="color:var(--danger)">${message}</span> <span style='font-size:0.7rem;color:#10b981'>(+${rebate.toLocaleString()}ì› í™˜ê¸‰)</span>`;
			} else {
				resultDiv.innerHTML = `<span style="color:var(--danger)">${message}</span>`;
			}
			gameData.stats.slotsLosses = (gameData.stats.slotsLosses || 0) + 1;
		}
		
		saveData();
		updateUI();
		checkAchievements();
	}

	// --- ì•¼ë°”ìœ„ ---
	let shellAnswer = -1;
	let shellBet = 0;
	let shellShuffling = false;
	
	function shellTab(){
		const g = document.getElementById('content-area');
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:8px;">
					<h3 style="margin:0 0 3px 0; font-size:1rem;">ğŸ¥œ ì•¼ë°”ìœ„</h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">ë•…ì½©ì´ ìˆ¨ê²¨ì§„ ì»µì„ ì°¾ìœ¼ë©´ 3ë°°!</p>
				</div>
				<div style="background:linear-gradient(135deg, #7c3aed, #a855f7); padding:15px; border-radius:12px; margin-bottom:8px; box-shadow:0 4px 12px rgba(124,58,237,0.3); position:relative;">
					<div style="position:absolute; top:8px; right:8px; background:rgba(255,255,255,0.2); padding:3px 8px; border-radius:15px; font-size:0.65rem; color:white; font-weight:bold;">í™•ë¥ : 33%</div>
					<div id="shell-area" style="display:flex; justify-content:center; gap:10px; margin:15px 0; min-height:100px; align-items:center;">
						<div class="shell-cup" data-pos="0" onclick="selectShell(0)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ğŸ¥¤</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">1ë²ˆ</div>
						</div>
						<div class="shell-cup" data-pos="1" onclick="selectShell(1)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ğŸ¥¤</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">2ë²ˆ</div>
						</div>
						<div class="shell-cup" data-pos="2" onclick="selectShell(2)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ğŸ¥¤</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">3ë²ˆ</div>
						</div>
					</div>
					<div id="shell-hint" style="text-align:center; color:white; font-size:0.75rem; margin-top:5px; font-weight:bold; min-height:20px;">ë°°íŒ… í›„ ì‹œì‘í•˜ì„¸ìš”!</div>
				</div>
				<div id="shell-result" style="text-align:center; min-height:30px; font-weight:bold; margin-bottom:8px; font-size:0.85rem;"></div>
				<div class="input-group" style="margin-top:auto;">
					<input type="number" id="shell-bet" placeholder="ë°°íŒ…ê¸ˆ">
					<button onclick="startShell()" class="btn-warning" id="shell-start-btn">ğŸ² ì‹œì‘</button>
				</div>
			</div>
		`;
		shellShuffling = false;
	}

	function startShell(){
		const bet = Number(document.getElementById('shell-bet').value);
		if(bet <= 0 || bet > gameData.money) return showMsg('ë°°íŒ…ê¸ˆ í™•ì¸');
		if(shellShuffling) return;
		
		shellShuffling = true;
		gameData.money -= bet;
		shellBet = bet;
		shellAnswer = Math.floor(Math.random() * 3);
		
		saveData();
		updateUI();
		
		document.getElementById('shell-start-btn').disabled = true;
		document.getElementById('shell-result').innerHTML = '';
		document.getElementById('shell-hint').innerHTML = 'ë•…ì½©ì„ ê¸°ì–µí•˜ì„¸ìš”! ğŸ¥œ';
		
		const cups = document.querySelectorAll('.shell-cup');
		
		// 1ë‹¨ê³„: ë•…ì½© ë³´ì—¬ì£¼ê¸°
		cups[shellAnswer].querySelector('.cup-icon').textContent = 'ğŸ¥œ';
		
		setTimeout(() => {
			cups[shellAnswer].querySelector('.cup-icon').textContent = 'ğŸ¥¤';
			document.getElementById('shell-hint').innerHTML = 'ì»µì„ ì„ëŠ” ì¤‘... ğŸ‘€';
			
			// 2ë‹¨ê³„: ì»µ ì„ê¸° ì• ë‹ˆë©”ì´ì…˜
			let shuffleCount = 0;
			const shuffleInterval = setInterval(() => {
				const cup1 = Math.floor(Math.random() * 3);
				let cup2 = Math.floor(Math.random() * 3);
				while(cup2 === cup1) cup2 = Math.floor(Math.random() * 3);
				
				cups[cup1].style.transform = 'translateY(-15px)';
				cups[cup2].style.transform = 'translateY(-15px)';
				
				setTimeout(() => {
					cups[cup1].style.transform = 'translateY(0)';
					cups[cup2].style.transform = 'translateY(0)';
				}, 200);
				
				if(++shuffleCount >= 8) {
					clearInterval(shuffleInterval);
					setTimeout(() => {
						document.getElementById('shell-hint').innerHTML = 'ì–´ëŠ ì»µì— ë•…ì½©ì´ ìˆì„ê¹Œìš”? ğŸ¤”';
						document.getElementById('shell-start-btn').disabled = false;
						shellShuffling = false;
					}, 400);
				}
			}, 400);
		}, 1500);
	}

	function selectShell(index){
		if(shellAnswer === -1) return showMsg('ë¨¼ì € ë°°íŒ…í•˜ê³  ì‹œì‘í•˜ì„¸ìš”!');
		if(shellShuffling) return showMsg('ì»µì„ ì„ëŠ” ì¤‘ì…ë‹ˆë‹¤!');
		
		const cups = document.querySelectorAll('.shell-cup');
		
		// ëª¨ë“  ì»µ ê³µê°œ
		cups.forEach((cup, i) => {
			const icon = cup.querySelector('.cup-icon');
			setTimeout(() => {
				if(i === shellAnswer){
					icon.textContent = 'ğŸ¥œ';
					cup.style.transform = 'scale(1.1)';
					cup.style.borderColor = '#10b981';
				} else {
					icon.textContent = 'âŒ';
				}
			}, i * 200);
		});
		
		const resultDiv = document.getElementById('shell-result');
		
		setTimeout(() => {
			if(index === shellAnswer){
				// ìŠ¤í‚¬ ë³´ë„ˆìŠ¤ ì ìš©
				let multiplier = 3;
				if(gameData.skills.shellPay > 0) {
					multiplier *= (1 + gameData.skills.shellPay * 0.03);
				}
				
				const winAmount = Math.floor(shellBet * multiplier);
				gameData.money += winAmount;
				gameData.stats.shellWins = (gameData.stats.shellWins || 0) + 1;
				gameData.stats.shellCurrentStreak = (gameData.stats.shellCurrentStreak || 0) + 1;
				gameData.stats.shellMaxStreak = Math.max(gameData.stats.shellMaxStreak || 0, gameData.stats.shellCurrentStreak);
				resultDiv.innerHTML = `<span style="color:var(--success)">ğŸ‰ ì •ë‹µ! +${winAmount.toLocaleString()}ì›</span>`;
				gainXP(calcXP(shellBet));
			} else {
				// íŒ¨ë°° ì‹œ í™˜ê¸‰
				let rebateRate = 0;
				if(gameData.skills.shell > 0) rebateRate += (gameData.skills.shell * 0.01);
				
				if(rebateRate > 0){
					const rebate = Math.floor(shellBet * rebateRate);
					gameData.money += rebate;
					resultDiv.innerHTML = `<span style="color:var(--danger)">âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ ${shellAnswer + 1}ë²ˆ!</span> <span style='font-size:0.7rem;color:#10b981'>(+${rebate.toLocaleString()}ì› í™˜ê¸‰)</span>`;
				} else {
					resultDiv.innerHTML = `<span style="color:var(--danger)">âŒ í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ ${shellAnswer + 1}ë²ˆ!</span>`;
				}
				gameData.stats.shellLosses = (gameData.stats.shellLosses || 0) + 1;
				gameData.stats.shellCurrentStreak = 0;
			}
			
			shellAnswer = -1;
			shellBet = 0;
			saveData();
			updateUI();
			checkAchievements();
			
			setTimeout(() => {
				cups.forEach(cup => {
					cup.querySelector('.cup-icon').textContent = 'ğŸ¥¤';
					cup.style.transform = 'scale(1)';
					cup.style.borderColor = 'rgba(255,255,255,0.6)';
				});
				document.getElementById('shell-hint').innerHTML = 'ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!';
			}, 2500);
		}, 600);
	}

	// --- ê°€ìœ„ë°”ìœ„ë³´ ---
	let rpsPlaying = false; // ê²Œì„ ì§„í–‰ ì¤‘ í”Œë˜ê·¸
	
	function rpsTab(){
		if(!gameData.rpsStreak) gameData.rpsStreak = 0;
		if(!gameData.rpsTotalReward) gameData.rpsTotalReward = 0;
		
		const g = document.getElementById('content-area');
		const nextReward = Math.pow(2, gameData.rpsStreak) * 1000;
		const canClaim = gameData.rpsStreak >= 3;
		
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:6px;">
					<h3 style="margin:0 0 2px 0; font-size:1rem;">âœŠ ê°€ìœ„ë°”ìœ„ë³´</h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">3ì—°ìŠ¹ë¶€í„° ìƒê¸ˆ ìˆ˜ë ¹ ê°€ëŠ¥! íŒ¨ë°° ì‹œ ì´ˆê¸°í™”</p>
				</div>
				<div style="background:#f9fafb; padding:8px 12px; border-radius:10px; margin-bottom:8px; font-size:0.8rem;">
					<div style="display:flex; justify-content:space-between; margin-bottom:2px;">
						<span style="color:#6b7280;">í˜„ì¬ ì—°ìŠ¹</span>
						<span style="font-weight:bold; color:var(--primary)">${gameData.rpsStreak}ì—°ìŠ¹</span>
					</div>
					<div style="display:flex; justify-content:space-between; margin-bottom:2px;">
						<span style="color:#6b7280;">ëˆ„ì  ìƒê¸ˆ</span>
						<span style="font-weight:bold; color:${canClaim ? 'var(--success)' : '#9ca3af'}">${gameData.rpsTotalReward.toLocaleString()}ì›</span>
					</div>
					<div style="display:flex; justify-content:space-between;">
						<span style="color:#6b7280;">ë‹¤ìŒ ìŠ¹ë¦¬ ì‹œ</span>
						<span style="font-weight:bold; color:var(--warning)">+${nextReward.toLocaleString()}ì›</span>
					</div>
				</div>
				${canClaim ? `<button onclick="claimRPS()" class="btn-success" style="margin-bottom:8px; padding:10px; font-size:0.9rem;">ğŸ’° ìƒê¸ˆ ë°›ê¸° (${gameData.rpsTotalReward.toLocaleString()}ì›)</button>` : ''}
				<div style="text-align:center; flex-grow:1; display:flex; flex-direction:column; justify-content:center; min-height:80px;">
					<div id="rps-display" style="font-size:3rem; margin:8px 0;">â“</div>
					<div id="rps-result" style="min-height:30px; font-weight:bold; font-size:0.85rem;"></div>
				</div>
				<div id="rps-buttons" style="display:flex; gap:6px; justify-content:center; margin-top:auto;">
					<button onclick="playRPS('âœŠ')" style="flex:1; font-size:1.8rem; padding:10px;">âœŠ</button>
					<button onclick="playRPS('âœ‹')" style="flex:1; font-size:1.8rem; padding:10px;">âœ‹</button>
					<button onclick="playRPS('âœŒï¸')" style="flex:1; font-size:1.8rem; padding:10px;">âœŒï¸</button>
				</div>
			</div>
		`;
		rpsPlaying = false;
	}
	
	function claimRPS(){
		if(gameData.rpsStreak < 3 || gameData.rpsTotalReward <= 0) return showMsg('ìˆ˜ë ¹ ê°€ëŠ¥í•œ ìƒê¸ˆì´ ì—†ìŠµë‹ˆë‹¤!');
		
		const reward = gameData.rpsTotalReward;
		const streak = gameData.rpsStreak;
		
		gameData.money += reward;
		
		// 7ì—°ìŠ¹ ì´ìƒ ìƒê¸ˆ ìˆ˜ë ¹ ì—…ì 
		if(streak >= 7) {
			gameData.stats.rpsBigWin = (gameData.stats.rpsBigWin || 0) + 1;
		}
		gameData.stats.rpsClaimed = (gameData.stats.rpsClaimed || 0) + 1;
		gameData.rpsStreak = 0;
		gameData.rpsTotalReward = 0;
		
		saveData();
		updateUI();
		
		checkAchievements();
		
		showMsg(`ğŸ’° <b>${reward.toLocaleString()}ì›</b> íšë“!<br>ì—°ìŠ¹ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.`);
		rpsTab();
	}

	function playRPS(player){
		if(rpsPlaying) return; // ì´ë¯¸ ê²Œì„ ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
		rpsPlaying = true;
		
		// ë²„íŠ¼ ë¹„í™œì„±í™”
		const buttons = document.querySelectorAll('#rps-buttons button');
		buttons.forEach(btn => btn.disabled = true);
		
		const choices = ['âœŠ', 'âœ‹', 'âœŒï¸'];
		let computer = choices[Math.floor(Math.random() * 3)];
		
		// ìŠ¹ë¥  ìŠ¤í‚¬ ì ìš©
		if(gameData.skills.rps > 0) {
			const rpsProb = gameData.skills.rps * 0.01;
			if(Math.random() < rpsProb) {
				// í”Œë ˆì´ì–´ê°€ ì´ê¸°ë„ë¡ AI ì„ íƒ ì¡°ì •
				if(player === 'âœŠ') computer = 'âœŒï¸';
				else if(player === 'âœ‹') computer = 'âœŠ';
				else if(player === 'âœŒï¸') computer = 'âœ‹';
			}
		}
		
		const display = document.getElementById('rps-display');
		const resultDiv = document.getElementById('rps-result');
		
		let count = 0;
		const interval = setInterval(() => {
			display.textContent = choices[count % 3];
			count++;
			if(count > 9){
				clearInterval(interval);
				display.textContent = computer;
				
				let result = '';
				if(player === computer){
					result = 'draw';
				} else if(
					(player === 'âœŠ' && computer === 'âœŒï¸') ||
					(player === 'âœ‹' && computer === 'âœŠ') ||
					(player === 'âœŒï¸' && computer === 'âœ‹')
				){
					result = 'win';
				} else {
					result = 'lose';
				}
				
				if(result === 'win'){
					gameData.rpsStreak++;
					let reward = Math.pow(2, gameData.rpsStreak - 1) * 1000;
					
					// ìŠ¤í‚¬ ë³´ë„ˆìŠ¤ ì ìš©
					if(gameData.skills.rpsPay > 0) {
						reward = Math.floor(reward * (1 + gameData.skills.rpsPay * 0.05));
					}
					
					gameData.rpsTotalReward += reward;
					
					if(gameData.rpsStreak >= 3){
						resultDiv.innerHTML = `<span style="color:var(--success)">ìŠ¹ë¦¬! ${gameData.rpsStreak}ì—°ìŠ¹!<br>ëˆ„ì  ìƒê¸ˆ: ${gameData.rpsTotalReward.toLocaleString()}ì›</span>`;
					} else {
						resultDiv.innerHTML = `<span style="color:var(--success)">ìŠ¹ë¦¬! ${gameData.rpsStreak}ì—°ìŠ¹<br>ëˆ„ì  ìƒê¸ˆ: ${gameData.rpsTotalReward.toLocaleString()}ì› (3ì—°ìŠ¹ë¶€í„° ìˆ˜ë ¹)</span>`;
					}
					
					gameData.stats.rpsWins = (gameData.stats.rpsWins || 0) + 1;
					gameData.stats.rpsMaxStreak = Math.max(gameData.stats.rpsMaxStreak || 0, gameData.rpsStreak);
					gainXP(50);
				} else if(result === 'lose'){
					const lostStreak = gameData.rpsStreak;
					const lostMoney = gameData.rpsTotalReward;
					gameData.rpsStreak = 0;
					gameData.rpsTotalReward = 0;
					gameData.stats.rpsLosses = (gameData.stats.rpsLosses || 0) + 1;
					resultDiv.innerHTML = `<span style="color:var(--danger)">íŒ¨ë°°! ì—°ìŠ¹ ì´ˆê¸°í™”<br>${lostStreak}ì—°ìŠ¹ â†’ 0ì—°ìŠ¹ (${lostMoney.toLocaleString()}ì› ë‚ ë¦¼)</span>`;
				} else {
					resultDiv.innerHTML = `<span style="color:#6b7280">ë¬´ìŠ¹ë¶€! ì—°ìŠ¹ ìœ ì§€<br>${gameData.rpsStreak}ì—°ìŠ¹ (ëˆ„ì : ${gameData.rpsTotalReward.toLocaleString()}ì›)</span>`;
				}
				
				saveData();
				updateUI();
				
				setTimeout(() => {
					rpsTab();
				}, 2500);
			}
		}, 100);
	}
    // --- ì„¤ì • ---
    function openSettings(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML = `<h3>âš™ï¸ ì„¤ì •</h3><p style="text-align:center; font-size:0.8rem; color:#6b7280;">ë°ì´í„° ê´€ë¦¬</p>`;
        b.innerHTML = `<button class="btn-outline" onclick="exportData()" style="width:100%; margin-bottom:5px;">ğŸ’¾ ì €ì¥ ì½”ë“œ ë³µì‚¬</button><button class="btn-outline" onclick="importDataModal()" style="width:100%; margin-bottom:5px;">ğŸ“‚ ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</button><button class="btn-danger" onclick="resetGameModal()" style="width:100%; margin-bottom:5px;">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button><button onclick="closeModal()" style="width:100%; background:#374151;">ë‹«ê¸°</button>`;
        o.style.display='flex';
    }
    function exportData(){ const str = btoa(unescape(encodeURIComponent(JSON.stringify(gameData)))); navigator.clipboard.writeText(str).then(() => { alert("ì„¸ì´ë¸Œ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"); }).catch(() => { prompt("ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”:", str); }); }
    function importDataModal(){
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML = `<h3>ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</h3><div class="settings-area"><p>ì„¸ì´ë¸Œ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p><textarea id="import-area"></textarea></div>`;
        b.innerHTML = `<button class="btn-outline" onclick="openSettings()">ë’¤ë¡œ</button><button class="btn-success" onclick="processImport()">ë¶ˆëŸ¬ì˜¤ê¸°</button>`;
    }
    function processImport(){ try { const str = document.getElementById('import-area').value; if(!str) return alert("ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”."); const json = decodeURIComponent(escape(window.atob(str))); const data = JSON.parse(json); if(!data.money || !data.stocks) throw new Error("Invalid"); localStorage.setItem('rpgGameData', JSON.stringify(data)); alert("ë³µêµ¬ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."); location.reload(); } catch(e) { alert("ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤."); } }
    function resetGameModal(){ showConfirm("<span style='color:red'>ê²½ê³ !</span><br>ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", () => { localStorage.removeItem('rpgGameData'); location.reload(); }); }
</script>
</body>
</html>