<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∏ÎèÑÎ∞ïÌï¥Ïöîüí∏</title>
    <style>
        :root {
            --primary: #4f46e5; --primary-hover: #4338ca; --success: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --info: #3b82f6; --dark: #1f2937; --light: #f3f4f6; --white: #ffffff;
            --purple: #8b5cf6; --gold: #d97706;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: #e5e7eb; color: var(--dark); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; user-select: none; }
        .container { background: var(--white); width: 100%; max-width: 400px; padding: 25px; border-radius: 24px; box-shadow: var(--shadow); position: relative; overflow: hidden; min-height: 300px; display:flex; flex-direction:column; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .screen { display: none; flex-grow: 1; flex-direction: column; } .active { display: flex; }
        h2 { margin: 0 0 5px 0; color: var(--dark); font-weight: 800; }
        h3 { margin: 0; color: var(--primary); font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }
        p { color: #6b7280; margin: 0; line-height: 1.4; font-size: 0.9rem; }

        /* UI Components */
        .input-group { display: flex; gap: 8px; width: 100%; align-items: center; }
        .input-group input { margin-bottom: 0; flex: 2; }
        .input-group button { flex: 1; margin-bottom: 0; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem; box-sizing: border-box; transition: 0.2s; font-family: inherit; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); }
        button { width: 100%; padding: 12px; border: none; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: 0.2s; background-color: var(--primary); color: white; box-shadow: 0 3px 5px -1px rgba(79, 70, 229, 0.2); }
        button:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        button:disabled { background-color: #d1d5db; cursor: not-allowed; transform: none; box-shadow: none; color: #9ca3af; }
        
        .btn-danger { background-color: var(--danger); box-shadow: 0 3px 5px -1px rgba(239, 68, 68, 0.2); } .btn-danger:hover { background-color: #dc2626; }
        .btn-success { background-color: var(--success); box-shadow: 0 3px 5px -1px rgba(16, 185, 129, 0.2); } .btn-success:hover { background-color: #059669; }
        .btn-outline { background-color: white; color: var(--dark); border: 2px solid #e5e7eb; box-shadow: none; } .btn-outline:hover { background-color: #f9fafb; border-color: #d1d5db; }
        .btn-warning { background-color: var(--warning); box-shadow: 0 3px 5px -1px rgba(245, 158, 11, 0.2); color: white; } .btn-warning:hover { background-color: #d97706; }
        .btn-purple { background-color: var(--purple); box-shadow: 0 3px 5px -1px rgba(139, 92, 246, 0.2); color: white; } .btn-purple:hover { background-color: #7c3aed; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; width: auto; }

        /* Floating Buttons */
        .gear-btn, .inv-btn { position: absolute; right: 20px; width: 40px; height: 40px; background: white; color: #4b5563; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; font-size: 1.2rem; z-index: 10; padding: 0; cursor: pointer; border: 1px solid #e5e7eb; }
        .gear-btn { top: 20px; } .gear-btn:hover { color: var(--primary); }
        .inv-btn { top: 70px; } .inv-btn:hover { color: var(--primary); transform: scale(1.1); }

        /* Item Toggle Switch */
        .item-toggle { display: inline-flex; align-items: center; gap: 6px; font-size: 0.75rem; color: #555; background: #fff; padding: 4px 10px; border-radius: 15px; border: 1px solid #e5e7eb; cursor: pointer; white-space: nowrap; transition: 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .item-toggle:hover { background: #f9fafb; border-color: #d1d5db; }
        .item-toggle input { display: none; }
        .item-toggle-indicator { width: 14px; height: 14px; border-radius: 4px; border: 2px solid #d1d5db; display: inline-block; position: relative; transition: 0.2s; background: white; }
        .item-toggle input:checked + .item-toggle-indicator { background: var(--primary); border-color: var(--primary); }
        .item-toggle input:disabled + .item-toggle-indicator { background: #e5e7eb; border-color: #d1d5db; opacity: 0.5; }
        .item-toggle.disabled { opacity: 0.6; cursor: not-allowed; background: #f3f4f6; }

        /* Stats Box */
        .stat-box { background: linear-gradient(135deg, var(--dark), #374151); color: white; padding: 15px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 8px 12px -3px rgba(0,0,0,0.1); margin-top: 10px; position: relative; overflow: hidden; flex-shrink: 0; }
        .vip-badge { position: absolute; top: 10px; right: 10px; font-size: 0.7rem; font-weight: bold; padding: 2px 8px; border-radius: 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); }
        .vip-gold { background: linear-gradient(45deg, #f59e0b, #fbbf24); color: #78350f; border:none; }
        .vip-plat { background: linear-gradient(45deg, #a855f7, #ec4899); color: white; border:none; }
        
        .user-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; opacity: 0.9; }
        .money-row { font-size: 1.5rem; font-weight: 800; margin-top: 3px; color: var(--success); text-shadow: 0 2px 4px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: flex-end; }
        .debt-text { font-size: 0.9rem; color: #fca5a5; font-weight: bold; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        .xp-container { margin-top: 10px; }
        .xp-info { display: flex; justify-content: space-between; font-size: 0.7rem; color: #d1d5db; margin-bottom: 3px; }
        .xp-bar-bg { background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden; }
        .xp-bar-fill { background: var(--info); height: 100%; width: 0%; transition: width 0.5s ease; box-shadow: 0 0 10px var(--info); }
        .status-msg { font-size: 0.8rem; color: var(--warning); margin-top: 5px; font-weight: bold; min-height: 16px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Menu */
        .grid-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; flex-shrink: 0; position: relative; z-index: 50; }
        .menu-btn { background: white; color: var(--dark); border: 1px solid #e5e7eb; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px 4px; font-size: 0.8rem; gap: 4px; box-shadow: none; height: 60px; font-weight: bold; transition: 0.2s; }
        .menu-btn:hover, .menu-btn.active-tab { background: #f9fafb; border-color: var(--primary); color: var(--primary); }
        .menu-btn span { font-size: 1.4rem; }
        .popover-menu { position: absolute; top: 75px; left: 0; width: 100%; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15); padding: 10px; display: none; grid-template-columns: repeat(3, 1fr); gap: 10px; z-index: 100; animation: popDown 0.2s; box-sizing: border-box; }
        @keyframes popDown { from { opacity: 0; transform: translateY(-10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .submenu-btn { background: white; border: 1px solid #d1d5db; border-radius: 8px; padding: 12px 5px; font-size: 0.8rem; color: #374151; font-weight: 600; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.1s; }
        .submenu-btn:hover { background: #eff6ff; border-color: var(--primary); color: var(--primary); transform: translateY(-1px); }

        /* Game Area */
        .game-area { background: #f9fafb; border-radius: 16px; padding: 15px; border: 1px solid #f3f4f6; flex-grow: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; height: 320px; }
        .full-height-layout { display: flex; flex-direction: column; height: 100%; justify-content: space-between; flex-grow: 1; overflow: hidden; }
        .scroll-view { flex-grow: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 5px; }
        .scroll-view::-webkit-scrollbar { width: 4px; }
        .scroll-view::-webkit-scrollbar-thumb { background-color: #d1d5db; border-radius: 4px; }
        
        .start-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .start-icon { font-size: 4rem; margin-bottom: 10px; animation: popUp 0.5s ease; }

        /* Game Elements */
        .game-board { flex-grow: 1; background: white; border: 1px solid #e5e7eb; border-radius: 12px; margin: 10px 0; padding: 10px; display: flex; flex-direction: column; justify-content: center; overflow-y: auto; }
        .stock-item { background: white; padding: 10px; border-radius: 8px; margin-bottom: 6px; border: 1px solid #e5e7eb; display: grid; grid-template-columns: 1.5fr 1fr 1.5fr; align-items: center; gap: 8px; }
        .stock-info b { display: block; font-size: 0.85rem; } .stock-info span { font-size: 0.75rem; color: #6b7280; }
        .stock-cnt { text-align: center; font-size: 0.8rem; font-weight: bold; color: var(--primary); }
        .stock-actions { display: flex; gap: 4px; justify-content: flex-end; } .stock-actions button { width: auto; padding: 5px 8px; font-size: 0.7rem; margin: 0; box-shadow:none; }
        
        .bank-info { text-align: center; margin-bottom: 20px; padding: 15px; background: white; border-radius: 12px; border: 1px solid #e5e7eb; }
        .bank-debt { color: var(--danger); font-size: 1.5rem; font-weight: 800; margin: 10px 0; }
        
        .compact-board { display: flex; height: 100%; align-items: center; }
        .compact-col { flex: 1; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .compact-vs { width: 1px; height: 80%; background: #e5e7eb; margin: 0 5px; }
        .compact-label { font-size: 0.8rem; color: #6b7280; margin-bottom: 8px; font-weight: bold; }

        .dice-num { width: 32px; height: 32px; line-height: 32px; background: var(--dark); color: white; border-radius: 6px; font-weight: bold; display:inline-block; margin:2px; font-size: 0.9rem; }
        .dice-hidden { background: #d1d5db; color: #9ca3af; }
        .card { display: inline-flex; width: 36px; height: 50px; background: white; color: var(--dark); border-radius: 4px; justify-content: center; align-items: center; font-weight: bold; margin: 2px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-size: 0.9rem; }
        .card.red { color: #dc2626; } .card-hidden { background: #374151; color: transparent; background-image: repeating-linear-gradient(45deg, #4b5563 0, #4b5563 5px, #374151 5px, #374151 10px); }

        .xp-gain { animation: popUp 0.3s ease; color: var(--info); font-weight: bold; }
        @keyframes popUp { 0%{transform:scale(1);} 50%{transform:scale(1.2);} 100%{transform:scale(1);} }

        /* ROULETTE STYLES */
        .rt-choice-box { display: flex; gap: 10px; justify-content: center; margin-top: 5px; width: 100%; }
        .rt-radio-label { flex: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 10px; cursor: pointer; transition: 0.2s; font-weight: bold; background: white; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .rt-radio-label input { display: none; }
        .rt-radio-label:hover { border-color: var(--primary); background: #f9fafb; }
        .rt-radio-label.selected { border-color: var(--primary); background: #eff6ff; color: var(--primary); }
        .rt-radio-label.red-opt.selected { border-color: #ef4444; background: #fef2f2; color: #ef4444; }
        .rt-radio-label.black-opt.selected { border-color: #374151; background: #f3f4f6; color: #374151; }
        .roulette-wrapper { width: 120px; height: 120px; background: white; border-radius: 50%; border: 8px solid var(--dark); display: flex; justify-content: center; align-items: center; margin: 10px auto; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; }
        .roulette-wrapper::before { content:'‚ñº'; position:absolute; top:-22px; color:var(--danger); font-size:1.5rem; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3)); }
        .roulette-wheel { font-size: 2.5rem; font-weight: 800; color: var(--dark); }

        /* Shop, Skills, Achievements */
        .shop-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .shop-info h4 { margin: 0; font-size: 0.95rem; color: var(--dark); }
        .shop-info p { margin: 2px 0 0 0; font-size: 0.8rem; color: #6b7280; }
        .shop-btn { width: auto; padding: 8px 12px; font-size: 0.8rem; }

        .skill-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; }
        .skill-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .skill-lv { background: var(--dark); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .skill-desc { font-size: 0.8rem; color: #6b7280; margin-bottom: 8px; }
        .skill-bar-bg { height: 6px; background: #f3f4f6; border-radius: 3px; overflow: hidden; margin-bottom: 8px; }
        .skill-bar-fill { height: 100%; background: var(--primary); width: 0%; }
        
        .ach-item { background: white; padding: 12px; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; opacity: 0.6; filter: grayscale(1); transition: 0.3s; }
        .ach-item.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ach-item.claimed { opacity: 1; filter: grayscale(0); border-color: var(--success); background: #ecfdf5; }
        .ach-info h4 { margin: 0; font-size: 0.9rem; } .ach-info p { margin: 0; font-size: 0.75rem; color: #6b7280; }

        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: white; padding: 12px 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 5px solid var(--primary); animation: slideIn 0.3s ease; display: flex; align-items: center; gap: 10px; max-width: 300px; pointer-events: auto; }
        .toast-icon { font-size: 1.5rem; }
        .toast-content b { display: block; font-size: 0.9rem; color: var(--dark); }
        .toast-content span { font-size: 0.8rem; color: #6b7280; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 999; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); cursor: pointer; }
        .modal-box { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 320px; min-height: 200px; display: flex; flex-direction: column; justify-content: center; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: modalUp 0.3s; position: relative; cursor: default; }
        @keyframes modalUp { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .modal-text { margin-bottom: 20px; font-size: 1rem; color: #333; line-height: 1.5; font-weight: 500; }
        .modal-btns { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .modal-btns button { padding: 12px 16px; width: 100%; margin: 0; }

        /* Inventory Pop */
        .inv-item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f9fafb; border-radius: 8px; margin-bottom: 6px; border: 1px solid #e5e7eb; font-size: 0.9rem; }
        .inv-item-name { display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .inv-item-cnt { background: var(--dark); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; }
        
        /* Lucky Box Animation */
        .gacha-box { font-size: 6rem; display: inline-block; margin: 20px 0; }
        .shake-box { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) infinite both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-2deg); } 20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0) rotate(-4deg); } 40%, 60% { transform: translate3d(4px, 0, 0) rotate(4deg); } }
        .pop-result { animation: popResult 0.5s ease forwards; }
        @keyframes popResult { 0% { transform: scale(0); opacity: 0; } 60% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

        .settings-area textarea { font-size: 0.8rem; height: 80px; margin-bottom: 10px; color: #555; word-break: break-all; }
		
		/* ÏïåÎ∞î ÌôîÎ©¥ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
		.alba-container { display: flex; flex-direction: column; height: 100%; justify-content: space-between; }
		.alba-dashboard { background: #fff; border-radius: 12px; padding: 12px; border: 1px solid #e9ecef; box-shadow: 0 2px 8px rgba(0,0,0,0.03); display: flex; flex-direction: column; gap: 10px; }
		.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 10px; border-bottom: 1px dashed #e9ecef; }
		.stat-item { text-align: center; }
		.stat-label { font-size: 0.75rem; color: #868e96; margin-bottom: 2px; }
		.stat-value { font-size: 1rem; font-weight: 800; color: #343a40; }
		.stat-value.highlight { color: var(--primary); font-size: 1.2rem; }
		.bonus-badge { font-size: 0.65rem; color: var(--success); background: #e6fcf5; padding: 1px 5px; border-radius: 4px; vertical-align: middle; }
		.slider-wrapper { padding: 5px 0; }
		.compact-slider { -webkit-appearance: none; width: 100%; height: 6px; border-radius: 3px; background: #e9ecef; outline: none; margin: 10px 0; }
		.compact-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; border: 2px solid #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.3); }
		.time-display { display: flex; justify-content: space-between; font-size: 0.8rem; font-weight: bold; color: var(--primary); background: #f8f9fa; padding: 6px 10px; border-radius: 8px; }
		.btn-work { width: 100%; padding: 12px; font-size: 1rem; border-radius: 12px; font-weight: bold; margin-top: 5px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Stock History Table */
        .history-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .history-table th { text-align: left; padding: 8px; border-bottom: 2px solid #e5e7eb; color: #6b7280; }
        .history-table td { padding: 8px; border-bottom: 1px solid #f3f4f6; color: var(--dark); }
        .history-table .buy { color: var(--danger); font-weight: bold; }
        .history-table .sell { color: var(--primary); font-weight: bold; }
        .history-container { max-height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid #e5e7eb; border-radius: 8px; }
		
		/* Ïä¨Î°ØÎ®∏Ïã† */
		.slot-reel { 
			background: white; 
			padding: 10px 20px; 
			border-radius: 12px; 
			box-shadow: 0 4px 6px rgba(0,0,0,0.1);
			min-width: 70px;
			text-align: center;
		}

		/* ÏïºÎ∞îÏúÑ */
		.shell-cup { 
			cursor: pointer; 
			text-align: center; 
			padding: 10px;
			border-radius: 12px;
			transition: transform 0.2s;
		}
		.shell-cup:hover { 
			transform: scale(1.1); 
			background: rgba(79, 70, 229, 0.1);
		}
    </style>
</head>
<body>
<audio id="alarm-sound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGB1O7Ujj0KE2Wx6t6oVRQLRp/g8r5sIQUxgdTu1I49ChNlsereo1UUC0af4PK/bCEFMYHU7tSNPQoTZbHq36hVFAtGn+DyvmwhBTGB1O7Ujj0KE2Wx6t+oVRQLRp/g8r5sIQUxgdTu1I49ChNlserfo1UUC0af4PK+bCEFMYHU7tSPPQoTZbHq3qNVFAtGn+DyvmwhBTGB1O7Ujj0KE2Wx6t6jVRQLRp/g8r5sIQUxgdTu1I89ChNlserfqFUUC0af4PK+bCEFMYHU7tSPPQoTZbHq3qNVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx6t+jVRQLRp/g8r5sIQUxgdTu1I89ChNlsereolUUC0af4PK+bCEFMYHU7tSPPQoTZbHq36NVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx6t+jVRQLRp/g8r5sIQUxgdTu1I89ChNlsereolUUC0af4PK+bCEFMYHU7tSPPQoTZbHq36NVFAtGn+DyvmwhBTGB1O7Ujz0KE2Wx" type="audio/wav">
</audio>

<div id="toast-container" class="toast-container"></div>
<button class="gear-btn" onclick="openSettings()">‚öôÔ∏è</button>
<button class="inv-btn" onclick="openInventory()">üéí</button>

<div class="container">
    <div id="modal-overlay" class="modal-overlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-box">
            <div id="modal-content">
                <div id="modal-text" class="modal-text"></div>
                <div id="modal-btns" class="modal-btns"></div>
            </div>
            <div id="gacha-ui" style="display:none;">
                <h3 style="justify-content:center; margin-bottom:10px;">üéÅ Îü≠ÌÇ§Î∞ïÏä§ Í∞úÎ¥â</h3>
                <div id="gacha-icon" class="gacha-box">üì¶</div>
                <p id="gacha-msg" style="font-weight:bold; color:var(--primary);">ÎëêÍ∑ºÎëêÍ∑º...</p>
                <button id="gacha-confirm" onclick="closeModal()" style="display:none; width:100%; margin-top:15px;">ÌôïÏù∏</button>
            </div>
        </div>
    </div>
    
    <div id="login-screen" class="screen active fade-in" style="justify-content:center; align-items:center; text-align: center;">
        <h1 style="font-size: 3rem; margin-bottom: 10px;">üéÆ</h1><h2>ÎØ∏ÎãàÍ≤åÏûÑ ÎùºÏö¥ÏßÄ</h2><p>RPG Edition</p>
        <div style="margin-top: 30px; width:80%;"><input type="text" id="nicknameInput" placeholder="ÎãâÎÑ§ÏûÑ ÏûÖÎ†•"><button onclick="startGame()" style="margin-top: 10px;">ÏûÖÏû•ÌïòÍ∏∞</button></div>
    </div>
    
    <div id="game-screen" class="screen fade-in">
        <div class="stat-box">
            <div id="vip-badge" class="vip-badge" style="display:none;">VIP</div>
            <div class="user-row"><span>üë§ <span id="user-info">Guest</span></span><span id="user-title" style="font-size:0.85em; font-weight:bold; color:#fbbf24;">Lv.1</span></div>
            <div class="money-row">
                <div><span style="font-size:0.6em; font-weight:normal;">‚Ç©</span> <span id="current-money">0</span></div>
                <div id="debt-display" class="debt-text" style="display:none;">(Îπö: <span id="current-debt">0</span>)</div>
            </div>
            <div class="xp-container"><div class="xp-info"><span>EXP</span><span><span id="cur-xp">0</span> / <span id="max-xp">100</span></span></div><div class="xp-bar-bg"><div id="xp-bar" class="xp-bar-fill"></div></div></div>
            <div id="status-msg" class="status-msg"></div>
        </div>
        
        <div style="position:relative; width:100%;">
            <div id="menu-area" class="grid-menu">
                <button class="menu-btn" id="btn-money" onclick="togglePopMenu('money')"><span>üí∞</span>Í≤ΩÏ†úÌôúÎèô</button>
                <button class="menu-btn" id="btn-game" onclick="togglePopMenu('game')"><span>üé≤</span>ÎØ∏ÎãàÍ≤åÏûÑ</button>
                <button class="menu-btn" id="btn-growth" onclick="togglePopMenu('growth')"><span>‚ú®</span>ÏÑ±Ïû•/ÏÉÅÏ†ê</button>
            </div>
            <div id="pop-menu" class="popover-menu"></div>
        </div>
        
        <div id="content-area" class="game-area" onclick="closePopMenu()">
            <div class="start-screen"><div class="start-icon">üëÜ</div><p>Î©îÎâ¥Î•º ÏÑ†ÌÉùÌï¥ Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî.</p></div>
        </div>
    </div>
</div>

<script>
    // --- Ïú†Ìã∏Î¶¨Ìã∞ ---
    function showMsg(m){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML=m; b.innerHTML=`<button onclick="closeModal()">ÌôïÏù∏</button>`;
        o.style.display='flex';
    }
    function showConfirm(m,y){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML=m; b.innerHTML=`<button onclick="closeModal()" class="btn-outline" style="background:#f3f4f6;">Ï∑®ÏÜå</button><button id="modal-yes-btn">ÌôïÏù∏</button>`;
        document.getElementById('modal-yes-btn').onclick=function(){closeModal();y();};
        o.style.display='flex';
    }
    function closeModal(){document.getElementById('modal-overlay').style.display='none';}
    function showToast(title, msg, icon="üîî"){
        const c = document.getElementById('toast-container');
        const d = document.createElement('div');
        d.className = 'toast';
        d.innerHTML = `<div class="toast-icon">${icon}</div><div class="toast-content"><b>${title}</b><span>${msg}</span></div>`;
        c.appendChild(d);
        setTimeout(()=>d.remove(), 3000);
    }

    // --- ÌåùÏóÖ Î©îÎâ¥ Î°úÏßÅ ---
    const MENUS = {
        'money': [
            { id: 'alba', name: 'ÏïåÎ∞î', icon: 'üßπ' },
            { id: 'stock', name: 'Ï£ºÏãù', icon: 'üìà' },
            { id: 'bank', name: 'ÏÇ¨Ï±Ñ', icon: 'üí∏' }
        ],
        'game': [
			{ id: 'dice', name: 'Ï£ºÏÇ¨ÏúÑ', icon: 'üé≤' },
			{ id: 'blackjack', name: 'Î∏îÎûôÏû≠', icon: 'üÉè' },
			{ id: 'roulette', name: 'Î£∞Î†õ', icon: 'üé°' },
			{ id: 'slots', name: 'Ïä¨Î°ØÎ®∏Ïã†', icon: 'üé∞' },
			{ id: 'shell', name: 'ÏïºÎ∞îÏúÑ', icon: 'ü•ú' },
			{ id: 'rps', name: 'Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥', icon: '‚úä' }
		],
        'growth': [
            { id: 'skills', name: 'Ïä§ÌÇ¨', icon: 'üéì' },
            { id: 'shop', name: 'ÏÉÅÏ†ê', icon: 'üõí' },
            { id: 'achievements', name: 'ÏóÖÏ†Å', icon: 'üèÜ' }
        ]
    };

    let activePop = null;
    function togglePopMenu(category){
        const pop = document.getElementById('pop-menu');
        const btns = document.querySelectorAll('.menu-btn');
        if(activePop === category){ closePopMenu(); return; }
        btns.forEach(b => b.classList.remove('active-tab'));
        document.getElementById('btn-' + category).classList.add('active-tab');
        pop.innerHTML = '';
        MENUS[category].forEach(item => {
            const btn = document.createElement('div'); btn.className = 'submenu-btn';
            btn.innerHTML = `<span>${item.icon}</span>${item.name}`;
            btn.onclick = () => { openTab(item.id); closePopMenu(); };
            pop.appendChild(btn);
        });
        pop.style.display = 'grid'; activePop = category;
    }
    function closePopMenu(){
        document.getElementById('pop-menu').style.display = 'none'; activePop = null;
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active-tab'));
    }

    // --- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ---
    let gameData = { 
		nickname: "", money: 10000, debt: 0, lastInterest: 0, jobEndTime: 0, jobHours: 0, level: 1, xp: 0, maxXp: 100, 
		rpsStreak: 0,
        stocks: { "ÎÑ•ÏÑúÏä§ÏΩîÏñ¥": { p: 5500, n: 0 }, "ÌîÑÎùºÏûÑÎÖ∏Îìú": { p: 42000, n: 0 }, "ÎÑ§Ïò§ÏãúÍ∑∏Îßà": { p: 150000, n: 0 }, "Ï†úÎ°úÏÑπÌÑ∞": { p: 1250000, n: 0 } }, 
        stockHistory: [], 
        lastStockUpdate: 0,
        vip: { level: 0, endTime: 0 }, 
        skills: {
            card: 0, dice: 0, roulette: 0, alba: 0, xp: 0,
            diceProb: 0, bjStand: 0, rtProb: 0,
            dicePay: 0, bjPay: 0, rtPay: 0,
            slots: 0, slotProb: 0, slotPay: 0, shell: 0, shellPay: 0, rps: 0, rpsPay: 0
        },
        inventory: { luckyBox: 0, diceWin: 0, bjCard: 0, magnet: 0 },
        stats: { 
            totalWins: 0, totalMoney: 0, itemsUsed: 0, 
            albaCount: 0, stockTrades: 0, loanCount: 0, 
            diceWins: 0, bjWins: 0, rouletteWins: 0,
            luckyBoxOpens: 0, luckyBoxFail: 0, luckyBoxJackpot: 0,
            maxMoney: 10000,
            diceItemUsed: 0, bjItemUsed: 0,
            snakeEyesCount: 0, perfectSixCount: 0, rouletteZeroWins: 0,
            consecutiveLoss: 0, maxConsecutiveLoss: 0,
            // [Ï∂îÍ∞ÄÎêú ÌÜµÍ≥Ñ Î≥ÄÏàòÎì§]
            vipSpent: 0, skillSpent: 0, maxDebt: 0,
            stockBuyCount: 0, stockSellCount: 0,
            rouletteRedWins: 0, totalClicks: 0
        },
        achievements: [], claimedAchievements: [] 
    };
    
    const TITLES = [ "Ï¥àÏã¨Ïûê", "ÏïÑÎßàÏ∂îÏñ¥", "ÎèôÎÑ§ ÌÉÄÏßú", "ÌîÑÎ°ú Í≤úÎ∏îÎü¨", "Ïπ¥ÏßÄÎÖ∏ VIP", "ÎèÑÎ∞ïÏôï", "Ï†ÑÏÑ§Ïùò ÏäπÎ∂ÄÏÇ¨", "Ïö¥Î™ÖÏùò ÏßÄÎ∞∞Ïûê", "ÎØ∏ÎãàÍ≤åÏûÑ Ïã†", "GM" ];
    const VIP_DATA = {
        1: { name: "Î∏åÎ°†Ï¶à", cost: 100000, xp: 0.1, rebate: 0, stockMin: 25 },
        2: { name: "Ïã§Î≤Ñ", cost: 500000, xp: 0.15, rebate: 0.05, stockMin: 20 },
        3: { name: "Í≥®Îìú", cost: 3000000, xp: 0.20, rebate: 0.10, stockMin: 15 },
        4: { name: "ÌîåÎûòÌã∞ÎÑò", cost: 10000000, xp: 0.30, rebate: 0.20, stockMin: 10 }
    };
    
    const SKILL_DATA = {
        alba: { name: "Ïû¨ÌÖåÌÅ¨ Ï†ÑÎ¨∏Í∞Ä", desc: "ÏïåÎ∞î Í∏âÏó¨ +5%" },
        xp: { name: "XP Î∂ÄÏä§ÌÑ∞", desc: "Î™®Îì† Í≤ΩÌóòÏπò ÌöçÎìù +5%" },
        dice: { name: "Ï£ºÏÇ¨ÏúÑ Îã¨Ïù∏", desc: "Ï£ºÏÇ¨ÏúÑ Ìå®Î∞∞ Ïãú ÌôòÍ∏â +1%" },
        diceProb: { name: "Ïã†Ïùò Ï£ºÏÇ¨ÏúÑ", desc: "Ï£ºÏÇ¨ÏúÑ ÏäπÎ•† +1%" },
        dicePay: { name: "Ï£ºÏÇ¨ÏúÑ Ïû≠Ìåü", desc: "Ï£ºÏÇ¨ÏúÑ ÏäπÎ¶¨ ÏÉÅÍ∏à +3%" },
        card: { name: "Ïπ¥Îìú ÎßàÏä§ÌÑ∞", desc: "Î∏îÎûôÏû≠ Ìå®Î∞∞ Ïãú ÌôòÍ∏â +1%" },
        bjStand: { name: "ÎîúÎü¨Ïùò Ïã§Ïàò", desc: "ÎîúÎü¨ 15 Ïä§ÌÉ†Îìú ÌôïÎ•† +2%" },
        bjPay: { name: "Î∏îÎûôÏû≠ Ïû≠Ìåü", desc: "Î∏îÎûôÏû≠ ÏäπÎ¶¨ ÏÉÅÍ∏à +3%" },
        roulette: { name: "Îü≠ÌÇ§ Ïä§ÌÉÄ", desc: "Î£∞Î†õ Ìå®Î∞∞ Ïãú ÌôòÍ∏â +1%" },
        rtProb: { name: "ÏòàÏßÄÎ†•", desc: "Î£∞Î†õ ÎãπÏ≤® ÌôïÎ•† +1%" },
        rtPay: { name: "Î£∞Î†õ Ïû≠Ìåü", desc: "Î£∞Î†õ ÏäπÎ¶¨ ÏÉÅÍ∏à +3%" },
        slots: { name: "Ïä¨Î°Ø Îß§ÎãàÏïÑ", desc: "Ïä¨Î°ØÎ®∏Ïã† Ìå®Î∞∞ Ïãú ÌôòÍ∏â +1%" },
        slotProb: { name: "ÌñâÏö¥Ïùò Î¶¥", desc: "Ïä¨Î°Ø ÏäπÎ•† +1%" },
        slotPay: { name: "Ïä¨Î°Ø Ïû≠Ìåü", desc: "Ïä¨Î°Ø ÏäπÎ¶¨ ÏÉÅÍ∏à +3%" },
        shell: { name: "ÏïºÎ∞îÏúÑ Í≥†Ïàò", desc: "ÏïºÎ∞îÏúÑ Ìå®Î∞∞ Ïãú ÌôòÍ∏â +1%" },
        shellPay: { name: "ÏïºÎ∞îÏúÑ Ïû≠Ìåü", desc: "ÏïºÎ∞îÏúÑ ÏäπÎ¶¨ ÏÉÅÍ∏à +3%" },
        rps: { name: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ Ï†ÑÎ¨∏", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ ÏäπÎ•† +1%" },
        rpsPay: { name: "Ïó∞Ïäπ Î≥¥ÎÑàÏä§", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ ÏÉÅÍ∏à +5%" }
    };

    // --- ÎåÄÍ∑úÎ™® ÏóÖÏ†Å Î¶¨Ïä§Ìä∏ (ÌôïÏû•Îê®) ---
    const ACHIEVEMENTS = [
        // [Î†àÎ≤®]
        { id: "lv5", name: "Í±∏ÏùåÎßà", desc: "Î†àÎ≤® 5 Îã¨ÏÑ±", check: (d)=>d.level>=5 },
        { id: "lv10", name: "Ï¥àÎ≥¥ ÌÉàÏ∂ú", desc: "Î†àÎ≤® 10 Îã¨ÏÑ±", check: (d)=>d.level>=10 },
        { id: "lv20", name: "Ï§ëÏàò", desc: "Î†àÎ≤® 20 Îã¨ÏÑ±", check: (d)=>d.level>=20 },
        { id: "lv30", name: "Í≥†Ïàò", desc: "Î†àÎ≤® 30 Îã¨ÏÑ±", check: (d)=>d.level>=30 },
        { id: "lv40", name: "ÏòÅÏõÖ", desc: "Î†àÎ≤® 40 Îã¨ÏÑ±", check: (d)=>d.level>=40 },
        { id: "lv50", name: "ÏßÄÎ∞∞Ïûê", desc: "Î†àÎ≤® 50 Îã¨ÏÑ±", check: (d)=>d.level>=50 },
        { id: "lv60", name: "Ï¥àÏõîÏûê", desc: "Î†àÎ≤® 60 Îã¨ÏÑ±", check: (d)=>d.level>=60 },
        { id: "lv70", name: "Ïã†Ìôî", desc: "Î†àÎ≤® 70 Îã¨ÏÑ±", check: (d)=>d.level>=70 },
        { id: "lv80", name: "Î∂àÎ©∏", desc: "Î†àÎ≤® 80 Îã¨ÏÑ±", check: (d)=>d.level>=80 },
        { id: "lv90", name: "Ï†àÎåÄÏûê", desc: "Î†àÎ≤® 90 Îã¨ÏÑ±", check: (d)=>d.level>=90 },
        { id: "lv100", name: "ÎßåÎ†ô", desc: "Î†àÎ≤® 100 Îã¨ÏÑ±", check: (d)=>d.level>=100 },

        // [ÏûêÏÇ∞]
        { id: "rich_500k", name: "Ìã∞ÎÅå", desc: "50ÎßåÏõê Î≥¥Ïú†", check: (d)=>d.money>=500000 },
        { id: "rich_1m", name: "Î∞±ÎßåÏû•Ïûê", desc: "100ÎßåÏõê Î≥¥Ïú†", check: (d)=>d.money>=1000000 },
        { id: "rich_5m", name: "Ïò§Î∞±ÎßåÏû•Ïûê", desc: "500ÎßåÏõê Î≥¥Ïú†", check: (d)=>d.money>=5000000 },
        { id: "rich_10m", name: "Ï≤úÎßåÏû•Ïûê", desc: "1,000ÎßåÏõê Î≥¥Ïú†", check: (d)=>d.money>=10000000 },
        { id: "rich_50m", name: "Ïò§Ï≤úÎßåÏû•Ïûê", desc: "5,000ÎßåÏõê Î≥¥Ïú†", check: (d)=>d.money>=50000000 },
        { id: "rich_100m", name: "Ïñµ ÏÜåÎ¶¨", desc: "1Ïñµ Î≥¥Ïú†", check: (d)=>d.money>=100000000 },
        { id: "rich_500m", name: "Ï§ëÍ≤¨Í∏∞ÏóÖ", desc: "5Ïñµ Î≥¥Ïú†", check: (d)=>d.money>=500000000 },
        { id: "rich_1b", name: "ÎπåÎ¶¨Ïñ¥ÎÑ§Ïñ¥", desc: "10Ïñµ Î≥¥Ïú†", check: (d)=>d.money>=1000000000 },
        { id: "rich_10b", name: "Ïû¨Î≤å", desc: "100Ïñµ Î≥¥Ïú†", check: (d)=>d.money>=10000000000 },
        { id: "rich_1t", name: "ÏõîÎìúÌÅ¥ÎûòÏä§", desc: "1Ï°∞ Î≥¥Ïú†", check: (d)=>d.money>=1000000000000 },
        { id: "money_pi", name: "ÏàòÌïôÏûê", desc: "ÏÜåÏßÄÍ∏àÏù¥ 31415... ÏãúÏûë", check: (d)=>String(Math.floor(d.money)).startsWith("31415") },
        { id: "money_lucky", name: "Îü≠ÌÇ§Í∞ÄÏù¥", desc: "ÏÜåÏßÄÍ∏à 77777... ÏãúÏûë", check: (d)=>String(Math.floor(d.money)).startsWith("77777") },

        // [Îπö]
        { id: "debt_start", name: "Ïã†Ïö© ÏÇ¨Ìöå", desc: "Ï≤´ ÎåÄÏ∂ú Ïã§Ìñâ", check: (d)=>d.stats.loanCount>=1 },
        { id: "debt_10m", name: "ÎπöÏüÅÏù¥", desc: "Îπö 1,000ÎßåÏõê ÎèåÌåå", check: (d)=>d.debt>=10000000 },
        { id: "debt_100m", name: "ÌååÏÇ∞ ÏßÅÏ†Ñ", desc: "Îπö 1Ïñµ ÎèåÌåå", check: (d)=>d.debt>=100000000 },
        { id: "debt_1b", name: "Ïñ¥Íπ®Í∞Ä Î¨¥Í≤ÅÎã§", desc: "Îπö 10Ïñµ ÎèåÌåå", check: (d)=>d.debt>=1000000000 },
        { id: "debt_pro", name: "ÎèåÎ†§ÎßâÍ∏∞", desc: "ÎàÑÏ†Å ÎåÄÏ∂ú 50Ìöå", check: (d)=>d.stats.loanCount>=50 },
        { id: "debt_master", name: "Ïã†Ïö© Î∂àÎüâ", desc: "ÎàÑÏ†Å ÎåÄÏ∂ú 100Ìöå", check: (d)=>d.stats.loanCount>=100 },
        { id: "phoenix", name: "Î∂àÏÇ¨Ï°∞", desc: "ÏµúÎåÄ Îπö 1Ïñµ Í∏∞Î°ù ÌõÑ Îπö Ï≤≠ÏÇ∞", check: (d)=>d.debt===0 && d.stats.maxDebt>=100000000 },
        
        // [ÏïåÎ∞î]
        { id: "alba_10", name: "ÏïåÎ∞îÏÉù", desc: "ÏïåÎ∞î 10Ìöå", check: (d)=>d.stats.albaCount>=10 },
        { id: "alba_50", name: "ÌîÑÎ°ú ÏïåÎ∞îÎü¨", desc: "ÏïåÎ∞î 50Ìöå", check: (d)=>d.stats.albaCount>=50 },
        { id: "alba_100", name: "ÏßÅÏõê Í∏â", desc: "ÏïåÎ∞î 100Ìöå", check: (d)=>d.stats.albaCount>=100 },
        { id: "alba_500", name: "Ï†êÏû•Îãò", desc: "ÏïåÎ∞î 500Ìöå", check: (d)=>d.stats.albaCount>=500 },
        { id: "alba_1000", name: "ÎÖ∏ÎèôÏùò ÏöîÏ†ï", desc: "ÏïåÎ∞î 1000Ìöå", check: (d)=>d.stats.albaCount>=1000 },
        { id: "night_shift", name: "ÏïºÍ∞Ñ Í∑ºÎ¨¥", desc: "ÏÉàÎ≤Ω 2~4ÏãúÏóê ÏïåÎ∞î ÏôÑÎ£å", check: (d)=>{ const h=new Date().getHours(); return (h>=2 && h<4) && d.stats.albaCount>0 && d.jobEndTime===0; }},
        { id: "rich_worker", name: "Ï∑®ÎØ∏Î°ú ÏùºÌï®", desc: "10Ïñµ Ïù¥ÏÉÅ Î≥¥Ïú† Ï§ë ÏïåÎ∞î", check: (d)=>d.money>=1000000000 && d.stats.albaCount>0 && d.jobEndTime===0 },

        // [Ï£ºÏãù]
        { id: "stock_beginner", name: "Ï£ºÎ¶∞Ïù¥", desc: "Ï£ºÏãù Í±∞Îûò 50Ìöå", check: (d)=>d.stats.stockTrades>=50 },
        { id: "stock_trader", name: "Ìä∏Î†àÏù¥Îçî", desc: "Ï£ºÏãù Í±∞Îûò 500Ìöå", check: (d)=>d.stats.stockTrades>=500 },
        { id: "stock_master", name: "Ïó¨ÏùòÎèÑ ÌÅ∞ÏÜê", desc: "Ï£ºÏãù Í±∞Îûò 1,000Ìöå", check: (d)=>d.stats.stockTrades>=1000 },
        { id: "stock_sell_king", name: "ÏÜêÏ†àÏùò Îã¨Ïù∏", desc: "Îß§ÎèÑ ÌöüÏàò 100Ìöå", check: (d)=>d.stats.stockSellCount>=100 },
        { id: "owner_nexus", name: "ÎÑ•ÏÑúÏä§ ÎåÄÏ£ºÏ£º", desc: "ÎÑ•ÏÑúÏä§ 1,000Ï£º Î≥¥Ïú†", check: (d)=>d.stocks["ÎÑ•ÏÑúÏä§ÏΩîÏñ¥"].n>=1000 },
        { id: "owner_prime", name: "ÌîÑÎùºÏûÑ ÎåÄÏ£ºÏ£º", desc: "ÌîÑÎùºÏûÑ 500Ï£º Î≥¥Ïú†", check: (d)=>d.stocks["ÌîÑÎùºÏûÑÎÖ∏Îìú"].n>=500 },
        { id: "owner_neo", name: "ÎÑ§Ïò§ ÎåÄÏ£ºÏ£º", desc: "ÎÑ§Ïò§ 100Ï£º Î≥¥Ïú†", check: (d)=>d.stocks["ÎÑ§Ïò§ÏãúÍ∑∏Îßà"].n>=100 },
        { id: "owner_zero", name: "Ï†úÎ°ú Ï†ïÎ≥µ", desc: "Ï†úÎ°úÏÑπÌÑ∞ 10Ï£º Î≥¥Ïú†", check: (d)=>d.stocks["Ï†úÎ°úÏÑπÌÑ∞"].n>=10 },
        { id: "portfolio", name: "Î∂ÑÏÇ∞ Ìà¨Ïûê", desc: "Î™®Îì† Ï¢ÖÎ™© 1Ï£º Ïù¥ÏÉÅ Î≥¥Ïú†", check: (d)=>Object.values(d.stocks).every(s=>s.n>=1) },

        // [ÎèÑÎ∞ï - Ï¢ÖÌï©]
        { id: "win_10", name: "Ïö¥Ïàò Ï¢ãÏùÄ ÎÇ†", desc: "Ï¥ù ÏäπÎ¶¨ 10Ìöå", check: (d)=>d.stats.totalWins>=10 },
        { id: "win_100", name: "ÌÉÄÏßú ÏûÖÎ¨∏", desc: "Ï¥ù ÏäπÎ¶¨ 100Ìöå", check: (d)=>d.stats.totalWins>=100 },
        { id: "win_500", name: "Î≤†Í∞ÄÏä§ Ï†ÑÏÑ§", desc: "Ï¥ù ÏäπÎ¶¨ 500Ìöå", check: (d)=>d.stats.totalWins>=500 },
        { id: "win_1000", name: "ÎèÑÎ∞ïÏùò Ïã†", desc: "Ï¥ù ÏäπÎ¶¨ 1,000Ìöå", check: (d)=>d.stats.totalWins>=1000 },
        { id: "lose_streak_5", name: "ÏñµÍπå", desc: "5Ïó∞Ìå® Îã¨ÏÑ±", check: (d)=>d.stats.maxConsecutiveLoss>=5 },
        { id: "lose_streak_10", name: "ÎßàÏù¥ÎÑàÏä§Ïùò ÏÜê", desc: "10Ïó∞Ìå® Îã¨ÏÑ±", check: (d)=>d.stats.maxConsecutiveLoss>=10 },
        { id: "lose_streak_20", name: "ÏûêÏÑ† ÏÇ¨ÏóÖÍ∞Ä", desc: "20Ïó∞Ìå® Îã¨ÏÑ±", check: (d)=>d.stats.maxConsecutiveLoss>=20 },

        // [Ï£ºÏÇ¨ÏúÑ]
        { id: "dice_win_50", name: "Ï£ºÏÇ¨ÏúÑ Í≥†Ïàò", desc: "Ï£ºÏÇ¨ÏúÑ 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.diceWins>=50 },
        { id: "dice_win_200", name: "Ï£ºÏÇ¨ÏúÑ Ïû•Ïù∏", desc: "Ï£ºÏÇ¨ÏúÑ 200Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.diceWins>=200 },
        { id: "snake_eyes", name: "Ïä§ÎÑ§Ïù¥ÌÅ¨ ÏïÑÏù¥", desc: "1, 1, 1 Ìå®Î∞∞", check: (d)=>d.stats.snakeEyesCount>=1 },
        { id: "dice_666", name: "ÏïÖÎßàÏùò Ïà´Ïûê", desc: "ÎÖ∏ÌÖú 6, 6, 6 ÏäπÎ¶¨", check: (d)=>d.stats.perfectSixCount>=1 },
        { id: "dice_item", name: "ÏÇ¨Í∏∞ Ï£ºÏÇ¨ÏúÑ", desc: "ÏïÑÏù¥ÌÖú 10Ìöå ÏÇ¨Ïö©", check: (d)=>d.stats.diceItemUsed>=10 },

        // [Î∏îÎûôÏû≠]
        { id: "bj_win_50", name: "Ïπ¥Îìú Ïπ¥Ïö¥ÌåÖ", desc: "Î∏îÎûôÏû≠ 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.bjWins>=50 },
        { id: "bj_win_200", name: "ÌÖåÏù¥Î∏î ÏßÄÎ∞∞", desc: "Î∏îÎûôÏû≠ 200Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.bjWins>=200 },
        { id: "bj_item", name: "Î∞ëÏû• ÎπºÍ∏∞", desc: "Ïπ¥Îìú ÏïÑÏù¥ÌÖú 10Ìöå ÏÇ¨Ïö©", check: (d)=>d.stats.bjItemUsed>=10 },
        
        // [Î£∞Î†õ]
        { id: "rou_win_50", name: "ÌñâÏö¥Ïùò Î∞îÌÄ¥", desc: "Î£∞Î†õ 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.rouletteWins>=50 },
        { id: "rou_win_200", name: "Ïö¥Î™ÖÏùò Ï£ºÏù∏", desc: "Î£∞Î†õ 200Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.rouletteWins>=200 },
        { id: "rou_zero", name: "0Ïùò Í∏∞Ï†Å", desc: "Ïà´Ïûê 0 ÎãπÏ≤®", check: (d)=>d.stats.rouletteZeroWins>=1 },
        { id: "rou_red_10", name: "Îπ®Í∞ÑÎßõ", desc: "Red Î∞∞ÌåÖ ÏäπÎ¶¨ 10Ìöå", check: (d)=>d.stats.rouletteRedWins>=10 },
        
        // [Ïä¨Î°ØÎ®∏Ïã†]
        { id: "slot_win_10", name: "Ïä¨Î°Ø ÏûÖÎ¨∏", desc: "Ïä¨Î°ØÎ®∏Ïã† 10Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.slotsWins>=10 },
        { id: "slot_win_50", name: "Ïä¨Î°Ø ÎßàÏä§ÌÑ∞", desc: "Ïä¨Î°ØÎ®∏Ïã† 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.slotsWins>=50 },
        { id: "slot_win_200", name: "Ïû≠Ìåü ÌóåÌÑ∞", desc: "Ïä¨Î°ØÎ®∏Ïã† 200Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.slotsWins>=200 },
        { id: "slot_jackpot", name: "7Ô∏è‚É£7Ô∏è‚É£7Ô∏è‚É£", desc: "Ïä¨Î°Ø Ïû≠Ìåü ÎãπÏ≤®", check: (d)=>d.stats.slotJackpots>=1 },
        
        // [ÏïºÎ∞îÏúÑ]
        { id: "shell_win_10", name: "Í¥ÄÏ∞∞Î†•", desc: "ÏïºÎ∞îÏúÑ 10Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.shellWins>=10 },
        { id: "shell_win_50", name: "ÏòàÎ¶¨Ìïú Îàà", desc: "ÏïºÎ∞îÏúÑ 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.shellWins>=50 },
        { id: "shell_win_100", name: "ÏïºÎ∞îÏúÑ Í≥†Ïàò", desc: "ÏïºÎ∞îÏúÑ 100Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.shellWins>=100 },
        { id: "shell_streak_5", name: "Ïó∞ÏÜç Ï†ïÎãµ", desc: "ÏïºÎ∞îÏúÑ 5Ïó∞Ïäπ", check: (d)=>d.stats.shellMaxStreak>=5 },
        
        // [Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥]
        { id: "rps_win_10", name: "Î¨µÏ∞åÎπ†", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ 10Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.rpsWins>=10 },
        { id: "rps_win_50", name: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ Îã¨Ïù∏", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ 50Ìöå ÏäπÎ¶¨", check: (d)=>d.stats.rpsWins>=50 },
        { id: "rps_streak_5", name: "5Ïó∞Ïäπ", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ 5Ïó∞Ïäπ Îã¨ÏÑ±", check: (d)=>d.stats.rpsMaxStreak>=5 },
        { id: "rps_streak_10", name: "10Ïó∞Ïäπ", desc: "Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ 10Ïó∞Ïäπ Îã¨ÏÑ±", check: (d)=>d.stats.rpsMaxStreak>=10 },
        { id: "rps_claim_3", name: "ÏïàÏ†ÑÌåå", desc: "3Ïó∞Ïäπ ÏÉÅÍ∏à 3Ìöå ÏàòÎ†π", check: (d)=>d.stats.rpsClaimed>=3 },
        { id: "rps_big_win", name: "ÌÉêÏöïÏùò ÎÅù", desc: "7Ïó∞Ïäπ Ïù¥ÏÉÅ ÏÉÅÍ∏à ÏàòÎ†π", check: (d)=>d.stats.rpsBigWin>=1 },
        
        // [ÏÉÅÏ†ê & ÏïÑÏù¥ÌÖú]
        { id: "box_10", name: "ÏÜåÌôïÌñâ", desc: "Îü≠ÌÇ§Î∞ïÏä§ 10Ìöå Ïò§Ìîà", check: (d)=>d.stats.luckyBoxOpens>=10 },
        { id: "box_100", name: "Í∞ÄÏ±† Ï§ëÎèÖ", desc: "Îü≠ÌÇ§Î∞ïÏä§ 100Ìöå Ïò§Ìîà", check: (d)=>d.stats.luckyBoxOpens>=100 },
        { id: "box_500", name: "ÌÅ∞ÏÜê", desc: "Îü≠ÌÇ§Î∞ïÏä§ 500Ìöå Ïò§Ìîà", check: (d)=>d.stats.luckyBoxOpens>=500 },
        { id: "box_jackpot", name: "ÎåÄÎ∞ï!", desc: "Îü≠ÌÇ§Î∞ïÏä§ 50Îßå ÎãπÏ≤®", check: (d)=>d.stats.luckyBoxJackpot>=1 },
        { id: "vip_user", name: "ÌùëÏö∞", desc: "VIP ÎàÑÏ†Å 1Ïñµ ÏÇ¨Ïö©", check: (d)=>d.stats.vipSpent>=100000000 },
        { id: "full_inven", name: "ÌíÄ ÌååÎ∞ç", desc: "Î™®Îì† ÏïÑÏù¥ÌÖú 10Í∞úÏî© Î≥¥Ïú†", check: (d)=>d.inventory.diceWin>=10 && d.inventory.bjCard>=10 && d.inventory.magnet>=10 },
        
        // [Ïä§ÌÇ¨]
        { id: "skill_one_max", name: "Ïû•Ïù∏ Ï†ïÏã†", desc: "Ìïú Ïä§ÌÇ¨ ÎßàÏä§ÌÑ∞(Lv.10)", check: (d)=>Object.values(d.skills).some(v=>v>=10) },
        { id: "skill_all_5", name: "Îã§Ïû¨Îã§Îä•", desc: "Î™®Îì† Ïä§ÌÇ¨ Lv.5 Îã¨ÏÑ±", check: (d)=>Object.values(d.skills).every(v=>v>=5) },
        { id: "skill_all_max", name: "Í∑∏ÎûúÎìúÎßàÏä§ÌÑ∞", desc: "Î™®Îì† Ïä§ÌÇ¨ ÎßàÏä§ÌÑ∞", check: (d)=>Object.values(d.skills).every(v=>v>=10) },
        { id: "skill_rich", name: "ÌïôÍµ¨Ïó¥", desc: "Ïä§ÌÇ¨Ïóê 1Ïñµ Ïù¥ÏÉÅ Ìà¨Ïûê", check: (d)=>d.stats.skillSpent>=100000000 },

        // [ÌûàÎì† & Í∏∞ÌÉÄ]
        { id: "click_100", name: "ÏÜêÍ∞ÄÎùΩ Ïö¥Îèô", desc: "ÌôîÎ©¥ 100Î≤à ÌÅ¥Î¶≠", check: (d)=>d.stats.totalClicks>=100 },
        { id: "click_1000", name: "ÎßàÏö∞Ïä§ Î∏åÎ†àÏù¥Ïª§", desc: "ÌôîÎ©¥ 1,000Î≤à ÌÅ¥Î¶≠", check: (d)=>d.stats.totalClicks>=1000 },
        { id: "beggar", name: "Î¨¥ÏÜåÏú†", desc: "Îèà 0Ïõê, Ï£ºÏãù 0Í∞ú", check: (d)=>d.money===0 && Object.values(d.stocks).every(s=>s.n===0) },
        { id: "hidden_owl", name: "Ïò¨ÎπºÎØ∏", desc: "ÏÉàÎ≤Ω 3ÏãúÏóê Ï†ëÏÜç", check: (d)=>new Date().getHours() === 3 },
    ];

    let diceState={step:0,myDice:[],dealerDice:[],bet:0}, bjState={deck:[],playerHand:[],dealerHand:[],bet:0,playing:false,itemUsed:false};
    const HOURLY_WAGE = 10320, JOB_DURATION = 60*60*1000;
    const INTEREST_RATE = 0.05, INTEREST_INTERVAL = 60*1000;

    window.onload=function(){
        // Ï†ÑÏó≠ ÌÅ¥Î¶≠ Ïπ¥Ïö¥Ìä∏
        document.addEventListener('click', () => {
            gameData.stats.totalClicks = (gameData.stats.totalClicks || 0) + 1;
        });

        if(localStorage.getItem('rpgGameData')){
            try {
                let l=JSON.parse(localStorage.getItem('rpgGameData'));
                if(!l.inventory) l.inventory = { luckyBox:0, diceWin:0, bjCard:0, magnet:0 }; 
                if(!l.stockHistory) l.stockHistory = []; 

                for(let k in SKILL_DATA){
                    if(l.skills[k] === undefined) l.skills[k] = 0;
                }

                if(l.inventory.xRay !== undefined) { l.inventory.bjCard = (l.inventory.bjCard||0) + l.inventory.xRay; delete l.inventory.xRay; }
                if(l.inventory.goldCharm !== undefined) { l.inventory.magnet = (l.inventory.magnet||0) + l.inventory.goldCharm; delete l.inventory.goldCharm; }
                
                if(!l.stats) l.stats = { totalWins:0, totalMoney:0, itemsUsed:0 };
                
                // Îç∞Ïù¥ÌÑ∞ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò (ÏÉà Î≥ÄÏàò Ï¥àÍ∏∞Ìôî)
                const newStats = ['snakeEyesCount','perfectSixCount','rouletteZeroWins','consecutiveLoss','maxConsecutiveLoss',
                                  'vipSpent','skillSpent','maxDebt','stockBuyCount','stockSellCount','rouletteRedWins','totalClicks'];
                newStats.forEach(k => { if(l.stats[k] === undefined) l.stats[k] = 0; });

                if(!l.claimedAchievements) l.claimedAchievements = [];
                if(l.stats.diceItemUsed === undefined) l.stats.diceItemUsed = 0;
                if(l.stats.bjItemUsed === undefined) l.stats.bjItemUsed = 0;
				if(l.jobHours === undefined) l.jobHours = 1;

                gameData={...gameData, ...l};
                if(gameData.nickname) showGameScreen();
            } catch(e) { console.error(e); localStorage.removeItem('rpgGameData'); }
        }
        setInterval(gameLoop,1000);
        checkAchievements();
    };

    function saveData(){ 
        gameData.money = Math.floor(gameData.money);
        if(gameData.money > gameData.stats.maxMoney) gameData.stats.maxMoney = gameData.money; 
        localStorage.setItem('rpgGameData',JSON.stringify(gameData)); 
        updateUI(); 
    }
    
    function startGame(){
        const n=document.getElementById('nicknameInput').value;
        if(!n)return showMsg("ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
        gameData.nickname=n; gameData.money=10000;
        saveData(); checkAchievements(); showGameScreen();
    }
    function showGameScreen(){
        document.getElementById('login-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');
        updateUI();
    }
    function gainXP(baseXP){
        if(baseXP<=0) return;
        let multi = 1;
        if(isVipActive()) multi += VIP_DATA[gameData.vip.level].xp;
        if(gameData.skills.xp > 0) multi += (gameData.skills.xp * 0.05);
        if(gameData.vip.level === 4) multi += 0.03;
        gameData.xp += Math.floor(baseXP * multi);
        if(gameData.xp >= gameData.maxXp){
            gameData.xp -= gameData.maxXp; gameData.level++; gameData.maxXp = Math.floor(gameData.maxXp * 1.5);
            showMsg(`üéâ <b>Î†àÎ≤® ÏóÖ!</b><br>Lv.${gameData.level} Îã¨ÏÑ±!`);
            checkAchievements();
        }
        saveData();
    }
    function isVipActive(){ return gameData.vip.level > 0 && Date.now() < gameData.vip.endTime; }
    
    function checkAchievements(){
        let changed = false;
        ACHIEVEMENTS.forEach(ac => {
            if(!gameData.achievements.includes(ac.id) && ac.check(gameData)){
                gameData.achievements.push(ac.id);
                showToast("üèÜ ÏóÖÏ†Å Îã¨ÏÑ±!", ac.name);
                changed = true;
                if(document.getElementById('content-area').innerHTML.includes('ÏóÖÏ†Å ÌòÑÌô©')) openTab('achievements');
            }
        });
        if(changed) saveData();
    }

    // --- [Ï∂îÍ∞Ä] ÏïºÍ∞Ñ ÏãúÍ∞Ñ ÌåêÎ≥Ñ Ìï®Ïàò (Ïò§ÌõÑ 10Ïãú ~ Ïò§Ï†Ñ 6Ïãú) ---
    function isNightTime(timestamp) {
        const h = new Date(timestamp).getHours();
        return h >= 22 || h < 6;
    }
	
	// [ÏàòÏ†ï] ÏïºÍ∞Ñ ÏãúÍ∞Ñ(22Ïãú~06Ïãú)Ïù¥ Î™á ÏãúÍ∞Ñ Ìè¨Ìï®ÎêòÏóàÎäîÏßÄ Í≥ÑÏÇ∞ÌïòÎäî Ìï®Ïàò
	function getNightHourCount(endTime, totalHours) {
		let nightCount = 0;
		const oneHourMs = 60 * 60 * 1000;
		// ÏãúÏûë ÏãúÍ∞Ñ Ïó≠ÏÇ∞
		const startTime = endTime - (totalHours * oneHourMs);

		for (let i = 0; i < totalHours; i++) {
			// Í∞Å Í∑ºÎ¨¥ ÏãúÍ∞ÑÏùò ÏãúÏûë ÏãúÏ†êÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÏãúÍ∞Ñ ÌôïÏù∏
			// (Ïòà: 21:00~22:00 Í∑ºÎ¨¥ÎùºÎ©¥ 21ÏãúÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÌåêÎã®)
			let checkTime = new Date(startTime + (i * oneHourMs));
			let h = checkTime.getHours();
			
			// 22Ïãú Ïù¥ÏÉÅÏù¥Í±∞ÎÇò 6Ïãú ÎØ∏ÎßåÏù¥Î©¥ ÏïºÍ∞Ñ ÏãúÍ∞ÑÏúºÎ°ú Ïù∏Ï†ï
			if (h >= 22 || h < 6) {
				nightCount++;
			}
		}
		return nightCount;
	}

    function gameLoop(){
        const now = Date.now();
        
        // gameLoop ÎÇ¥Î∂ÄÏùò ÏïåÎ∞î ÏôÑÎ£å Î°úÏßÅ ÏàòÏ†ï Î∂ÄÎ∂Ñ
		if(gameData.jobEndTime > 0 && now >= gameData.jobEndTime){
		let hours = gameData.jobHours || 1;
		let baseWage = HOURLY_WAGE; // Í∏∞Î≥∏ ÏãúÍ∏â
		
		// ÏïåÎ¶º ÏÜåÎ¶¨ Ïû¨ÏÉù
		const alarmSound = document.getElementById('alarm-sound');
		if(alarmSound) {
			alarmSound.volume = 0.5;
			alarmSound.play().catch(e => console.log('ÏÜåÎ¶¨ Ïû¨ÏÉù Ïã§Ìå®:', e));
		}
		
		// 1. Ïä§ÌÇ¨ Î≥¥ÎÑàÏä§ Ï†ÅÏö© (Í∏∞Î≥∏ ÏãúÍ∏â ÏÉÅÏäπ)
		if(gameData.skills.alba > 0) baseWage += Math.floor(baseWage * (gameData.skills.alba * 0.05));
		
		// 2. [ÏàòÏ†ï] ÏïºÍ∞Ñ/Ï£ºÍ∞Ñ ÏãúÍ∞Ñ Î∂ÑÎ¶¨ Í≥ÑÏÇ∞
		let nightHours = getNightHourCount(gameData.jobEndTime, hours);
		let dayHours = hours - nightHours;

		// Ï£ºÍ∞Ñ Í∏âÏó¨ + ÏïºÍ∞Ñ Í∏âÏó¨(1.5Î∞∞)
		let totalWage = (dayHours * baseWage) + (nightHours * Math.floor(baseWage * 1.5));

		gameData.money += totalWage; 
		gameData.jobEndTime = 0; 
		gameData.jobHours = 0; 
		gameData.stats.albaCount++; 
		
		gainXP(10 * hours); 
		
		// Î©îÏãúÏßÄ ÏÉùÏÑ±
		let nightMsg = nightHours > 0 ? ` <span style="color:#a855f7; font-weight:bold;">(üåôÏïºÍ∞Ñ ${nightHours}ÏãúÍ∞Ñ)</span>` : "";
		
		showMsg(`üí∞ <b>ÏïÑÎ•¥Î∞îÏù¥Ìä∏ ÏôÑÎ£å!</b>${nightMsg}<br>${hours}ÏãúÍ∞Ñ Í∑ºÎ¨¥ ÏàòÎãπ<br><span style="color:var(--success); font-size:1.2rem;">+${totalWage.toLocaleString()}Ïõê</span> ÏûÖÍ∏à`);
		checkAchievements();
		saveData(); 
		if(document.getElementById('content-area').innerHTML.includes('ÏïåÎ∞îÏ≤úÍµ≠')) openTab('alba');
	}
        
        let intervalMin = isVipActive() ? VIP_DATA[gameData.vip.level].stockMin : 30;
        let intervalMs = intervalMin * 60 * 1000;
        let lastBlock = Math.floor(gameData.lastStockUpdate / intervalMs);
        let currentBlock = Math.floor(now / intervalMs);
        if(currentBlock > lastBlock){
            for(let k in gameData.stocks){
                let c = (Math.random() * 0.2) - 0.1;
                gameData.stocks[k].p = Math.max(100, Math.floor(gameData.stocks[k].p * (1 + c)));
            }
            gameData.lastStockUpdate = now; 
            checkAchievements();
            saveData();
            if(document.getElementById('content-area').innerHTML.includes('Ï£ºÏãù ÏãúÏû•')) openTab('stock');
        }
        const timerEl = document.getElementById('stock-timer');
        if(timerEl) {
            const nextTime = (currentBlock + 1) * intervalMs; const diff = nextTime - now;
            if(diff > 0){ const min = Math.floor(diff / 60000); const sec = Math.floor((diff % 60000) / 1000); timerEl.innerText = `(Í∞±Ïã†: ${min}:${sec < 10 ? '0'+sec : sec})`; } else { timerEl.innerText = "(Í∞±Ïã† Ï§ë...)"; }
        }
        if(gameData.debt > 0) {
            const passedTime = now - gameData.lastInterest;
            if(passedTime >= INTEREST_INTERVAL){
                const intervals = Math.floor(passedTime / INTEREST_INTERVAL); const oldDebt = gameData.debt;
                gameData.debt = Math.floor(gameData.debt * Math.pow(1 + INTEREST_RATE, intervals));
                gameData.lastInterest += intervals * INTEREST_INTERVAL;
                showMsg(`üìâ <b>Ïù¥Ïûê Ìè≠ÌÉÑ!</b><br>${intervals}Î∂ÑÏπò Ïù¥Ïûê (+${(gameData.debt - oldDebt).toLocaleString()}Ïõê)`);
                saveData(); if(document.getElementById('content-area').innerHTML.includes('ÎåÄÏ∂úÍ∏à')) openTab('bank');
                checkAchievements();
            }
        }
        if(gameData.vip.level > 0 && now > gameData.vip.endTime){ showMsg(`üì¢ <b>VIP Î©§Î≤ÑÏã≠ ÎßåÎ£å</b><br>ÌòúÌÉùÏù¥ Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§.`); gameData.vip.level = 0; saveData(); }
        updateUI();
    }

    function updateUI(){
        document.getElementById('user-info').innerText = gameData.nickname;
        document.getElementById('current-money').innerText = Math.floor(gameData.money).toLocaleString();
        const vipBadge = document.getElementById('vip-badge');
        if(isVipActive()){
            vipBadge.style.display = 'block'; vipBadge.className = 'vip-badge ' + (gameData.vip.level >= 3 ? 'vip-gold' : '');
            if(gameData.vip.level === 4) vipBadge.classList.add('vip-plat'); vipBadge.innerText = `VIP ${VIP_DATA[gameData.vip.level].name}`;
        } else vipBadge.style.display = 'none';
        const debtDiv = document.getElementById('debt-display');
        if(gameData.debt > 0){ debtDiv.style.display = 'block'; document.getElementById('current-debt').innerText = gameData.debt.toLocaleString(); } else debtDiv.style.display = 'none';
        let t = Math.floor(gameData.level / 10); if(t >= TITLES.length) t = TITLES.length - 1;
        document.getElementById('user-title').innerText = `Lv.${gameData.level} ${TITLES[t]}`;
        document.getElementById('cur-xp').innerText = Math.floor(gameData.xp);
        document.getElementById('max-xp').innerText = Math.floor(gameData.maxXp);
        document.getElementById('xp-bar').style.width = `${Math.min(100, (gameData.xp / gameData.maxXp) * 100)}%`;
        const m = document.getElementById('status-msg');
        let statusText = "";
        if(Date.now() < gameData.jobEndTime) statusText = `‚è≥ ÏïåÎ∞î Ï§ë... ${Math.ceil((gameData.jobEndTime - Date.now()) / 1000)}Ï¥à`;
        m.innerText = statusText;
        updateItemToggles();
    }
    
    // --- Ïù∏Î≤§ÌÜ†Î¶¨ & ÏïÑÏù¥ÌÖú ÌÜ†Í∏Ä ---
    function openInventory(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        
        const lbCount = gameData.inventory.luckyBox;
        const lbBtn = lbCount > 0 ? `<button onclick="openLuckyBoxUI()" style="width:auto; padding:4px 10px; font-size:0.75rem; margin-left:auto;">ÏÇ¨Ïö©</button>` : '';

        t.innerHTML = `<h3>üéí ÎÇ¥ Í∞ÄÎ∞©</h3>
        <div style="text-align:left; margin-top:10px;">
            <div class="inv-item-row">
                <span class="inv-item-name">üì¶ Îü≠ÌÇ§Î∞ïÏä§</span>
                <div style="display:flex; align-items:center; gap:8px;">
                    <span class="inv-item-cnt">${lbCount}Í∞ú</span>
                    ${lbBtn}
                </div>
            </div>
            <div class="inv-item-row"><span class="inv-item-name">üé≤ ÏäπÎ¶¨Ïùò Ï£ºÏÇ¨ÏúÑ</span><span class="inv-item-cnt">${gameData.inventory.diceWin}Í∞ú</span></div>
            <div class="inv-item-row"><span class="inv-item-name">üÉè ÎîúÎü¨ Ï†úÏïΩ Ïπ¥Îìú</span><span class="inv-item-cnt">${gameData.inventory.bjCard}Í∞ú</span></div>
            <div class="inv-item-row"><span class="inv-item-name">üß≤ Î£∞Î†õ ÏûêÏÑù</span><span class="inv-item-cnt">${gameData.inventory.magnet}Í∞ú</span></div>
        </div>`;
        b.innerHTML = `<button onclick="closeModal()" style="width:100%;">Îã´Í∏∞</button>`;
        o.style.display='flex';
    }

    function updateItemToggles(){
        const diceToggle = document.getElementById('use-dice-item-check');
        const diceLabel = document.getElementById('use-dice-item-label');
        if(diceToggle && diceLabel){
            const cnt = gameData.inventory.diceWin;
            diceLabel.innerText = `üé≤ ÏäπÎ¶¨ Ï£ºÏÇ¨ÏúÑ (${cnt})`;
            if(cnt <= 0) { diceToggle.checked = false; diceToggle.disabled = true; diceLabel.parentElement.classList.add('disabled'); }
            else { diceToggle.disabled = false; diceLabel.parentElement.classList.remove('disabled'); }
        }
        const bjToggle = document.getElementById('use-bj-item-check');
        const bjLabel = document.getElementById('use-bj-item-label');
        if(bjToggle && bjLabel){
            const cnt = gameData.inventory.bjCard;
            bjLabel.innerText = `üÉè ÎîúÎü¨ Ï†úÏïΩ (${cnt})`;
            if(cnt <= 0) { bjToggle.checked = false; bjToggle.disabled = true; bjLabel.parentElement.classList.add('disabled'); }
            else { bjToggle.disabled = false; bjLabel.parentElement.classList.remove('disabled'); }
        }
        const rtToggle = document.getElementById('use-rt-item-check');
        const rtLabel = document.getElementById('use-rt-item-label');
        if(rtToggle && rtLabel){
            const cnt = gameData.inventory.magnet;
            rtLabel.innerText = `üß≤ ÏûêÏÑù (${cnt})`;
            if(cnt <= 0) { rtToggle.checked = false; rtToggle.disabled = true; rtLabel.parentElement.classList.add('disabled'); }
            else { rtToggle.disabled = false; rtLabel.parentElement.classList.remove('disabled'); }
        }
    }

    function openTab(t){
		const c = document.getElementById('content-area'); c.innerHTML = ""; c.className = "game-area fade-in";
		switch(t){
			case 'alba': renderAlba(c); break;
			case 'stock': renderStock(c); break;
			case 'dice': renderDice(c); break;
			case 'blackjack': renderBlackjack(c); break;
			case 'roulette': renderRoulette(c); break;
			case 'slots': slotsTab(); break;
			case 'shell': shellTab(); break;
			case 'rps': rpsTab(); break;
			case 'bank': renderBank(c); break;
			case 'skills': renderSkills(c, true); break;
			case 'shop': renderShop(c); break;
			case 'achievements': renderAchievements(c); break;
		}
		updateItemToggles();
	}

    function processResult(win, bet, payoutMult, gameType){
        let resultValue = 0;

        if(win){
            let bonusMult = 0;
            if(gameType === 'dice' && gameData.skills.dicePay > 0) bonusMult = gameData.skills.dicePay * 0.03;
            if(gameType === 'blackjack' && gameData.skills.bjPay > 0) bonusMult = gameData.skills.bjPay * 0.03;
            if(gameType === 'roulette' && gameData.skills.rtPay > 0) bonusMult = gameData.skills.rtPay * 0.03;
            
            let totalMult = payoutMult * (1 + bonusMult);
            let profit = Math.floor(bet * totalMult);
            
            gameData.money += profit; 
            gameData.stats.totalWins++; 
            gameData.stats.consecutiveLoss = 0;
            resultValue = profit;
        } else {
            let rebateRate = 0;
            if(isVipActive()) rebateRate += VIP_DATA[gameData.vip.level].rebate;
            if(gameType === 'blackjack' && gameData.skills.card > 0) rebateRate += (gameData.skills.card * 0.01);
            if(gameType === 'dice' && gameData.skills.dice > 0) rebateRate += (gameData.skills.dice * 0.01);
            if(gameType === 'roulette' && gameData.skills.roulette > 0) rebateRate += (gameData.skills.roulette * 0.01);
            
            if(rebateRate > 0){ 
                const rebate = Math.floor(bet * rebateRate); 
                gameData.money += rebate; 
                resultValue = -1 * rebate; 
            }
            
            gameData.stats.consecutiveLoss = (gameData.stats.consecutiveLoss || 0) + 1;
            if(gameData.stats.consecutiveLoss > gameData.stats.maxConsecutiveLoss) {
                gameData.stats.maxConsecutiveLoss = gameData.stats.consecutiveLoss;
            }
        }
        checkAchievements(); 
        return resultValue;
    }

    // --- Î†åÎçîÎßÅ Ìï®ÏàòÎì§ ---
    function renderShop(c, keepScroll = false){
        let oldScroll = 0; if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        let itemsHtml = `<div class="shop-item" style="border-color:var(--primary); background:#fdfeff;"><div class="shop-info"><h4>üéÅ Îü≠ÌÇ§Î∞ïÏä§</h4><p>50% ÍΩù, ÎåÄÎ∞ïÏùò Í∏∞Ìöå!</p></div><button class="btn-success shop-btn" onclick="buyBox()">‚Ç©50,000</button></div>`;
        for(let lv=1; lv<=4; lv++){ let v = VIP_DATA[lv]; itemsHtml += `<div class="shop-item"><div class="shop-info"><h4>${v.name} Î©§Î≤ÑÏã≠ (30Î∂Ñ)</h4><p>XP+${v.xp*100}%, ÌôòÍ∏â ${v.rebate*100}%, Ï£ºÏãù ${v.stockMin}Î∂Ñ</p></div><button class="shop-btn" onclick="buyVip(${lv})">‚Ç©${(v.cost/10000).toLocaleString()}Îßå</button></div>`; }
        c.innerHTML = `<div class="full-height-layout"><h3>üõí ÏïÑÏù¥ÌÖú ÏÉÅÏ†ê</h3><div class="scroll-view">${itemsHtml}</div></div>`;
        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    function buyBox(){
        if(gameData.money < 50000) return showMsg("ÎèàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.");
        gameData.money -= 50000; gameData.inventory.luckyBox++; saveData(); showToast("Íµ¨Îß§ ÏôÑÎ£å", "Îü≠ÌÇ§Î∞ïÏä§ +1"); renderShop(document.getElementById('content-area'), true);
        checkAchievements();
    }
    function openLuckyBoxUI(){
        if(gameData.inventory.luckyBox <= 0) return showMsg("ÏÉÅÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.");
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        const icon=document.getElementById('gacha-icon'), msg=document.getElementById('gacha-msg'), btn=document.getElementById('gacha-confirm');
        c.style.display='none'; g.style.display='block'; o.style.display='flex';
        icon.innerText = "üì¶"; icon.className = "gacha-box shake-box"; msg.innerText = "ÎëêÍ∑ºÎëêÍ∑º..."; msg.style.color = "var(--primary)"; btn.style.display = 'none';
        setTimeout(()=>{
            gameData.inventory.luckyBox--; gameData.stats.luckyBoxOpens++; const r = Math.random() * 100;
            let res = "", log = "", resIcon = ""; icon.className = "gacha-box pop-result"; 
            if(r < 50) { resIcon = "üí®"; res = "ÍΩù!"; log="ÏïÑÎ¨¥Í≤ÉÎèÑ ÏóÜÏóàÎã§..."; msg.style.color="#9ca3af"; gameData.stats.luckyBoxFail++; }
            else if(r < 75) { let m = 5000 + Math.floor(Math.random()*5001); gameData.money+=m; resIcon = "üóëÔ∏è"; res = "Ïû°ÎèôÏÇ¨Îãà Î∞úÍ≤¨"; log=`+${m}Ïõê`; msg.style.color="#6b7280"; }
            else if(r < 90) { let m = 20000 + Math.floor(Math.random()*30001); gameData.money+=m; resIcon = "üíµ"; res = "ÎπÑÏÉÅÍ∏à Î∞úÍ≤¨!"; log=`+${m.toLocaleString()}Ïõê`; msg.style.color="var(--success)"; }
            else if(r < 95) { gameData.inventory.diceWin++; resIcon="üé≤"; res="ÏäπÎ¶¨Ïùò Ï£ºÏÇ¨ÏúÑ!"; log="ÌöçÎìù!"; msg.style.color="var(--purple)"; }
            else if(r < 98) { gameData.inventory.bjCard++; resIcon="üÉè"; res="ÎîúÎü¨ Ï†úÏïΩ Ïπ¥Îìú!"; log="ÌöçÎìù!"; msg.style.color="var(--purple)"; }
            else if(r < 99.5) { gameData.inventory.magnet++; resIcon="üß≤"; res="Î£∞Î†õ ÏûêÏÑù!"; log="ÌöçÎìù!"; msg.style.color="var(--gold)"; }
            else { gameData.money+=500000; resIcon="üíé"; res="ÎåÄÎ∞ï!"; log="ÌòÑÍ∏à 50ÎßåÏõê!"; msg.style.color="#ec4899"; icon.style.textShadow="0 0 20px rgba(236, 72, 153, 0.5)"; gameData.stats.luckyBoxJackpot++; }
            icon.innerText = resIcon; msg.innerHTML = `<span style="font-size:1.2rem">${res}</span><br><span style="font-size:0.9rem; color:#555; font-weight:normal;">${log}</span>`;
            btn.style.display = 'block'; gameData.stats.itemsUsed++; saveData(); checkAchievements();
        }, 2000);
    }
    function buyVip(lv){
        if(gameData.money < VIP_DATA[lv].cost) return showMsg("ÎèàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.");
        showConfirm(`${VIP_DATA[lv].name} Î©§Î≤ÑÏã≠ÏùÑ Íµ¨Îß§ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`, ()=>{
            gameData.money -= VIP_DATA[lv].cost; 
            gameData.stats.vipSpent = (gameData.stats.vipSpent || 0) + VIP_DATA[lv].cost;
            gameData.vip.level = lv; gameData.vip.endTime = Date.now() + (30 * 60 * 1000);
            saveData(); showMsg(`${VIP_DATA[lv].name} ÌòúÌÉùÏù¥ Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§!`); renderShop(document.getElementById('content-area'), true);
            checkAchievements();
        });
    }

    function renderSkills(c, keepScroll = false){
        let oldScroll = 0; 
        if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        
        let h = `<div class="full-height-layout"><h3>üéì Ïä§ÌÇ¨ Ìä∏Î¶¨</h3><div class="scroll-view">`;
        for(let key in SKILL_DATA){
            let lv = gameData.skills[key] || 0; let nextCost = 50000 * Math.pow(2, lv); let max = lv >= 10;
            h += `<div class="skill-item"><div class="skill-header"><b>${SKILL_DATA[key].name}</b><span class="skill-lv">Lv.${lv}/10</span></div><div class="skill-desc">${SKILL_DATA[key].desc}</div><div class="skill-bar-bg"><div class="skill-bar-fill" style="width:${lv*10}%"></div></div><button class="${max?'btn-outline':'btn-primary'} btn-sm" ${max?'disabled':''} onclick="upgradeSkill('${key}', ${nextCost})" style="width:100%;">${max ? 'Mastered' : 'ÏóÖÍ∑∏Î†àÏù¥Îìú (‚Ç©'+nextCost.toLocaleString()+')'}</button></div>`;
        }
        c.innerHTML = h + `</div></div>`;

        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    
    function upgradeSkill(key, cost){
        if(gameData.money < cost) return showMsg("ÎèàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.");
        showConfirm(`'${SKILL_DATA[key].name}' Î†àÎ≤®ÏóÖ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`, () => {
            gameData.money -= cost; 
            gameData.stats.skillSpent = (gameData.stats.skillSpent || 0) + cost;
            gameData.skills[key]++; saveData(); 
            showToast("Ïä§ÌÇ¨ ÏóÖÍ∑∏Î†àÏù¥Îìú", `Lv.${gameData.skills[key]} Îã¨ÏÑ±!`); 
            renderSkills(document.getElementById('content-area'), true);
            checkAchievements();
        });
    }

    function renderAchievements(c, keepScroll = false){
        let oldScroll = 0; if(keepScroll && c.querySelector('.scroll-view')) oldScroll = c.querySelector('.scroll-view').scrollTop;
        let list = "";
        ACHIEVEMENTS.forEach(ac => {
            const isUnlocked = gameData.achievements.includes(ac.id); const isClaimed = gameData.claimedAchievements.includes(ac.id);
            let btn = isClaimed ? `<span style="font-size:0.75rem; font-weight:bold; color:#10b981;">ÏôÑÎ£åÎê®</span>` : isUnlocked ? `<button class="btn-success btn-sm" onclick="claimReward('${ac.id}')">Î≥¥ÏÉÅ Î∞õÍ∏∞</button>` : `<span style="font-size:0.75rem; color:#9ca3af;">ÏßÑÌñâ Ï§ë</span>`;
            list += `<div class="ach-item ${isClaimed?'claimed':isUnlocked?'unlocked':''}"><div class="ach-info"><h4>${ac.name}</h4><p>${ac.desc}</p></div><div style="text-align:right;"><div style="font-size:0.7rem; margin-bottom:2px; color:#555;">Î≥¥ÏÉÅ: Îü≠ÌÇ§Î∞ïÏä§</div>${btn}</div></div>`;
        });
        c.innerHTML = `<div class="full-height-layout"><h3>üèÜ ÏóÖÏ†Å ÌòÑÌô© (${gameData.claimedAchievements.length}/${ACHIEVEMENTS.length})</h3><div class="scroll-view">${list}</div></div>`;
        if(keepScroll && c.querySelector('.scroll-view')) c.querySelector('.scroll-view').scrollTop = oldScroll;
    }
    function claimReward(id){
        if(gameData.claimedAchievements.includes(id)) return;
        gameData.claimedAchievements.push(id); gameData.inventory.luckyBox++; saveData(); showToast("Î≥¥ÏÉÅ ÏàòÎ†π", "Îü≠ÌÇ§Î∞ïÏä§ 1Í∞úÍ∞Ä ÏßÄÍ∏âÎêòÏóàÏäµÎãàÎã§."); renderAchievements(document.getElementById('content-area'), true);
    }

	function renderAlba(c){
        const now = Date.now(); 
        const isWorking = gameData.jobEndTime > now;

        if(isWorking) {
            // ... (Í∑ºÎ¨¥ Ï§ë ÌôîÎ©¥ÏùÄ Í∏∞Ï°¥ ÏΩîÎìúÏôÄ ÎèôÏùº) ...
            const leftMin = Math.ceil((gameData.jobEndTime - now) / 60000);
            c.innerHTML=`<div class="full-height-layout">
                <h3>‚è≥ Í∑ºÎ¨¥ Ï§ë...</h3>
                <div class="start-screen">
                    <div style="font-size:3.5rem; margin-bottom:15px; animation: pulse 2s infinite;">üßπ</div>
                    <p style="font-size:1rem; font-weight:bold;">Ïó¥Ïã¨Ìûà ÏùºÌïòÎäî Ï§ëÏûÖÎãàÎã§!</p>
                    <p style="color:var(--primary); margin-top:5px; font-size:0.9rem;">ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ÏïΩ ${leftMin}Î∂Ñ</p>
                </div>
                <button class="btn-danger" onclick="cancelJob()" style="width:100%; margin-top:auto;">Ïùº Í∑∏ÎßåÎëêÍ∏∞ (Ï§ëÎèÑ Ï†ïÏÇ∞)</button>
            </div>`;
        } else {
            // Í∏∞Î≥∏ ÏãúÍ∏â Í≥ÑÏÇ∞ (Ïä§ÌÇ¨ Ìè¨Ìï®)
            let baseWage = HOURLY_WAGE;
            let bonusTag = '';
            if(gameData.skills.alba > 0) {
                baseWage += Math.floor(baseWage * (gameData.skills.alba * 0.05));
                bonusTag = `<span class="bonus-badge">+${gameData.skills.alba*5}%</span>`;
            }
            
            c.innerHTML=`
            <div class="alba-container">
                <h3 style="margin:0 0 10px 0; font-size:1.1rem;">üè™ ÏïåÎ∞îÏ≤úÍµ≠</h3>
                
                <div class="alba-dashboard">
                    <div class="stats-grid">
                        <div class="stat-item" style="border-right:1px solid #f1f3f5;">
                            <div class="stat-label">Í∏∞Î≥∏ ÏãúÍ∏â</div>
                            <div class="stat-value">${baseWage.toLocaleString()} ${bonusTag}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÏòàÏÉÅ ÏàòÎ†πÏï°</div>
                            <div class="stat-value highlight" id="alba-total-txt">${baseWage.toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="slider-wrapper">
                        <div class="time-display">
                            <span style="color:#868e96; font-weight:normal;">Í∑ºÎ¨¥ ÏãúÍ∞Ñ</span>
                            <span id="alba-time-badge">1ÏãúÍ∞Ñ</span>
                        </div>
                        <input type="range" id="alba-slider" min="1" max="12" value="1" step="1" class="compact-slider" oninput="updateAlbaPreview(this.value, ${baseWage})">
                        <div style="font-size:0.75rem; text-align:right; color:#adb5bd;">
                            + <span id="alba-xp-txt">10</span> XP ÌöçÎìù ÏòàÏ†ï
                        </div>
                        <div id="night-info" style="font-size:0.75rem; color:#a855f7; text-align:center; margin-top:5px; display:none;">
                            üåô ÏïºÍ∞Ñ ÏàòÎãπ Ï†ÅÏö© ÏòàÏ†ï (1.5Î∞∞)
                        </div>
                    </div>
                </div>

                <div>
                    <button class="btn-primary btn-work" onclick="startJob()">Ï∂úÍ∑º ÎèÑÏû• Ï∞çÍ∏∞! üî®</button>
                    <p style="font-size:0.7rem; color:#999; text-align:center; margin-top:5px;">22:00 ~ 06:00 Ï¢ÖÎ£å Ïãú ÏïºÍ∞ÑÏàòÎãπ 1.5Î∞∞</p>
                </div>
            </div>`;
            // Ï¥àÍ∏∞Ìôî Ïãú 1ÏãúÍ∞Ñ Í∏∞Ï§ÄÏúºÎ°ú ÎØ∏Î¶¨Î≥¥Í∏∞ Ïã§Ìñâ
            setTimeout(() => window.updateAlbaPreview(1, baseWage), 0);
        }
    }

    // [ÏàòÏ†ï] ÎØ∏Î¶¨Î≥¥Í∏∞ Ìï®Ïàò: ÏïºÍ∞Ñ/Ï£ºÍ∞Ñ ÏãúÍ∞ÑÏùÑ Î∂ÑÎ¶¨ÌïòÏó¨ Ï†ïÌôïÌïú ÏòàÏÉÅ Í∏àÏï° ÌëúÏãú
	window.updateAlbaPreview = function(val, baseWage) {
		// ÏòàÏÉÅ Ï¢ÖÎ£å ÏãúÍ∞Ñ
		const expectedEndTime = Date.now() + (val * 60 * 60 * 1000);
		
		// ÏïºÍ∞Ñ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
		const nightHours = getNightHourCount(expectedEndTime, val);
		const dayHours = val - nightHours;

		// ÏµúÏ¢Ö Í∏àÏï° Í≥ÑÏÇ∞
		const finalWage = (dayHours * baseWage) + (nightHours * Math.floor(baseWage * 1.5));
		
		let timeLabel = val + "ÏãúÍ∞Ñ";
		const nightInfo = document.getElementById('night-info');

		if(nightHours > 0) {
			timeLabel += " <span style='font-size:0.8rem;'>üåô</span>";
			if(nightInfo) {
				nightInfo.style.display = 'block';
				nightInfo.innerHTML = `üåô ÏïºÍ∞Ñ ${nightHours}ÏãúÍ∞Ñ Ìè¨Ìï® (1.5Î∞∞)`;
			}
		} else {
			if(nightInfo) nightInfo.style.display = 'none';
		}

		document.getElementById('alba-time-badge').innerHTML = timeLabel;
		document.getElementById('alba-total-txt').innerText = finalWage.toLocaleString() + "Ïõê";
		document.getElementById('alba-xp-txt').innerText = (val * 10);
		
		const slider = document.getElementById('alba-slider');
		if(slider) {
			// ÏïºÍ∞ÑÏù¥ Ìè¨Ìï®ÎêòÎ©¥ Î≥¥ÎùºÏÉâ Í∑∏ÎùºÎç∞Ïù¥ÏÖò
			const color = nightHours > 0 ? '#a855f7' : 'var(--primary)';
			const percent = ((val - 1) / (12 - 1)) * 100;
			slider.style.background = `linear-gradient(to right, ${color} 0%, ${color} ${percent}%, #e9ecef ${percent}%, #e9ecef 100%)`;
		}
	};

	window.updateAlbaPreview = function(val, wage) {
		document.getElementById('alba-time-badge').innerText = val + "ÏãúÍ∞Ñ";
		document.getElementById('alba-total-txt').innerText = (wage * val).toLocaleString() + "Ïõê";
		document.getElementById('alba-xp-txt').innerText = (val * 10);
		const slider = document.getElementById('alba-slider');
		if(slider) {
			const percent = ((val - 1) / (12 - 1)) * 100;
			slider.style.background = `linear-gradient(to right, var(--primary) 0%, var(--primary) ${percent}%, #e9ecef ${percent}%, #e9ecef 100%)`;
		}
	};

	function startJob(){
		if(gameData.jobEndTime > Date.now()) return showMsg("Ïù¥ÎØ∏ ÏïåÎ∞îÎ•º ÌïòÍ≥† ÏûàÏäµÎãàÎã§!");
		const slider = document.getElementById('alba-slider');
		const hours = slider ? parseInt(slider.value) : 1;
		
		showConfirm(`${hours}ÏãúÍ∞Ñ ÎèôÏïà ÏïåÎ∞îÎ•º ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`, ()=>{ 
			gameData.jobEndTime = Date.now() + (hours * 60 * 60 * 1000);
			gameData.jobHours = hours;
			saveData(); 
			updateUI(); 
			openTab('alba'); 
		});
	}

    function cancelJob(){
        let durationMs = gameData.jobHours * 60 * 60 * 1000;
        let startTime = gameData.jobEndTime - durationMs;
        let elapsed = Date.now() - startTime;
        let hoursDone = Math.floor(elapsed / (60 * 60 * 1000));
        
        let wage = HOURLY_WAGE;
        if(gameData.skills.alba > 0) wage += Math.floor(wage * (gameData.skills.alba * 0.05));
        let payout = wage * hoursDone;

        let msg = hoursDone > 0 
            ? `ÌòÑÏû¨ <b>${hoursDone}ÏãúÍ∞Ñ</b> Í∑ºÎ¨¥ÌñàÏäµÎãàÎã§.<br>Ï§ëÎã® Ïãú <b>${payout.toLocaleString()}Ïõê</b>Îßå Î∞õÍ≤å Îê©ÎãàÎã§.` 
            : `ÏïÑÏßÅ 1ÏãúÍ∞ÑÎèÑ Í∑ºÎ¨¥ÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.<br>ÏßÄÍ∏à Í∑∏ÎßåÎëêÎ©¥ <b>ÏàòÏûÖÏù¥ ÏóÜÏäµÎãàÎã§.</b>`;

        showConfirm(msg + "<br><br>Ï†ïÎßê Í∑∏ÎßåÎëêÏãúÍ≤†ÏäµÎãàÍπå?", () => {
            gameData.money += payout;
            gameData.jobEndTime = 0;
            gameData.jobHours = 0;
            if(hoursDone > 0) {
                 gameData.stats.albaCount++;
                 gainXP(hoursDone * 5); 
            }
            saveData();
            showMsg("ÏïåÎ∞îÎ•º Ï§ëÎã®ÌïòÍ≥† Ï†ïÏÇ∞Î∞õÏïòÏäµÎãàÎã§.");
            openTab('alba');
            checkAchievements();
        });
    }

    function renderStock(c){
        let interval = isVipActive() ? VIP_DATA[gameData.vip.level].stockMin : 30;
        let h = `<div class="full-height-layout">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>üìà Ï£ºÏãù ÏãúÏû• <span style="font-size:0.7rem; font-weight:normal;">Í∞±Ïã†: ${interval}Î∂Ñ</span></h3>
            <button class="btn-sm btn-outline" onclick="showStockHistory()">üìú Í∏∞Î°ù</button>
        </div>
        <div class="scroll-view">`;
        for(let n in gameData.stocks){let s=gameData.stocks[n];h+=`<div class="stock-item"><div class="stock-info"><b>${n}</b><span>${s.p.toLocaleString()}Ïõê</span></div><div class="stock-cnt">${s.n}Ï£º</div><div class="stock-actions"><button class="btn-outline" onclick="tradeStock('${n}',1)">Îß§Ïàò</button><button class="btn-danger" onclick="tradeStock('${n}',-1)">Îß§ÎèÑ</button></div></div>`;}
        c.innerHTML = h + `</div><p style='text-align:center;font-size:0.75rem;color:#6b7280;background:#f3f4f6;padding:8px;border-radius:10px;'><span id="stock-timer" style="color:var(--primary);font-weight:bold;">(Í≥ÑÏÇ∞ Ï§ë...)</span></p></div>`;
    }
    
    function showStockHistory(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        
        let html = `<h3>üìú Í±∞Îûò ÎÇ¥Ïó≠</h3>`;
        if(!gameData.stockHistory || gameData.stockHistory.length === 0){
            html += `<p style="padding:20px; color:#999;">Í±∞Îûò Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§.</p>`;
        } else {
            html += `<div class="history-container"><table class="history-table">
                <thead><tr><th>Ï¢ÖÎ™©</th><th>Íµ¨Î∂Ñ</th><th>Îã®Í∞Ä(ÏàòÎüâ)</th></tr></thead><tbody>`;
            [...gameData.stockHistory].reverse().forEach(h => {
                html += `<tr>
                    <td>${h.name}</td>
                    <td class="${h.type==='Îß§Ïàò'?'buy':'sell'}">${h.type}</td>
                    <td>${h.price.toLocaleString()}Ïõê (${h.count}Ï£º)</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        }
        
        t.innerHTML = html;
        b.innerHTML = `<button onclick="closeModal()">Îã´Í∏∞</button>`;
        o.style.display='flex';
    }

    function tradeStock(n,d){
        const p=gameData.stocks[n].p;
        if(d===1&&gameData.money>=p){
            gameData.money-=p; gameData.stocks[n].n++;
            gameData.stats.stockBuyCount = (gameData.stats.stockBuyCount||0) + 1;
            recordStockTrade(n, 'Îß§Ïàò', p);
        }
        else if(d===-1&&gameData.stocks[n].n>0){
            gameData.money+=p; gameData.stocks[n].n--;
            gameData.stats.stockSellCount = (gameData.stats.stockSellCount||0) + 1;
            recordStockTrade(n, 'Îß§ÎèÑ', p);
        }
        else return showMsg("ÏûîÏï°/Ï£ºÏãù Î∂ÄÏ°±");
        gameData.stats.stockTrades++; saveData(); checkAchievements(); openTab('stock');
    }

    function recordStockTrade(name, type, price){
        if(!gameData.stockHistory) gameData.stockHistory = [];
        const last = gameData.stockHistory[gameData.stockHistory.length - 1];
        
        if(last && last.name === name && last.type === type && last.price === price){
            last.count++;
        } else {
            gameData.stockHistory.push({ name: name, type: type, price: price, count: 1, time: Date.now() });
        }
    }

    function renderBank(c){
        const limit = gameData.level * 100000;
        c.innerHTML = `<div class="full-height-layout"><div><h3>üí∏ ÏÇ¨Ï±Ñ ÏÇ¨Î¨¥ÏÜå</h3><p style="color:#ef4444; font-weight:bold; font-size:0.85rem;">"Í∏âÏ†Ñ ÌïÑÏöîÌï¥? Î∂ÑÎãπ 5%Ïïº. Î™ª Í∞öÏúºÎ©¥ ÏïåÏßÄ?"</p></div><div style="flex-grow:1;display:flex;flex-direction:column;justify-content:center;"><div class="bank-info"><span class="compact-label">ÌòÑÏû¨ ÎåÄÏ∂úÍ∏à</span><div class="bank-debt">${gameData.debt.toLocaleString()}Ïõê</div><span class="bank-limit">Ïã†Ïö© ÌïúÎèÑ: ${limit.toLocaleString()}Ïõê (Lv.${gameData.level})</span></div><div class="input-group"><input type="number" id="loanAmt" placeholder="Í∏àÏï° ÏûÖÎ†•"></div><div style="display:flex;gap:10px;margin-top:10px;"><button class="btn-success" onclick="borrowMoney(${limit})" style="flex:1;">ÎåÄÏ∂úÌïòÍ∏∞</button><button class="btn-danger" onclick="repayMoney()" style="flex:1;">ÏÉÅÌôòÌïòÍ∏∞</button></div></div></div>`;
    }
    function borrowMoney(limit){
        const amt = Number(document.getElementById('loanAmt').value);
        if(amt <= 0) return showMsg("Ïò¨Î∞îÎ•∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."); if(gameData.debt + amt > limit) return showMsg("Ïã†Ïö© ÌïúÎèÑÎ•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§.");
        if(gameData.debt === 0) gameData.lastInterest = Date.now();
        gameData.money += amt; gameData.debt += amt; 
        
        gameData.stats.maxDebt = Math.max(gameData.stats.maxDebt || 0, gameData.debt);
        gameData.stats.loanCount++; saveData(); checkAchievements();
        showMsg(`${amt.toLocaleString()}ÏõêÏùÑ ÎπåÎ†∏ÏäµÎãàÎã§.<br><span style='color:red;font-size:0.8rem;'>Ïù¥Ï†úÎ∂ÄÌÑ∞ 1Î∂ÑÎßàÎã§ Ïù¥ÏûêÍ∞Ä Î∂ôÏäµÎãàÎã§.</span>`); openTab('bank');
    }
    function repayMoney(){
        const amt = Number(document.getElementById('loanAmt').value);
        if(amt <= 0) return showMsg("Ïò¨Î∞îÎ•∏ Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."); if(amt > gameData.money) return showMsg("Í∞ÄÏßÑ ÎèàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§."); if(gameData.debt === 0) return showMsg("Í∞öÏùÑ ÎπöÏù¥ ÏóÜÏäµÎãàÎã§.");
        const pay = Math.min(amt, gameData.debt); gameData.money -= pay; gameData.debt -= pay; saveData(); checkAchievements();
        showMsg(`${pay.toLocaleString()}ÏõêÏùÑ ÏÉÅÌôòÌñàÏäµÎãàÎã§.`); openTab('bank');
    }
    function calcXP(b){return Math.max(1,Math.floor(b/100));} function r(m){return Math.floor(Math.random()*m)+1;}

    // --- Í≤åÏûÑ Î°úÏßÅ ---
    function renderDice(c){
        c.innerHTML=`<div class="full-height-layout"><div><h3>üé≤ Ï£ºÏÇ¨ÏúÑ</h3><p>ÎîúÎü¨Î≥¥Îã§ ÎÜíÏùÄ Ïà´ÏûêÍ∞Ä ÎÇòÏò§Î©¥ ÏäπÎ¶¨!</p></div>
        <div id="dice-start" class="start-screen"><div class="start-icon">üé≤</div></div>
        <div id="dice-game" style="display:none;flex-grow:1;flex-direction:column;"><div class="game-board"><div class="compact-board"><div class="compact-col"><span class="compact-label">ÎîúÎü¨</span><div id="dd"></div></div><div class="compact-vs"></div><div class="compact-col"><span class="compact-label" style="color:var(--primary)">ÎÇò</span><div id="md"></div></div></div><div id="dm" style="text-align:center;font-weight:bold;height:20px;"></div></div><button id="dn" onclick="diceN()">Íµ¥Î¶¨Í∏∞</button></div>
        
        <div id="dice-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-dice-item"><span class="item-toggle-indicator"></span> <span id="use-dice-item-label">üé≤ ÏäπÎ¶¨ Ï£ºÏÇ¨ÏúÑ</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="dB" placeholder="Î∞∞ÌåÖÍ∏à"><button onclick="diceGo()">ÏãúÏûë</button>
            </div>
        </div>
        </div>`; 
    }
    function diceGo(){
        const b=Number(document.getElementById('dB').value); if(b<=0||b>gameData.money)return showMsg('Î∞∞ÌåÖÍ∏à ÌôïÏù∏');
        const useItem = document.getElementById('use-dice-item').checked;
        if(useItem && gameData.inventory.diceWin <= 0) return showMsg("ÏïÑÏù¥ÌÖú Î∂ÄÏ°±");
        gameData.money-=b; 
        if(useItem){ gameData.inventory.diceWin--; gameData.stats.itemsUsed++; gameData.stats.diceItemUsed++; diceState.usedItem = true; } 
        else { diceState.usedItem = false; }
        saveData();
        diceState.step=0; diceState.bet=b; 
        if(diceState.usedItem) { diceState.myDice=[6,6,6]; diceState.dealerDice=[1,1,1]; }
        else { diceState.myDice=[r(6),r(6),r(6)]; diceState.dealerDice=[r(6),r(6),r(6)]; }
        
        document.getElementById('dice-start').style.display='none'; document.getElementById('dice-ctrl').style.display='none'; document.getElementById('dice-game').style.display='flex'; diceN();
    }
    function diceN(){
        diceState.step++;
        
        if(diceState.step === 3 && !diceState.usedItem && gameData.skills.diceProb > 0){
            let mySum = diceState.myDice.reduce((a,b)=>a+b,0);
            let dealerSum = diceState.dealerDice.reduce((a,b)=>a+b,0);
            if(mySum <= dealerSum){
                if(Math.random() < (gameData.skills.diceProb * 0.01)){
                    diceState.dealerDice = [1, 1, 1];
                }
            }
        }

        const dr=(a,s)=>a.map((v,i)=>`<div class="dice-num ${i<s?'':'dice-hidden'}">${i<s?v:'?'}</div>`).join('');
        document.getElementById('dd').innerHTML=dr(diceState.dealerDice,diceState.step); document.getElementById('md').innerHTML=dr(diceState.myDice,diceState.step);
        let b=document.getElementById('dn'),m=document.getElementById('dm');
        if(diceState.step===1){m.innerText="Ï≤´ Î≤àÏß∏ Í≥µÍ∞ú";b.innerText="Îëê Î≤àÏß∏";}
        else if(diceState.step===2){m.innerText="ÏäπÎ∂ÄÏùò ÏàúÍ∞Ñ!";b.innerText="Í≤∞Í≥º ÌôïÏù∏";b.className="btn-danger";}
        else{
            let x=diceState.myDice.reduce((a,b)=>a+b,0),y=diceState.dealerDice.reduce((a,b)=>a+b,0);
            
            if(diceState.myDice.every(v=>v===1)) { gameData.stats.snakeEyesCount = (gameData.stats.snakeEyesCount||0) + 1; }
            if(!diceState.usedItem && x===18) { gameData.stats.perfectSixCount = (gameData.stats.perfectSixCount||0) + 1; }

            if(x>y){ 
                let profit=processResult(true,diceState.bet,2,'dice'); gameData.stats.diceWins++; 
                let xp=calcXP(diceState.bet); gainXP(xp); m.innerHTML=`<span style="color:var(--success)">ÏäπÎ¶¨! +${profit.toLocaleString()}</span> <span class="xp-gain">(+${xp} XP)</span>`; 
            }
            else if(x<y){ let rb=processResult(false,diceState.bet,0,'dice'); m.innerHTML=`<span style="color:var(--danger)">Ìå®Î∞∞...</span>${rb<0?` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} ÌôòÍ∏â)</span>`:''}`; }
            else{ gameData.money+=diceState.bet; m.innerText="Î¨¥ÏäπÎ∂Ä (Î∞∞ÌåÖÍ∏à Î∞òÌôò)"; saveData(); }
            b.innerText="Îã§Ïãú ÌïòÍ∏∞"; b.className=""; b.onclick=()=>openTab('dice');
        }
    }
    
    function renderBlackjack(c){ 
        c.innerHTML=`<div class="full-height-layout"><div><h3>üÉè Î∏îÎûôÏû≠</h3><p>21ÏùÑ ÎÑòÏßÄ ÏïäÍ≥† ÎîúÎü¨Î•º Ïù¥Í∏∞ÏÑ∏Ïöî.</p></div>
        <div id="bj-start" class="start-screen"><div class="start-icon">üÉè</div></div>
        <div id="bj-game" style="display:none;flex-grow:1;flex-direction:column;"><div class="game-board"><div class="compact-board"><div class="compact-col"><span class="compact-label">ÎîúÎü¨ <span id="bds"></span></span><div id="bdh"></div></div><div class="compact-vs"></div><div class="compact-col"><span class="compact-label" style="color:var(--primary)">ÎÇò <span id="bms"></span></span><div id="bmh"></div></div></div><div id="br" style="text-align:center;font-weight:bold;height:20px;"></div></div><div id="ba" style="display:flex;gap:8px;flex-wrap:wrap;"><button onclick="hit()" class="btn-success">ÌûàÌä∏</button><button onclick="stand()" class="btn-danger">Ïä§ÌÉ†Îìú</button></div></div>
        
        <div id="bj-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-bj-item"><span class="item-toggle-indicator"></span> <span id="use-bj-item-label">üÉè ÎîúÎü¨ Ï†úÏïΩ</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="bB" placeholder="Î∞∞ÌåÖÍ∏à"><button onclick="bjGo()">ÏãúÏûë</button>
            </div>
        </div>
        </div>`; 
    }
    function bjGo(){
        const b=Number(document.getElementById('bB').value); if(b<=0||b>gameData.money)return showMsg('Î∞∞ÌåÖÍ∏à ÌôïÏù∏');
        const useItem = document.getElementById('use-bj-item').checked;
        if(useItem && gameData.inventory.bjCard <= 0) return showMsg("ÏïÑÏù¥ÌÖú Î∂ÄÏ°±");
        gameData.money-=b;
        if(useItem){ gameData.inventory.bjCard--; gameData.stats.itemsUsed++; gameData.stats.bjItemUsed++; }
        saveData();
        const s=['‚ô†','‚ô£','‚ô•','‚ô¶'],v=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; let d=[]; for(let i of s)for(let j of v)d.push({s:i,v:j}); d.sort(()=>Math.random()-0.5);
        bjState={deck:d,playerHand:[d.pop(),d.pop()],dealerHand:[d.pop(),d.pop()],bet:b,playing:true, itemUsed: useItem};
        document.getElementById('bj-start').style.display='none'; document.getElementById('bj-ctrl').style.display='none'; document.getElementById('bj-game').style.display='flex';
        upBJ(); if(getBJS(bjState.playerHand)===21){bjState.playing=false;upBJ(true);if(getBJS(bjState.dealerHand)===21)endBJ("Ìë∏Ïãú (Îëò Îã§ Î∏îÎûôÏû≠)",1);else endBJ("üéâ Î∏îÎûôÏû≠!",2.5);}
    }
    function getBJS(h){let s=0,a=0;for(let c of h){if(['J','Q','K'].includes(c.v))s+=10;else if(c.v==='A'){s+=11;a++}else s+=Number(c.v)}while(s>21&&a>0){s-=10;a--}return s;}
    function upBJ(rev=false){
        const dc=(c)=>`<div class="card ${['‚ô•','‚ô¶'].includes(c.s)?'red':''}">${c.s}<br>${c.v}</div>`;
        document.getElementById('bdh').innerHTML = rev ? bjState.dealerHand.map(dc).join('') : dc(bjState.dealerHand[0]) + `<div class="card card-hidden">?</div>`;
        document.getElementById('bds').innerText=rev?getBJS(bjState.dealerHand):"?";
        document.getElementById('bmh').innerHTML=bjState.playerHand.map(dc).join(''); document.getElementById('bms').innerText=getBJS(bjState.playerHand);
    }
    function hit(){if(!bjState.playing)return;bjState.playerHand.push(bjState.deck.pop());upBJ();if(getBJS(bjState.playerHand)>21)endBJ("Î≤ÑÏä§Ìä∏! Ìå®Î∞∞");}
    function stand(){
        if(!bjState.playing)return; bjState.playing=false;
        
        let limit = 17;
        if(bjState.itemUsed) limit = 15;
        else if(gameData.skills.bjStand > 0) {
            if(Math.random() < (gameData.skills.bjStand * 0.02)) limit = 15;
        }

        while(getBJS(bjState.dealerHand)<limit)bjState.dealerHand.push(bjState.deck.pop());
        upBJ(true); let p=getBJS(bjState.playerHand),d=getBJS(bjState.dealerHand);
        if(d>21)endBJ("ÎîúÎü¨ Î≤ÑÏä§Ìä∏! ÏäπÎ¶¨",2);else if(p>d)endBJ("ÏäπÎ¶¨!",2);else if(p<d)endBJ("Ìå®Î∞∞",0);else endBJ("Î¨¥ÏäπÎ∂Ä",1);
    }
    function endBJ(m,mul=0){
        bjState.playing=false; let profit=0, xp=0;
        if(mul > 1) { profit=processResult(true, bjState.bet, mul, 'blackjack'); gameData.stats.bjWins++; xp=calcXP(bjState.bet); gainXP(xp); }
        else if(mul === 1) { gameData.money += bjState.bet; saveData(); }
        else { let rb = processResult(false, bjState.bet, 0, 'blackjack'); if(rb < 0) m += ` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} ÌôòÍ∏â)</span>`; }
        let r=document.getElementById('br'); r.innerHTML=m+(xp>0?` <span class="xp-gain">(+${xp} XP)</span>`:""); r.style.color=mul>1?'var(--success)':mul==0?'var(--danger)':'var(--dark)';
        document.getElementById('ba').innerHTML=`<button onclick="openTab('blackjack')">Îã§Ïãú ÌïòÍ∏∞</button>`; updateUI();
    }
    
    function renderRoulette(c){
        c.innerHTML=`<div class="full-height-layout"><div><h3>üé° Î£∞Î†õ</h3><p>ÌñâÏö¥Ïùò ÏÉâÏÉÅÏù¥ÎÇò Ïà´ÏûêÎ•º ÏòàÏ∏°Ìï¥Î≥¥ÏÑ∏Ïöî.</p></div>
        <div id="rt-area" style="flex-grow:1;display:flex;flex-direction:column;justify-content:center;"><div style="text-align:center;"><select id="rt" style="margin-bottom:10px;width:100%;"><option value="c">ÏÉâÏÉÅ(2Î∞∞)</option><option value="n">Ïà´Ïûê(36Î∞∞)</option></select><div id="ro"></div></div></div>
        <div id="rt-wheel-area" style="display:none;flex-grow:1;justify-content:center;align-items:center;flex-direction:column;"><div class="roulette-wrapper"><div id="rv" class="roulette-wheel">GO</div></div><div id="rr" style="text-align:center;font-weight:bold;height:20px;"></div></div>
        
        <div id="rt-ctrl" style="margin-top:auto;">
            <div style="display:flex; justify-content:flex-end; margin-bottom:5px;">
                 <label class="item-toggle"><input type="checkbox" id="use-rt-item"><span class="item-toggle-indicator"></span> <span id="use-rt-item-label">üß≤ ÏûêÏÑù</span></label>
            </div>
            <div class="input-group" style="margin-top:0; padding-top:0;">
                <input type="number" id="rb" placeholder="Î∞∞ÌåÖÍ∏à"><button onclick="rSpin()" class="btn-warning">ÎèåÎ¶¨Í∏∞</button>
            </div>
        </div>
        <button id="rt-reset" onclick="openTab('roulette')" style="display:none;width:100%;">Îã§Ïãú ÌïòÍ∏∞</button></div>`;
        window.rtUIChange=function(){const v=document.getElementById('rt').value,a=document.getElementById('ro');if(v==='c'){a.innerHTML=`<div class="rt-choice-box"><label class="rt-radio-label red-opt" onclick="selectRtColor(this)">üü• Red<input type="radio" name="rk" value="red"></label><label class="rt-radio-label black-opt" onclick="selectRtColor(this)">‚¨õ Black<input type="radio" name="rk" value="black"></label></div>`;selectRtColor(a.querySelector('.red-opt'));}else{a.innerHTML=`<input type="number" id="rn" min="0" max="36" placeholder="0~36 Ïà´Ïûê">`;}};document.getElementById('rt').onchange=window.rtUIChange;window.rtUIChange();
    }
    window.selectRtColor=function(e){document.querySelectorAll('.rt-radio-label').forEach(l=>l.classList.remove('selected'));e.classList.add('selected');e.querySelector('input').checked=true;}
    function rSpin(){
        const b=Number(document.getElementById('rb').value),t=document.getElementById('rt').value; if(b<=0||b>gameData.money)return showMsg('Î∞∞ÌåÖÍ∏à ÌôïÏù∏');
        const useItem = document.getElementById('use-rt-item').checked;
        if(useItem && gameData.inventory.magnet <= 0) return showMsg("ÏïÑÏù¥ÌÖú Î∂ÄÏ°±");
        
        let ch; if(t==='c'){const k=document.querySelector('input[name="rk"]:checked');if(!k)return showMsg("ÏÉâÏÉÅ ÏÑ†ÌÉù ÌïÑÏöî");ch=k.value;}else{ch=Number(document.getElementById('rn').value);if(ch<0||ch>36||isNaN(ch))return showMsg('0~36 Ïà´Ïûê ÏûÖÎ†•');}
        
        gameData.money-=b; 
        if(useItem){ gameData.inventory.magnet--; gameData.stats.itemsUsed++; }
        saveData(); updateUI();
        
        document.getElementById('rt-area').style.display='none';document.getElementById('rt-ctrl').style.display='none';document.getElementById('rt-wheel-area').style.display='flex';
        let cnt=0,el=document.getElementById('rv'),iv=setInterval(()=>{
            let n=r(37)-1,c=n===0?'green':n%2===0?'black':'red';el.innerText=n;el.style.color=c;
            if(++cnt>20){clearInterval(iv);rEnd(n,t,ch,b,useItem);} 
        },80);
    }
    function rEnd(n,t,c,b,useItem){
        if(useItem){
            if(t === 'c'){
                if(Math.random() < 0.9) {
                    if(c === 'red') n = (Math.floor(Math.random() * 18) * 2) + 1; 
                    else n = (Math.floor(Math.random() * 18) * 2) + 2; 
                    if(n>36) n=36;
                }
            } else {
                if(Math.random() < 0.3) n = c;
            }
        } 
        else if(gameData.skills.rtProb > 0){
             let prob = gameData.skills.rtProb * 0.01;
             if(Math.random() < prob){
                 if(t === 'c'){
                    if(c === 'red') n = (Math.floor(Math.random() * 18) * 2) + 1; 
                    else n = (Math.floor(Math.random() * 18) * 2) + 2;
                 } else {
                    n = c;
                 }
             }
        }

        let el=document.getElementById('rv'); el.innerText=n; el.style.color=n===0?'green':n%2!==0?'red':'black';
        let rc=n===0?'green':n%2!==0?'red':'black',w=false,m=0;
        if(t==='c'){if(c===rc){w=true;m=2;}} else{if(c===n){w=true;m=36;}}
        
        if(w && n===0) { gameData.stats.rouletteZeroWins = (gameData.stats.rouletteZeroWins||0) + 1; }
        if(w && t==='c' && c==='red') { gameData.stats.rouletteRedWins = (gameData.stats.rouletteRedWins||0) + 1; }

        if(w){ 
            processResult(true, b, m, 'roulette'); gameData.stats.rouletteWins++; 
            let xp=calcXP(b); gainXP(xp); document.getElementById('rr').innerHTML=`<span style="color:var(--success)">Ï∂ïÌïòÌï©ÎãàÎã§! +${b*m}</span>`; 
        } 
        else { let rb = processResult(false, b, 0, 'roulette'); document.getElementById('rr').innerHTML=`<span style="color:var(--danger)">ÍΩù!</span>${rb<0 ? ` <span style='font-size:0.7rem;color:#10b981'>(+${-rb} ÌôòÍ∏â)</span>` : ''}`; }
        document.getElementById('rt-reset').style.display='block';
    }
    
	// --- Ïä¨Î°ØÎ®∏Ïã† ---
	function slotsTab(){
		const g = document.getElementById('content-area');
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:8px;">
					<h3 style="margin:0 0 3px 0; font-size:1rem;">üé∞ Ïä¨Î°ØÎ®∏Ïã†</h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">3Í∞ú ÏùºÏπòÎ°ú ÎåÄÎ∞ï! 2Í∞ú ÏùºÏπòÎäî Î≥∏Ï†Ñ!</p>
				</div>
				<div style="background:linear-gradient(135deg, #1f2937, #374151); padding:12px; border-radius:12px; margin-bottom:8px; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
					<div id="slot-display" style="display:flex; justify-content:center; gap:6px; margin:8px 0;">
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">üçí</div>
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">üçí</div>
						<div class="slot-reel" style="background:linear-gradient(180deg, #fff, #f3f4f6); padding:12px 8px; border-radius:10px; min-width:55px; text-align:center; font-size:2.2rem; box-shadow:inset 0 2px 6px rgba(0,0,0,0.1), 0 3px 5px rgba(0,0,0,0.2); border:2px solid #fbbf24; overflow:hidden; height:70px; display:flex; align-items:center; justify-content:center;">üçí</div>
					</div>
					<div style="background:rgba(0,0,0,0.3); padding:6px; border-radius:6px; margin-top:8px;">
						<div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; font-size:0.65rem; color:#d1d5db;">
							<div>üçíx3: 1.5Î∞∞</div>
							<div>üçãüçäx3: 2Î∞∞</div>
							<div>üçáüíéx3: 5Î∞∞</div>
							<div>7Ô∏è‚É£x3: Ïû≠Ìåü!</div>
						</div>
					</div>
				</div>
				<div id="slot-result" style="text-align:center; min-height:30px; font-weight:bold; margin-bottom:8px; font-size:0.85rem;"></div>
				<div class="input-group" style="margin-top:auto;">
					<input type="number" id="slot-bet" placeholder="Î∞∞ÌåÖÍ∏à">
					<button onclick="spinSlots()" class="btn-warning">üé∞ ÎèåÎ¶¨Í∏∞</button>
				</div>
			</div>
		`;
	}

	function spinSlots(){
		const bet = Number(document.getElementById('slot-bet').value);
		if(bet <= 0 || bet > gameData.money) return showMsg('Î∞∞ÌåÖÍ∏à ÌôïÏù∏');
		
		gameData.money -= bet;
		saveData();
		updateUI();
		
		const symbols = ['üçí', 'üçã', 'üçä', 'üçá', 'üíé', '7Ô∏è‚É£'];
		const reels = document.querySelectorAll('.slot-reel');
		const resultDiv = document.getElementById('slot-result');
		resultDiv.innerHTML = '<span style="color:#fbbf24;">Î¶¥Ïù¥ ÎèåÏïÑÍ∞ÄÎäî Ï§ë...</span>';
		
		// Í∞Å Î¶¥ÏùÑ ÏàúÏ∞®Ï†ÅÏúºÎ°ú Î©àÏ∂îÍ∏∞
		const finalResults = [];
		// Í∏∞Î≥∏ ÌôïÎ•†
				let weights = [0.3, 0.3, 0.2, 0.15, 0.04, 0.01];
				
				// ÏäπÎ•† Ïä§ÌÇ¨ Ï†ÅÏö© (ÍΩù ÌôïÎ•† Í∞êÏÜå, ÎãπÏ≤® ÌôïÎ•† Ï¶ùÍ∞Ä)
				if(gameData.skills.slotProb > 0) {
					const probBonus = gameData.skills.slotProb * 0.01;
					weights[0] -= probBonus; // ÍΩù ÌôïÎ•† Í∞êÏÜå
					weights[2] += probBonus * 0.4; // Ï≤¥Î¶¨ ÌôïÎ•† Ï¶ùÍ∞Ä
					weights[3] += probBonus * 0.4; // 2Î∞∞ ÌôïÎ•† Ï¶ùÍ∞Ä
					weights[4] += probBonus * 0.15; // 5Î∞∞ ÌôïÎ•† Ï¶ùÍ∞Ä
					weights[5] += probBonus * 0.05; // Ïû≠Ìåü ÌôïÎ•† Ï¶ùÍ∞Ä
				}
		const rand = Math.random();
		let cumulative = 0;
		let outcomeType = 0;
		
		for(let i = 0; i < weights.length; i++){
			cumulative += weights[i];
			if(rand < cumulative){
				outcomeType = i;
				break;
			}
		}
		
		if(outcomeType === 0){
			finalResults[0] = symbols[0];
			finalResults[1] = symbols[1];
			finalResults[2] = symbols[2];
		} else if(outcomeType === 1){
			const sym = symbols[Math.floor(Math.random() * 4)];
			finalResults[0] = sym;
			finalResults[1] = sym;
			finalResults[2] = symbols[Math.floor(Math.random() * symbols.length)];
			while(finalResults[2] === sym) finalResults[2] = symbols[Math.floor(Math.random() * symbols.length)];
		} else if(outcomeType === 2){
			finalResults[0] = finalResults[1] = finalResults[2] = 'üçí';
		} else if(outcomeType === 3){
			const sym = Math.random() < 0.5 ? 'üçã' : 'üçä';
			finalResults[0] = finalResults[1] = finalResults[2] = sym;
		} else if(outcomeType === 4){
			const sym = Math.random() < 0.5 ? 'üçá' : 'üíé';
			finalResults[0] = finalResults[1] = finalResults[2] = sym;
		} else {
			finalResults[0] = finalResults[1] = finalResults[2] = '7Ô∏è‚É£';
		}
		
		// Í∞Å Î¶¥ Ïï†ÎãàÎ©îÏù¥ÏÖò
		reels.forEach((reel, index) => {
			let count = 0;
			const duration = 15 + (index * 10); // Í∞Å Î¶¥ÎßàÎã§ ÏàúÏ∞®Ï†ÅÏúºÎ°ú Î©àÏ∂§
			const interval = setInterval(() => {
				reel.textContent = symbols[Math.floor(Math.random() * symbols.length)];
				reel.style.transform = 'translateY(-10px)';
				setTimeout(() => {
					reel.style.transform = 'translateY(0)';
				}, 50);
				
				if(++count > duration) {
					clearInterval(interval);
					reel.textContent = finalResults[index];
					reel.style.transform = 'scale(1.1)';
					setTimeout(() => {
						reel.style.transform = 'scale(1)';
					}, 200);
					
					// ÎßàÏßÄÎßâ Î¶¥Ïù¥ Î©àÏ∂îÎ©¥ Í≤∞Í≥º ÌëúÏãú
					if(index === 2) {
						setTimeout(() => showSlotResult(finalResults, bet, resultDiv), 300);
					}
				}
			}, 80);
		});
	}
	
	function showSlotResult(results, bet, resultDiv){
		let multiplier = 0;
		let message = '';
		
		if(results[0] === results[1] && results[1] === results[2]){
			if(results[0] === 'üçí'){
				multiplier = 1.5;
				message = 'üçí Ï≤¥Î¶¨ 3Í∞ú! 1.5Î∞∞!';
			} else if(results[0] === 'üçã' || results[0] === 'üçä'){
				multiplier = 2;
				message = `${results[0]} 3Í∞ú! 2Î∞∞ ÎãπÏ≤®!`;
			} else if(results[0] === 'üçá' || results[0] === 'üíé'){
				multiplier = 5;
				message = `${results[0]} 3Í∞ú! 5Î∞∞ ÎåÄÎ∞ï!`;
			} else if(results[0] === '7Ô∏è‚É£'){
				multiplier = 10;
				message = 'üéâ Ïû≠Ìåü! 7Ô∏è‚É£ 10Î∞∞!!!';
			}
		} else if(results[0] === results[1] || results[1] === results[2] || results[0] === results[2]){
			multiplier = 1;
			message = '2Í∞ú ÏùºÏπò - Î≥∏Ï†Ñ!';
		} else {
			multiplier = 0;
			message = 'ÍΩù! Îã§Ïùå Í∏∞ÌöåÏóê...';
		}
		
		if(multiplier > 0){
			// Ïä§ÌÇ¨ Î≥¥ÎÑàÏä§ Ï†ÅÏö©
			let bonusMult = 0;
			if(gameData.skills.slotPay > 0) bonusMult = gameData.skills.slotPay * 0.03;
			let totalMult = multiplier * (1 + bonusMult);
			
			const winAmount = Math.floor(bet * totalMult);
			gameData.money += winAmount;
			gameData.stats.slotsWins = (gameData.stats.slotsWins || 0) + 1;
			if(isJackpot) gameData.stats.slotJackpots = (gameData.stats.slotJackpots || 0) + 1;
			resultDiv.innerHTML = `<span style="color:var(--success)">${message}<br>+${winAmount.toLocaleString()}Ïõê</span>`;
			gainXP(calcXP(bet));
		} else {
			// Ìå®Î∞∞ Ïãú ÌôòÍ∏â
			let rebateRate = 0;
			if(gameData.skills.slots > 0) rebateRate += (gameData.skills.slots * 0.01);
			
			if(rebateRate > 0){
				const rebate = Math.floor(bet * rebateRate);
				gameData.money += rebate;
				resultDiv.innerHTML = `<span style="color:var(--danger)">${message}</span> <span style='font-size:0.7rem;color:#10b981'>(+${rebate.toLocaleString()}Ïõê ÌôòÍ∏â)</span>`;
			} else {
				resultDiv.innerHTML = `<span style="color:var(--danger)">${message}</span>`;
			}
			gameData.stats.slotsLosses = (gameData.stats.slotsLosses || 0) + 1;
		}
		
		saveData();
		updateUI();
	}

	// --- ÏïºÎ∞îÏúÑ ---
	let shellAnswer = -1;
	let shellBet = 0;
	let shellShuffling = false;
	
	function shellTab(){
		const g = document.getElementById('content-area');
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:8px;">
					<h3 style="margin:0 0 3px 0; font-size:1rem;">ü•ú ÏïºÎ∞îÏúÑ</h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">ÎïÖÏΩ©Ïù¥ Ïà®Í≤®ÏßÑ ÏªµÏùÑ Ï∞æÏúºÎ©¥ 3Î∞∞!</p>
				</div>
				<div style="background:linear-gradient(135deg, #7c3aed, #a855f7); padding:15px; border-radius:12px; margin-bottom:8px; box-shadow:0 4px 12px rgba(124,58,237,0.3); position:relative;">
					<div style="position:absolute; top:8px; right:8px; background:rgba(255,255,255,0.2); padding:3px 8px; border-radius:15px; font-size:0.65rem; color:white; font-weight:bold;">ÌôïÎ•†: 33%</div>
					<div id="shell-area" style="display:flex; justify-content:center; gap:10px; margin:15px 0; min-height:100px; align-items:center;">
						<div class="shell-cup" data-pos="0" onclick="selectShell(0)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ü•§</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">1Î≤à</div>
						</div>
						<div class="shell-cup" data-pos="1" onclick="selectShell(1)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ü•§</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">2Î≤à</div>
						</div>
						<div class="shell-cup" data-pos="2" onclick="selectShell(2)" style="background:rgba(255,255,255,0.95); padding:12px; border-radius:14px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.2); border:2px solid rgba(255,255,255,0.6); transition:all 0.3s;">
							<div class="cup-icon" style="font-size:2.2rem; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));">ü•§</div>
							<div style="font-size:0.7rem; margin-top:3px; font-weight:bold; color:#7c3aed;">3Î≤à</div>
						</div>
					</div>
					<div id="shell-hint" style="text-align:center; color:white; font-size:0.75rem; margin-top:5px; font-weight:bold; min-height:20px;">Î∞∞ÌåÖ ÌõÑ ÏãúÏûëÌïòÏÑ∏Ïöî!</div>
				</div>
				<div id="shell-result" style="text-align:center; min-height:30px; font-weight:bold; margin-bottom:8px; font-size:0.85rem;"></div>
				<div class="input-group" style="margin-top:auto;">
					<input type="number" id="shell-bet" placeholder="Î∞∞ÌåÖÍ∏à">
					<button onclick="startShell()" class="btn-warning" id="shell-start-btn">üé≤ ÏãúÏûë</button>
				</div>
			</div>
		`;
		shellShuffling = false;
	}

	function startShell(){
		const bet = Number(document.getElementById('shell-bet').value);
		if(bet <= 0 || bet > gameData.money) return showMsg('Î∞∞ÌåÖÍ∏à ÌôïÏù∏');
		if(shellShuffling) return;
		
		shellShuffling = true;
		gameData.money -= bet;
		shellBet = bet;
		shellAnswer = Math.floor(Math.random() * 3);
		
		saveData();
		updateUI();
		
		document.getElementById('shell-start-btn').disabled = true;
		document.getElementById('shell-result').innerHTML = '';
		document.getElementById('shell-hint').innerHTML = 'ÎïÖÏΩ©ÏùÑ Í∏∞ÏñµÌïòÏÑ∏Ïöî! ü•ú';
		
		const cups = document.querySelectorAll('.shell-cup');
		
		// 1Îã®Í≥Ñ: ÎïÖÏΩ© Î≥¥Ïó¨Ï£ºÍ∏∞
		cups[shellAnswer].querySelector('.cup-icon').textContent = 'ü•ú';
		
		setTimeout(() => {
			cups[shellAnswer].querySelector('.cup-icon').textContent = 'ü•§';
			document.getElementById('shell-hint').innerHTML = 'ÏªµÏùÑ ÏÑûÎäî Ï§ë... üëÄ';
			
			// 2Îã®Í≥Ñ: Ïªµ ÏÑûÍ∏∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
			let shuffleCount = 0;
			const shuffleInterval = setInterval(() => {
				const cup1 = Math.floor(Math.random() * 3);
				let cup2 = Math.floor(Math.random() * 3);
				while(cup2 === cup1) cup2 = Math.floor(Math.random() * 3);
				
				cups[cup1].style.transform = 'translateY(-15px)';
				cups[cup2].style.transform = 'translateY(-15px)';
				
				setTimeout(() => {
					cups[cup1].style.transform = 'translateY(0)';
					cups[cup2].style.transform = 'translateY(0)';
				}, 200);
				
				if(++shuffleCount >= 8) {
					clearInterval(shuffleInterval);
					setTimeout(() => {
						document.getElementById('shell-hint').innerHTML = 'Ïñ¥Îäê ÏªµÏóê ÎïÖÏΩ©Ïù¥ ÏûàÏùÑÍπåÏöî? ü§î';
						document.getElementById('shell-start-btn').disabled = false;
						shellShuffling = false;
					}, 400);
				}
			}, 400);
		}, 1500);
	}

	function selectShell(index){
		if(shellAnswer === -1) return showMsg('Î®ºÏ†Ä Î∞∞ÌåÖÌïòÍ≥† ÏãúÏûëÌïòÏÑ∏Ïöî!');
		if(shellShuffling) return showMsg('ÏªµÏùÑ ÏÑûÎäî Ï§ëÏûÖÎãàÎã§!');
		
		const cups = document.querySelectorAll('.shell-cup');
		
		// Î™®Îì† Ïªµ Í≥µÍ∞ú
		cups.forEach((cup, i) => {
			const icon = cup.querySelector('.cup-icon');
			setTimeout(() => {
				if(i === shellAnswer){
					icon.textContent = 'ü•ú';
					cup.style.transform = 'scale(1.1)';
					cup.style.borderColor = '#10b981';
				} else {
					icon.textContent = '‚ùå';
				}
			}, i * 200);
		});
		
		const resultDiv = document.getElementById('shell-result');
		
		setTimeout(() => {
			if(index === shellAnswer){
				// Ïä§ÌÇ¨ Î≥¥ÎÑàÏä§ Ï†ÅÏö©
				let multiplier = 3;
				if(gameData.skills.shellPay > 0) {
					multiplier *= (1 + gameData.skills.shellPay * 0.03);
				}
				
				const winAmount = Math.floor(shellBet * multiplier);
				gameData.money += winAmount;
				gameData.stats.shellWins = (gameData.stats.shellWins || 0) + 1;
				gameData.stats.shellCurrentStreak = (gameData.stats.shellCurrentStreak || 0) + 1;
				gameData.stats.shellMaxStreak = Math.max(gameData.stats.shellMaxStreak || 0, gameData.stats.shellCurrentStreak);
				resultDiv.innerHTML = `<span style="color:var(--success)">üéâ Ï†ïÎãµ! +${winAmount.toLocaleString()}Ïõê</span>`;
				gainXP(calcXP(shellBet));
			} else {
				// Ìå®Î∞∞ Ïãú ÌôòÍ∏â
				let rebateRate = 0;
				if(gameData.skills.shell > 0) rebateRate += (gameData.skills.shell * 0.01);
				
				if(rebateRate > 0){
					const rebate = Math.floor(shellBet * rebateRate);
					gameData.money += rebate;
					resultDiv.innerHTML = `<span style="color:var(--danger)">‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§! Ï†ïÎãµÏùÄ ${shellAnswer + 1}Î≤à!</span> <span style='font-size:0.7rem;color:#10b981'>(+${rebate.toLocaleString()}Ïõê ÌôòÍ∏â)</span>`;
				} else {
					resultDiv.innerHTML = `<span style="color:var(--danger)">‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§! Ï†ïÎãµÏùÄ ${shellAnswer + 1}Î≤à!</span>`;
				}
				gameData.stats.shellLosses = (gameData.stats.shellLosses || 0) + 1;
				gameData.stats.shellCurrentStreak = 0;
			}
			
			shellAnswer = -1;
			shellBet = 0;
			saveData();
			updateUI();
			
			setTimeout(() => {
				cups.forEach(cup => {
					cup.querySelector('.cup-icon').textContent = 'ü•§';
					cup.style.transform = 'scale(1)';
					cup.style.borderColor = 'rgba(255,255,255,0.6)';
				});
				document.getElementById('shell-hint').innerHTML = 'Îã§Ïãú ÎèÑÏ†ÑÌïòÏÑ∏Ïöî!';
			}, 2500);
		}, 600);
	}

	// --- Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥ ---
	let rpsPlaying = false; // Í≤åÏûÑ ÏßÑÌñâ Ï§ë ÌîåÎûòÍ∑∏
	
	function rpsTab(){
		if(!gameData.rpsStreak) gameData.rpsStreak = 0;
		if(!gameData.rpsTotalReward) gameData.rpsTotalReward = 0;
		
		const g = document.getElementById('content-area');
		const nextReward = Math.pow(2, gameData.rpsStreak) * 1000;
		const canClaim = gameData.rpsStreak >= 3;
		
		g.innerHTML = `
			<div style="display:flex; flex-direction:column; height:100%;">
				<div style="text-align:center; margin-bottom:6px;">
					<h3 style="margin:0 0 2px 0; font-size:1rem;">‚úä Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥</h3>
					<p style="font-size:0.7rem; margin:0; color:#6b7280;">3Ïó∞ÏäπÎ∂ÄÌÑ∞ ÏÉÅÍ∏à ÏàòÎ†π Í∞ÄÎä•! Ìå®Î∞∞ Ïãú Ï¥àÍ∏∞Ìôî</p>
				</div>
				<div style="background:#f9fafb; padding:8px 12px; border-radius:10px; margin-bottom:8px; font-size:0.8rem;">
					<div style="display:flex; justify-content:space-between; margin-bottom:2px;">
						<span style="color:#6b7280;">ÌòÑÏû¨ Ïó∞Ïäπ</span>
						<span style="font-weight:bold; color:var(--primary)">${gameData.rpsStreak}Ïó∞Ïäπ</span>
					</div>
					<div style="display:flex; justify-content:space-between; margin-bottom:2px;">
						<span style="color:#6b7280;">ÎàÑÏ†Å ÏÉÅÍ∏à</span>
						<span style="font-weight:bold; color:${canClaim ? 'var(--success)' : '#9ca3af'}">${gameData.rpsTotalReward.toLocaleString()}Ïõê</span>
					</div>
					<div style="display:flex; justify-content:space-between;">
						<span style="color:#6b7280;">Îã§Ïùå ÏäπÎ¶¨ Ïãú</span>
						<span style="font-weight:bold; color:var(--warning)">+${nextReward.toLocaleString()}Ïõê</span>
					</div>
				</div>
				${canClaim ? `<button onclick="claimRPS()" class="btn-success" style="margin-bottom:8px; padding:10px; font-size:0.9rem;">üí∞ ÏÉÅÍ∏à Î∞õÍ∏∞ (${gameData.rpsTotalReward.toLocaleString()}Ïõê)</button>` : ''}
				<div style="text-align:center; flex-grow:1; display:flex; flex-direction:column; justify-content:center; min-height:80px;">
					<div id="rps-display" style="font-size:3rem; margin:8px 0;">‚ùì</div>
					<div id="rps-result" style="min-height:30px; font-weight:bold; font-size:0.85rem;"></div>
				</div>
				<div id="rps-buttons" style="display:flex; gap:6px; justify-content:center; margin-top:auto;">
					<button onclick="playRPS('‚úä')" style="flex:1; font-size:1.8rem; padding:10px;">‚úä</button>
					<button onclick="playRPS('‚úã')" style="flex:1; font-size:1.8rem; padding:10px;">‚úã</button>
					<button onclick="playRPS('‚úåÔ∏è')" style="flex:1; font-size:1.8rem; padding:10px;">‚úåÔ∏è</button>
				</div>
			</div>
		`;
		rpsPlaying = false;
	}
	
	function claimRPS(){
		if(gameData.rpsStreak < 3 || gameData.rpsTotalReward <= 0) return showMsg('ÏàòÎ†π Í∞ÄÎä•Ìïú ÏÉÅÍ∏àÏù¥ ÏóÜÏäµÎãàÎã§!');
		
		const reward = gameData.rpsTotalReward;
		const streak = gameData.rpsStreak;
		
		gameData.money += reward;
		
		// 7Ïó∞Ïäπ Ïù¥ÏÉÅ ÏÉÅÍ∏à ÏàòÎ†π ÏóÖÏ†Å
		if(streak >= 7) {
			gameData.stats.rpsBigWin = (gameData.stats.rpsBigWin || 0) + 1;
		}
		gameData.stats.rpsClaimed = (gameData.stats.rpsClaimed || 0) + 1;
		gameData.rpsStreak = 0;
		gameData.rpsTotalReward = 0;
		
		saveData();
		updateUI();
		
		checkAchievements();
		
		showMsg(`üí∞ <b>${reward.toLocaleString()}Ïõê</b> ÌöçÎìù!<br>Ïó∞ÏäπÏù¥ Ï¥àÍ∏∞ÌôîÎê©ÎãàÎã§.`);
		rpsTab();
	}

	function playRPS(player){
		if(rpsPlaying) return; // Ïù¥ÎØ∏ Í≤åÏûÑ ÏßÑÌñâ Ï§ëÏù¥Î©¥ Î¨¥Ïãú
		rpsPlaying = true;
		
		// Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
		const buttons = document.querySelectorAll('#rps-buttons button');
		buttons.forEach(btn => btn.disabled = true);
		
		const choices = ['‚úä', '‚úã', '‚úåÔ∏è'];
		let computer = choices[Math.floor(Math.random() * 3)];
		
		// ÏäπÎ•† Ïä§ÌÇ¨ Ï†ÅÏö©
		if(gameData.skills.rps > 0) {
			const rpsProb = gameData.skills.rps * 0.01;
			if(Math.random() < rpsProb) {
				// ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Ïù¥Í∏∞ÎèÑÎ°ù AI ÏÑ†ÌÉù Ï°∞Ï†ï
				if(player === '‚úä') computer = '‚úåÔ∏è';
				else if(player === '‚úã') computer = '‚úä';
				else if(player === '‚úåÔ∏è') computer = '‚úã';
			}
		}
		
		const display = document.getElementById('rps-display');
		const resultDiv = document.getElementById('rps-result');
		
		let count = 0;
		const interval = setInterval(() => {
			display.textContent = choices[count % 3];
			count++;
			if(count > 9){
				clearInterval(interval);
				display.textContent = computer;
				
				let result = '';
				if(player === computer){
					result = 'draw';
				} else if(
					(player === '‚úä' && computer === '‚úåÔ∏è') ||
					(player === '‚úã' && computer === '‚úä') ||
					(player === '‚úåÔ∏è' && computer === '‚úã')
				){
					result = 'win';
				} else {
					result = 'lose';
				}
				
				if(result === 'win'){
					gameData.rpsStreak++;
					let reward = Math.pow(2, gameData.rpsStreak - 1) * 1000;
					
					// Ïä§ÌÇ¨ Î≥¥ÎÑàÏä§ Ï†ÅÏö©
					if(gameData.skills.rpsPay > 0) {
						reward = Math.floor(reward * (1 + gameData.skills.rpsPay * 0.05));
					}
					
					gameData.rpsTotalReward += reward;
					
					if(gameData.rpsStreak >= 3){
						resultDiv.innerHTML = `<span style="color:var(--success)">ÏäπÎ¶¨! ${gameData.rpsStreak}Ïó∞Ïäπ!<br>ÎàÑÏ†Å ÏÉÅÍ∏à: ${gameData.rpsTotalReward.toLocaleString()}Ïõê</span>`;
					} else {
						resultDiv.innerHTML = `<span style="color:var(--success)">ÏäπÎ¶¨! ${gameData.rpsStreak}Ïó∞Ïäπ<br>ÎàÑÏ†Å ÏÉÅÍ∏à: ${gameData.rpsTotalReward.toLocaleString()}Ïõê (3Ïó∞ÏäπÎ∂ÄÌÑ∞ ÏàòÎ†π)</span>`;
					}
					
					gameData.stats.rpsWins = (gameData.stats.rpsWins || 0) + 1;
					gameData.stats.rpsMaxStreak = Math.max(gameData.stats.rpsMaxStreak || 0, gameData.rpsStreak);
					gainXP(50);
				} else if(result === 'lose'){
					const lostStreak = gameData.rpsStreak;
					const lostMoney = gameData.rpsTotalReward;
					gameData.rpsStreak = 0;
					gameData.rpsTotalReward = 0;
					gameData.stats.rpsLosses = (gameData.stats.rpsLosses || 0) + 1;
					resultDiv.innerHTML = `<span style="color:var(--danger)">Ìå®Î∞∞! Ïó∞Ïäπ Ï¥àÍ∏∞Ìôî<br>${lostStreak}Ïó∞Ïäπ ‚Üí 0Ïó∞Ïäπ (${lostMoney.toLocaleString()}Ïõê ÎÇ†Î¶º)</span>`;
				} else {
					resultDiv.innerHTML = `<span style="color:#6b7280">Î¨¥ÏäπÎ∂Ä! Ïó∞Ïäπ Ïú†ÏßÄ<br>${gameData.rpsStreak}Ïó∞Ïäπ (ÎàÑÏ†Å: ${gameData.rpsTotalReward.toLocaleString()}Ïõê)</span>`;
				}
				
				saveData();
				updateUI();
				
				setTimeout(() => {
					rpsTab();
				}, 2500);
			}
		}, 100);
	}
    // --- ÏÑ§Ï†ï ---
    function openSettings(){
        const o=document.getElementById('modal-overlay'), c=document.getElementById('modal-content'), g=document.getElementById('gacha-ui');
        c.style.display='block'; g.style.display='none';
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML = `<h3>‚öôÔ∏è ÏÑ§Ï†ï</h3><p style="text-align:center; font-size:0.8rem; color:#6b7280;">Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</p>`;
        b.innerHTML = `<button class="btn-outline" onclick="exportData()" style="width:100%; margin-bottom:5px;">üíæ Ï†ÄÏû• ÏΩîÎìú Î≥µÏÇ¨</button><button class="btn-outline" onclick="importDataModal()" style="width:100%; margin-bottom:5px;">üìÇ ÏΩîÎìú Î∂àÎü¨Ïò§Í∏∞</button><button class="btn-danger" onclick="resetGameModal()" style="width:100%; margin-bottom:5px;">üóëÔ∏è Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî</button><button onclick="closeModal()" style="width:100%; background:#374151;">Îã´Í∏∞</button>`;
        o.style.display='flex';
    }
    function exportData(){ const str = btoa(unescape(encodeURIComponent(JSON.stringify(gameData)))); navigator.clipboard.writeText(str).then(() => { alert("ÏÑ∏Ïù¥Î∏å ÏΩîÎìúÍ∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!"); }).catch(() => { prompt("ÏïÑÎûò ÏΩîÎìúÎ•º Î≥µÏÇ¨ÌïòÏÑ∏Ïöî:", str); }); }
    function importDataModal(){
        const t=document.getElementById('modal-text'),b=document.getElementById('modal-btns');
        t.innerHTML = `<h3>üìÇ Î∂àÎü¨Ïò§Í∏∞</h3><div class="settings-area"><p>ÏÑ∏Ïù¥Î∏å ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p><textarea id="import-area"></textarea></div>`;
        b.innerHTML = `<button class="btn-outline" onclick="openSettings()">Îí§Î°ú</button><button class="btn-success" onclick="processImport()">Î∂àÎü¨Ïò§Í∏∞</button>`;
    }
    function processImport(){ try { const str = document.getElementById('import-area').value; if(!str) return alert("ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî."); const json = decodeURIComponent(escape(window.atob(str))); const data = JSON.parse(json); if(!data.money || !data.stocks) throw new Error("Invalid"); localStorage.setItem('rpgGameData', JSON.stringify(data)); alert("Î≥µÍµ¨ ÏôÑÎ£å! ÏÉàÎ°úÍ≥†Ïπ®Ìï©ÎãàÎã§."); location.reload(); } catch(e) { alert("ÏûòÎ™ªÎêú ÏΩîÎìúÏûÖÎãàÎã§."); } }
    function resetGameModal(){ showConfirm("<span style='color:red'>Í≤ΩÍ≥†!</span><br>Ï†ïÎßê Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?", () => { localStorage.removeItem('rpgGameData'); location.reload(); }); }
</script>
</body>
</html>